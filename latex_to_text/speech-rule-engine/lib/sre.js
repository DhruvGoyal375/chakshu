!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SRE=e():t.SRE=e()}(this,(()=>(()=>{"use strict";var __webpack_modules__={778:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>SystemExternal});var _variables_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(82);class SystemExternal{static nodeRequire(){return eval("require")}static extRequire(t){return"undefined"!=typeof process?SystemExternal.nodeRequire()(t):null}}SystemExternal.windowSupported=!("undefined"==typeof window),SystemExternal.documentSupported=SystemExternal.windowSupported&&!(void 0===window.document),SystemExternal.xmldom=SystemExternal.documentSupported?window:SystemExternal.extRequire("@xmldom/xmldom"),SystemExternal.document=SystemExternal.documentSupported?window.document:(new SystemExternal.xmldom.DOMImplementation).createDocument("","",0),SystemExternal.xpath=SystemExternal.documentSupported?document:function(){const t={document:{},XPathResult:{}};return SystemExternal.extRequire("wicked-good-xpath").install(t),t.document.XPathResult=t.XPathResult,t.document}(),SystemExternal.mathmapsIePath="https://cdn.jsdelivr.net/npm/sre-mathmaps-ie@"+_variables_js__WEBPACK_IMPORTED_MODULE_0__.u.VERSION+"mathmaps_ie.js",SystemExternal.fs=SystemExternal.documentSupported?null:SystemExternal.extRequire("fs"),SystemExternal.url=_variables_js__WEBPACK_IMPORTED_MODULE_0__.u.url,SystemExternal.jsonPath=function(){if(SystemExternal.documentSupported)return SystemExternal.url;if(process.env.SRE_JSON_PATH||__webpack_require__.g.SRE_JSON_PATH)return process.env.SRE_JSON_PATH||__webpack_require__.g.SRE_JSON_PATH;try{return SystemExternal.nodeRequire().resolve("speech-rule-engine").replace(/sre\.js$/,"")+"mathmaps"}catch(t){}try{return SystemExternal.nodeRequire().resolve(".").replace(/sre\.js$/,"")+"mathmaps"}catch(t){}return"undefined"!=typeof __dirname?__dirname+(__dirname.match(/lib?$/)?"/mathmaps":"/lib/mathmaps"):process.cwd()+"/lib/mathmaps"}(),SystemExternal.WGXpath=_variables_js__WEBPACK_IMPORTED_MODULE_0__.u.WGXpath,SystemExternal.wgxpath=null},82:(t,e,n)=>{n.d(e,{u:()=>r});class r{static ensureLocale(t,e){return r.LOCALES.get(t)?t:(console.error(`Locale ${t} does not exist! Using ${r.LOCALES.get(e)} instead.`),e)}}r.VERSION="4.1.0-beta.11",r.LOCALES=new Map([["af","Africaans"],["ca","Catalan"],["da","Danish"],["de","German"],["en","English"],["es","Spanish"],["euro","Euro"],["fr","French"],["hi","Hindi"],["it","Italian"],["ko","Korean"],["nb","Bokm\xe5l"],["nn","Nynorsk"],["sv","Swedish"],["nemeth","Nemeth"]]),r.mathjaxVersion="4.0.0-beta.5",r.url="https://cdn.jsdelivr.net/npm/speech-rule-engine@"+r.VERSION+"/lib/mathmaps",r.WGXpath="https://cdn.jsdelivr.net/npm/wicked-good-xpath@1.3.0/dist/wgxpath.install.js"}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{cli:()=>Ku,engineReady:()=>yu,engineSetup:()=>Lu,exit:()=>Hu,file:()=>Gu,localeLoader:()=>Mu,localePath:()=>Xu,move:()=>$u,number:()=>Du,numericOrdinal:()=>wu,ordinal:()=>vu,processFile:()=>Vu,setupEngine:()=>bu,toDescription:()=>Uu,toEnriched:()=>xu,toJson:()=>Fu,toSemantic:()=>Pu,toSpeech:()=>_u,variables:()=>qu,version:()=>Cu,vulgar:()=>Bu,walk:()=>ju});var t,e,n,r={};__webpack_require__.r(r),__webpack_require__.d(r,{engineReady:()=>yu,engineSetup:()=>Lu,exit:()=>Hu,file:()=>Gu,localeLoader:()=>Mu,localePath:()=>Xu,move:()=>$u,number:()=>Du,numericOrdinal:()=>wu,ordinal:()=>vu,processFile:()=>Vu,setupEngine:()=>bu,toDescription:()=>Uu,toEnriched:()=>xu,toJson:()=>Fu,toSemantic:()=>Pu,toSpeech:()=>_u,version:()=>Cu,vulgar:()=>Bu,walk:()=>ju}),function(t){t.DOMAIN="domain",t.STYLE="style",t.LOCALE="locale",t.TOPIC="topic",t.MODALITY="modality"}(t||(t={}));class s{static createProp(...t){const e=o.DEFAULT_ORDER,n={};for(let r=0,s=t.length,o=e.length;r<s&&r<o;r++)n[e[r]]=t[r];return new s(n)}constructor(t,e=Object.keys(t)){this.properties=t,this.order=e}getProperties(){return this.properties}getOrder(){return this.order}getAxes(){return this.order}getProperty(t){return this.properties[t]}updateProperties(t){this.properties=t}allProperties(){const t=[];return this.order.forEach((e=>t.push(this.getProperty(e).slice()))),t}toString(){const t=[];return this.order.forEach((e=>t.push(e+": "+this.getProperty(e).toString()))),t.join("\n")}}class o extends s{static createCstr(...t){const e=o.DEFAULT_ORDER,n={};for(let r=0,s=t.length,o=e.length;r<s&&r<o;r++)n[e[r]]=t[r];return new o(n)}static defaultCstr(){return o.createCstr.apply(null,o.DEFAULT_ORDER.map((function(t){return o.DEFAULT_VALUES[t]})))}static validOrder(t){const e=o.DEFAULT_ORDER.slice();return t.every((t=>{const n=e.indexOf(t);return-1!==n&&e.splice(n,1)}))}constructor(t,e){const n={};for(const[e,r]of Object.entries(t))n[e]=[r];super(n,e),this.components=t}getComponents(){return this.components}getValue(t){return this.components[t]}getValues(){return this.order.map((t=>this.getValue(t)))}allProperties(){const t=super.allProperties();for(let e,n,r=0;e=t[r],n=this.order[r];r++){const t=this.getValue(n);-1===e.indexOf(t)&&e.unshift(t)}return t}toString(){return this.getValues().join(".")}equal(t){const e=t.getAxes();if(this.order.length!==e.length)return!1;for(let n,r=0;n=e[r];r++){const e=this.getValue(n);if(!e||t.getValue(n)!==e)return!1}return!0}}o.DEFAULT_ORDER=[t.LOCALE,t.MODALITY,t.DOMAIN,t.STYLE,t.TOPIC],o.BASE_LOCALE="base",o.DEFAULT_VALUE="default",o.DEFAULT_VALUES={[t.LOCALE]:"en",[t.DOMAIN]:o.DEFAULT_VALUE,[t.STYLE]:o.DEFAULT_VALUE,[t.TOPIC]:o.DEFAULT_VALUE,[t.MODALITY]:"speech"};class i{constructor(t){this.order=t}parse(t){const e=t.split("."),n={};if(e.length>this.order.length)throw new Error("Invalid dynamic constraint: "+n);let r=0;for(let t,s=0;t=this.order[s],e.length;s++,r++){const r=e.shift();n[t]=r}return new o(n,this.order.slice(0,r))}}class c{constructor(t,e=new s(t.getProperties(),t.getOrder())){this.reference=t,this.fallback=e,this.order=this.reference.getOrder()}getReference(){return this.reference}setReference(t,e){this.reference=t,this.fallback=e||new s(t.getProperties(),t.getOrder()),this.order=this.reference.getOrder()}match(t){const e=t.getAxes();return e.length===this.reference.getAxes().length&&e.every((e=>{const n=t.getValue(e);return n===this.reference.getValue(e)||-1!==this.fallback.getProperty(e).indexOf(n)}))}compare(t,e){let n=!1;for(let r,s=0;r=this.order[s];s++){const s=t.getValue(r),o=e.getValue(r);if(!n){const t=this.reference.getValue(r);if(t===s&&t!==o)return-1;if(t===o&&t!==s)return 1;if(t===s&&t===o)continue;t!==s&&t!==o&&(n=!0)}const i=this.fallback.getProperty(r),c=i.indexOf(s),a=i.indexOf(o);if(c<a)return-1;if(a<c)return 1}return 0}toString(){return this.reference.toString()+"\n"+this.fallback.toString()}}!function(t){t.SYNC="sync",t.ASYNC="async",t.HTTP="http"}(e||(e={})),function(t){t.PITCH="pitch",t.RATE="rate",t.VOLUME="volume",t.PAUSE="pause",t.JOIN="join",t.LAYOUT="layout"}(n||(n={}));const a=[n.PITCH,n.RATE,n.VOLUME,n.PAUSE,n.JOIN];var l,u;!function(t){t.NONE="none",t.SHALLOW="shallow",t.DEEP="deep"}(l||(l={})),function(t){t.NONE="none",t.LAYOUT="layout",t.COUNTING="counting",t.PUNCTUATION="punctuation",t.SSML="ssml",t.ACSS="acss",t.SABLE="sable",t.VOICEXML="voicexml"}(u||(u={}));const h={mathspeak:"default",clearspeak:"default"};var d=__webpack_require__(778);class f{static getInstance(){return f.instance=f.instance||new f,f.instance}init(t){return t&&this.startDebugFile_(t),this.isActive_=!0,this.fileHandle}output(...t){this.isActive_&&this.output_(t)}generateOutput(t){this.isActive_&&this.output_(t.apply(t,[]))}exit(t=()=>{}){this.fileHandle.then((()=>{this.isActive_&&this.stream_&&this.stream_.end("","",t)}))}constructor(){this.isActive_=!1,this.outputFunction_=console.info,this.fileHandle=Promise.resolve(),this.stream_=null}startDebugFile_(t){this.fileHandle=d.f.fs.promises.open(t,"w"),this.fileHandle=this.fileHandle.then((e=>{this.stream_=e.createWriteStream(t),this.outputFunction_=function(...t){this.stream_.write(t.join(" ")),this.stream_.write("\n")}.bind(this),this.stream_.on("error",function(t){console.info("Invalid log file. Debug information sent to console."),this.outputFunction_=console.info}.bind(this)),this.stream_.on("finish",(function(){console.info("Finalizing debug file.")}))}))}output_(t){console.info!==this.outputFunction_?this.fileHandle.then((()=>this.outputFunction_.apply(this.outputFunction_,["Speech Rule Engine Debugger:"].concat(t)))):this.outputFunction_.apply(console,["Speech Rule Engine Debugger:"].concat(t))}}var p=__webpack_require__(82);class m extends Error{constructor(t=""){super(),this.message=t,this.name="SRE Error"}}class E{set defaultLocale(t){this._defaultLocale=p.u.ensureLocale(t,this._defaultLocale)}get defaultLocale(){return this._defaultLocale}static getInstance(){return E.instance=E.instance||new E,E.instance}static defaultEvaluator(t,e){return t}static evaluateNode(t){return E.nodeEvaluator(t)}getRate(){const t=parseInt(this.rate,10);return isNaN(t)?100:t}setDynamicCstr(e){if(this.defaultLocale&&(o.DEFAULT_VALUES[t.LOCALE]=this.defaultLocale),e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const r=t[n];if(-1!==o.DEFAULT_ORDER.indexOf(r)){const t=e[r];this[r]=t}}}h[this.domain]=this.style;const n=[this.locale,this.modality,this.domain,this.style].join("."),r=s.createProp([o.DEFAULT_VALUES[t.LOCALE]],[o.DEFAULT_VALUES[t.MODALITY]],[o.DEFAULT_VALUES[t.DOMAIN]],[o.DEFAULT_VALUES[t.STYLE]]),i=this.comparators[this.domain],a=this.parsers[this.domain];this.parser=a||this.defaultParser,this.dynamicCstr=this.parser.parse(n),this.dynamicCstr.updateProperties(r.getProperties()),this.comparator=i?i():new c(this.dynamicCstr)}constructor(){this.customLoader=null,this.parsers={},this.comparator=null,this.mode=e.SYNC,this.init=!0,this.delay=!1,this.comparators={},this.domain="mathspeak",this.style=o.DEFAULT_VALUES[t.STYLE],this._defaultLocale=o.DEFAULT_VALUES[t.LOCALE],this.locale=o.DEFAULT_VALUES[t.LOCALE],this.subiso="",this.modality=o.DEFAULT_VALUES[t.MODALITY],this.speech=l.NONE,this.markup=u.NONE,this.mark=!0,this.automark=!1,this.character=!0,this.cleanpause=!0,this.cayleyshort=!0,this.linebreaks=!1,this.rate="100",this.walker="Table",this.structure=!1,this.aria=!1,this.ruleSets=[],this.strict=!1,this.isIE=!1,this.isEdge=!1,this.pprint=!1,this.config=!1,this.rules="",this.prune="",this.locale=this.defaultLocale,this.evaluator=E.defaultEvaluator,this.defaultParser=new i(o.DEFAULT_ORDER),this.parser=this.defaultParser,this.dynamicCstr=o.defaultCstr()}configurate(t){this.mode!==e.HTTP||this.config||(!function(t){const e=document.documentElement.querySelectorAll('script[type="text/x-sre-config"]');for(let n=0,r=e.length;n<r;n++){let r;try{r=e[n].innerHTML;const s=JSON.parse(r);for(const[e,n]of Object.entries(s))t[e]=n}catch(t){f.getInstance().output("Illegal configuration ",r)}}}(t),this.config=!0),function(t){if("undefined"!=typeof SREfeature)for(const[e,n]of Object.entries(SREfeature))t[e]=n}(t)}setCustomLoader(t){t&&(this.customLoader=t)}}E.BINARY_FEATURES=["automark","mark","character","cleanpause","strict","structure","aria","pprint","cayleyshort","linebreaks"],E.STRING_FEATURES=["markup","style","domain","speech","walker","defaultLocale","locale","delay","modality","rate","rules","subiso","prune"],E.nodeEvaluator=function(t){return[]};class g{static get(t=E.getInstance().locale){return g.promises[t]||Promise.resolve("")}static getall(){return Promise.all(Object.values(g.promises))}}function N(){return"undefined"!=typeof XPathResult}g.loaded={},g.promises={};const S={currentDocument:null,evaluate:N()?document.evaluate:d.f.xpath.evaluate,result:N()?XPathResult:d.f.xpath.XPathResult,createNSResolver:N()?document.createNSResolver:d.f.xpath.createNSResolver},T={xhtml:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",mml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function I(t){return T[t]||null}class A{constructor(){this.lookupNamespaceURI=I}}function R(t,n,r){return E.getInstance().mode!==e.HTTP||E.getInstance().isIE||E.getInstance().isEdge?S.evaluate(t,n,new A,r,null):S.currentDocument.evaluate(t,n,I,r,null)}function O(t,e){let n;try{n=R(t,e,S.result.ORDERED_NODE_ITERATOR_TYPE)}catch(t){return[]}const r=[];for(let t=n.iterateNext();t;t=n.iterateNext())r.push(t);return r}function C(t){if(E.getInstance().mode!==e.HTTP)return;let n=t;for(;n&&!n.evaluate;)n=n.parentNode;n&&n.evaluate?S.currentDocument=n:t.ownerDocument&&(S.currentDocument=t.ownerDocument)}function b(t){const e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]);return e}function L(t){const n=new d.f.xmldom.DOMParser,r=function(t){return(t=t.replace(/&nbsp;/g,"\xa0")).replace(/>[ \f\n\r\t\v\u200b]+</g,"><").trim()}(t),s=!!r.match(/&(?!lt|gt|amp|quot|apos)\w+;/g);if(!r)throw new Error("Empty input!");try{const t=n.parseFromString(r,s?"text/html":"text/xml");return E.getInstance().mode===e.HTTP?(S.currentDocument=t,s?t.body.childNodes[0]:t.documentElement):t.documentElement}catch(t){throw new m("Illegal input: "+t.message)}}var y,M,_,P;function F(t,e){t.parentNode&&(t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t))}function U(t){return d.f.document.createElement(t)}function x(t,e){return d.f.document.createElementNS(t,e)}function D(t){let e="",n=/(>)(<)(\/*)/g,r=0,s=(t=t.replace(n,"$1\r\n$2$3")).split("\r\n");for(n=/(\.)*(<)(\/*)/g,s=s.map((t=>t.replace(n,"$1\r\n$2$3").split("\r\n"))).reduce(((t,e)=>t.concat(e)),[]);s.length;){let t=s.shift();if(!t)continue;let n=0;if(t.match(/^<\w[^>/]*>[^>]+$/)){const e=v(t,s[0]);e[0]?e[1]?(t+=s.shift().slice(0,-e[1].length),e[1].trim()&&s.unshift(e[1])):t+=s.shift():n=1}else if(t.match(/^<\/\w/))0!==r&&(r-=1);else if(t.match(/^<\w[^>]*[^/]>.*$/))n=1;else if(t.match(/^<\w[^>]*\/>.+$/)){const e=t.indexOf(">")+1,n=t.slice(e);n.trim()&&s.unshift(),t=t.slice(0,e)+n}else n=0;e+=new Array(r+1).join("  ")+t+"\r\n",r+=n}return e}function v(t,e){if(!e)return[!1,""];const n=t.match(/^<([^> ]+).*>/),r=e.match(/^<\/([^>]+)>(.*)/);return n&&r&&n[1]===r[1]?[!0,r[2]]:[!1,""]}function w(t,e,n){return t.querySelectorAll?b(t.querySelectorAll(`[${e}="${n}"]`)):O(`.//*[@${e}="${n}"]`,t)}function B(t){return t.tagName.toUpperCase()}function k(t){return t.cloneNode(!0)}function G(t){return(new d.f.xmldom.XMLSerializer).serializeToString(t)}function V(t){const e=t.toString(16).toUpperCase();return e.length>3?e:("000"+e).slice(-4)}function j([t,e],n){const r=parseInt(t,16),s=parseInt(e,16),o=[];for(let t=r;t<=s;t++){let e=V(t);!1!==n[e]&&(e=n[e]||e,o.push(e))}return o}function $(t,e={}){return j(t,e).map((t=>String.fromCodePoint(parseInt(t,16))))}!function(t){t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE",t[t.TEXT_NODE=3]="TEXT_NODE",t[t.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",t[t.ENTITY_REFERENCE_NODE=5]="ENTITY_REFERENCE_NODE",t[t.ENTITY_NODE=6]="ENTITY_NODE",t[t.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",t[t.COMMENT_NODE=8]="COMMENT_NODE",t[t.DOCUMENT_NODE=9]="DOCUMENT_NODE",t[t.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",t[t.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE",t[t.NOTATION_NODE=12]="NOTATION_NODE"}(y||(y={})),function(t){t.BOLD="bold",t.BOLDFRAKTUR="bold-fraktur",t.BOLDITALIC="bold-italic",t.BOLDSCRIPT="bold-script",t.DOUBLESTRUCK="double-struck",t.DOUBLESTRUCKITALIC="double-struck-italic",t.FULLWIDTH="fullwidth",t.FRAKTUR="fraktur",t.ITALIC="italic",t.MONOSPACE="monospace",t.NORMAL="normal",t.SCRIPT="script",t.SANSSERIF="sans-serif",t.SANSSERIFITALIC="sans-serif-italic",t.SANSSERIFBOLD="sans-serif-bold",t.SANSSERIFBOLDITALIC="sans-serif-bold-italic"}(M||(M={})),function(t){t.SUPER="super",t.SUB="sub",t.CIRCLED="circled",t.PARENTHESIZED="parenthesized",t.PERIOD="period",t.NEGATIVECIRCLED="negative-circled",t.DOUBLECIRCLED="double-circled",t.CIRCLEDSANSSERIF="circled-sans-serif",t.NEGATIVECIRCLEDSANSSERIF="negative-circled-sans-serif",t.COMMA="comma",t.SQUARED="squared",t.NEGATIVESQUARED="negative-squared"}(_||(_={})),function(t){t.LATINCAP="latinCap",t.LATINSMALL="latinSmall",t.GREEKCAP="greekCap",t.GREEKSMALL="greekSmall",t.DIGIT="digit"}(P||(P={}));const H=[{interval:["1D400","1D419"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.BOLD},{interval:["1D41A","1D433"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.BOLD},{interval:["1D56C","1D585"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.BOLDFRAKTUR},{interval:["1D586","1D59F"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.BOLDFRAKTUR},{interval:["1D468","1D481"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.BOLDITALIC},{interval:["1D482","1D49B"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.BOLDITALIC},{interval:["1D4D0","1D4E9"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.BOLDSCRIPT},{interval:["1D4EA","1D503"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.BOLDSCRIPT},{interval:["1D538","1D551"],base:P.LATINCAP,subst:{"1D53A":"2102","1D53F":"210D","1D545":"2115","1D547":"2119","1D548":"211A","1D549":"211D","1D551":"2124"},capital:!0,category:"Lu",font:M.DOUBLESTRUCK},{interval:["1D552","1D56B"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.DOUBLESTRUCK},{interval:["1D504","1D51D"],base:P.LATINCAP,subst:{"1D506":"212D","1D50B":"210C","1D50C":"2111","1D515":"211C","1D51D":"2128"},capital:!0,category:"Lu",font:M.FRAKTUR},{interval:["1D51E","1D537"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.FRAKTUR},{interval:["FF21","FF3A"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.FULLWIDTH},{interval:["FF41","FF5A"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.FULLWIDTH},{interval:["1D434","1D44D"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.ITALIC},{interval:["1D44E","1D467"],base:P.LATINSMALL,subst:{"1D455":"210E"},capital:!1,category:"Ll",font:M.ITALIC},{interval:["1D670","1D689"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.MONOSPACE},{interval:["1D68A","1D6A3"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.MONOSPACE},{interval:["0041","005A"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.NORMAL},{interval:["0061","007A"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.NORMAL},{interval:["1D49C","1D4B5"],base:P.LATINCAP,subst:{"1D49D":"212C","1D4A0":"2130","1D4A1":"2131","1D4A3":"210B","1D4A4":"2110","1D4A7":"2112","1D4A8":"2133","1D4AD":"211B"},capital:!0,category:"Lu",font:M.SCRIPT},{interval:["1D4B6","1D4CF"],base:P.LATINSMALL,subst:{"1D4BA":"212F","1D4BC":"210A","1D4C4":"2134"},capital:!1,category:"Ll",font:M.SCRIPT},{interval:["1D5A0","1D5B9"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.SANSSERIF},{interval:["1D5BA","1D5D3"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.SANSSERIF},{interval:["1D608","1D621"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.SANSSERIFITALIC},{interval:["1D622","1D63B"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.SANSSERIFITALIC},{interval:["1D5D4","1D5ED"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.SANSSERIFBOLD},{interval:["1D5EE","1D607"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.SANSSERIFBOLD},{interval:["1D63C","1D655"],base:P.LATINCAP,subst:{},capital:!0,category:"Lu",font:M.SANSSERIFBOLDITALIC},{interval:["1D656","1D66F"],base:P.LATINSMALL,subst:{},capital:!1,category:"Ll",font:M.SANSSERIFBOLDITALIC},{interval:["0391","03A9"],base:P.GREEKCAP,subst:{"03A2":"03F4"},capital:!0,category:"Lu",font:M.NORMAL},{interval:["03B0","03D0"],base:P.GREEKSMALL,subst:{"03B0":"2207","03CA":"2202","03CB":"03F5","03CC":"03D1","03CD":"03F0","03CE":"03D5","03CF":"03F1","03D0":"03D6"},capital:!1,category:"Ll",font:M.NORMAL},{interval:["1D6A8","1D6C0"],base:P.GREEKCAP,subst:{},capital:!0,category:"Lu",font:M.BOLD},{interval:["1D6C1","1D6E1"],base:P.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:M.BOLD},{interval:["1D6E2","1D6FA"],base:P.GREEKCAP,subst:{},capital:!0,category:"Lu",font:M.ITALIC},{interval:["1D6FB","1D71B"],base:P.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:M.ITALIC},{interval:["1D71C","1D734"],base:P.GREEKCAP,subst:{},capital:!0,category:"Lu",font:M.BOLDITALIC},{interval:["1D735","1D755"],base:P.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:M.BOLDITALIC},{interval:["1D756","1D76E"],base:P.GREEKCAP,subst:{},capital:!0,category:"Lu",font:M.SANSSERIFBOLD},{interval:["1D76F","1D78F"],base:P.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:M.SANSSERIFBOLD},{interval:["1D790","1D7A8"],base:P.GREEKCAP,subst:{},capital:!0,category:"Lu",font:M.SANSSERIFBOLDITALIC},{interval:["1D7A9","1D7C9"],base:P.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:M.SANSSERIFBOLDITALIC},{interval:["0030","0039"],base:P.DIGIT,subst:{},offset:0,category:"Nd",font:M.NORMAL},{interval:["2070","2079"],base:P.DIGIT,subst:{2071:"00B9",2072:"00B2",2073:"00B3"},offset:0,category:"No",font:_.SUPER},{interval:["2080","2089"],base:P.DIGIT,subst:{},offset:0,category:"No",font:_.SUB},{interval:["245F","2473"],base:P.DIGIT,subst:{"245F":"24EA"},offset:0,category:"No",font:_.CIRCLED},{interval:["3251","325F"],base:P.DIGIT,subst:{},offset:21,category:"No",font:_.CIRCLED},{interval:["32B1","32BF"],base:P.DIGIT,subst:{},offset:36,category:"No",font:_.CIRCLED},{interval:["2474","2487"],base:P.DIGIT,subst:{},offset:1,category:"No",font:_.PARENTHESIZED},{interval:["2487","249B"],base:P.DIGIT,subst:{2487:"1F100"},offset:0,category:"No",font:_.PERIOD},{interval:["2775","277F"],base:P.DIGIT,subst:{2775:"24FF"},offset:0,category:"No",font:_.NEGATIVECIRCLED},{interval:["24EB","24F4"],base:P.DIGIT,subst:{},offset:11,category:"No",font:_.NEGATIVECIRCLED},{interval:["24F5","24FE"],base:P.DIGIT,subst:{},offset:1,category:"No",font:_.DOUBLECIRCLED},{interval:["277F","2789"],base:P.DIGIT,subst:{"277F":"1F10B"},offset:0,category:"No",font:_.CIRCLEDSANSSERIF},{interval:["2789","2793"],base:P.DIGIT,subst:{2789:"1F10C"},offset:0,category:"No",font:_.NEGATIVECIRCLEDSANSSERIF},{interval:["FF10","FF19"],base:P.DIGIT,subst:{},offset:0,category:"Nd",font:M.FULLWIDTH},{interval:["1D7CE","1D7D7"],base:P.DIGIT,subst:{},offset:0,category:"Nd",font:M.BOLD},{interval:["1D7D8","1D7E1"],base:P.DIGIT,subst:{},offset:0,category:"Nd",font:M.DOUBLESTRUCK},{interval:["1D7E2","1D7EB"],base:P.DIGIT,subst:{},offset:0,category:"Nd",font:M.SANSSERIF},{interval:["1D7EC","1D7F5"],base:P.DIGIT,subst:{},offset:0,category:"Nd",font:M.SANSSERIFBOLD},{interval:["1D7F6","1D7FF"],base:P.DIGIT,subst:{},offset:0,category:"Nd",font:M.MONOSPACE},{interval:["1F101","1F10A"],base:P.DIGIT,subst:{},offset:0,category:"No",font:_.COMMA},{interval:["24B6","24CF"],base:P.LATINCAP,subst:{},capital:!0,category:"So",font:_.CIRCLED},{interval:["24D0","24E9"],base:P.LATINSMALL,subst:{},capital:!1,category:"So",font:_.CIRCLED},{interval:["1F110","1F129"],base:P.LATINCAP,subst:{},capital:!0,category:"So",font:_.PARENTHESIZED},{interval:["249C","24B5"],base:P.LATINSMALL,subst:{},capital:!1,category:"So",font:_.PARENTHESIZED},{interval:["1F130","1F149"],base:P.LATINCAP,subst:{},capital:!0,category:"So",font:_.SQUARED},{interval:["1F170","1F189"],base:P.LATINCAP,subst:{},capital:!0,category:"So",font:_.NEGATIVESQUARED},{interval:["1F150","1F169"],base:P.LATINCAP,subst:{},capital:!0,category:"So",font:_.NEGATIVECIRCLED}],X=new Map;function W(t,e){return t+e.split("-").map((t=>t[0].toUpperCase()+t.slice(1))).join("")}for(const t of H){const e=W(t.base,t.font),n=$(t.interval,t.subst);let r=X.get(e);r?r.unicode=r.unicode.concat(n):(r=t,r.unicode=n,X.set(e,r))}var Y;!function(t){t.PUNCTUATION="punctuation",t.FENCE="fence",t.NUMBER="number",t.IDENTIFIER="identifier",t.TEXT="text",t.OPERATOR="operator",t.RELATION="relation",t.LARGEOP="largeop",t.FUNCTION="function",t.ACCENT="accent",t.FENCED="fenced",t.FRACTION="fraction",t.PUNCTUATED="punctuated",t.RELSEQ="relseq",t.MULTIREL="multirel",t.INFIXOP="infixop",t.PREFIXOP="prefixop",t.POSTFIXOP="postfixop",t.APPL="appl",t.INTEGRAL="integral",t.BIGOP="bigop",t.SQRT="sqrt",t.ROOT="root",t.LIMUPPER="limupper",t.LIMLOWER="limlower",t.LIMBOTH="limboth",t.SUBSCRIPT="subscript",t.SUPERSCRIPT="superscript",t.UNDERSCORE="underscore",t.OVERSCORE="overscore",t.TENSOR="tensor",t.TABLE="table",t.MULTILINE="multiline",t.MATRIX="matrix",t.VECTOR="vector",t.CASES="cases",t.ROW="row",t.LINE="line",t.CELL="cell",t.ENCLOSE="enclose",t.INFERENCE="inference",t.RULELABEL="rulelabel",t.CONCLUSION="conclusion",t.PREMISES="premises",t.UNKNOWN="unknown",t.EMPTY="empty"}(Y||(Y={}));const K=Object.assign({},Y);var q;!function(t){t.COMMA="comma",t.SEMICOLON="semicolon",t.ELLIPSIS="ellipsis",t.FULLSTOP="fullstop",t.QUESTION="question",t.EXCLAMATION="exclamation",t.QUOTES="quotes",t.DASH="dash",t.TILDE="tilde",t.PRIME="prime",t.DEGREE="degree",t.VBAR="vbar",t.COLON="colon",t.OPENFENCE="openfence",t.CLOSEFENCE="closefence",t.APPLICATION="application",t.DUMMY="dummy",t.UNIT="unit",t.LABEL="label",t.OPEN="open",t.CLOSE="close",t.TOP="top",t.BOTTOM="bottom",t.NEUTRAL="neutral",t.METRIC="metric",t.LATINLETTER="latinletter",t.GREEKLETTER="greekletter",t.OTHERLETTER="otherletter",t.NUMBERSET="numbersetletter",t.INTEGER="integer",t.FLOAT="float",t.OTHERNUMBER="othernumber",t.INFTY="infty",t.MIXED="mixed",t.MULTIACCENT="multiaccent",t.OVERACCENT="overaccent",t.UNDERACCENT="underaccent",t.UNDEROVER="underover",t.SUBSUP="subsup",t.LEFTSUB="leftsub",t.LEFTSUPER="leftsuper",t.RIGHTSUB="rightsub",t.RIGHTSUPER="rightsuper",t.LEFTRIGHT="leftright",t.ABOVEBELOW="abovebelow",t.SETEMPTY="set empty",t.SETEXT="set extended",t.SETSINGLE="set singleton",t.SETCOLLECT="set collection",t.STRING="string",t.SPACE="space",t.ANNOTATION="annotation",t.TEXT="text",t.SEQUENCE="sequence",t.ENDPUNCT="endpunct",t.STARTPUNCT="startpunct",t.NEGATIVE="negative",t.POSITIVE="positive",t.NEGATION="negation",t.MULTIOP="multiop",t.PREFIXOP="prefix operator",t.POSTFIXOP="postfix operator",t.LIMFUNC="limit function",t.INFIXFUNC="infix function",t.PREFIXFUNC="prefix function",t.POSTFIXFUNC="postfix function",t.SIMPLEFUNC="simple function",t.COMPFUNC="composed function",t.SUM="sum",t.INTEGRAL="integral",t.GEOMETRY="geometry",t.BOX="box",t.BLOCK="block",t.ADDITION="addition",t.MULTIPLICATION="multiplication",t.SUBTRACTION="subtraction",t.IMPLICIT="implicit",t.DIVISION="division",t.VULGAR="vulgar",t.EQUALITY="equality",t.INEQUALITY="inequality",t.ARROW="arrow",t.ELEMENT="element",t.NONELEMENT="nonelement",t.REELEMENT="reelement",t.RENONELEMENT="renonelement",t.SET="set",t.DETERMINANT="determinant",t.ROWVECTOR="rowvector",t.BINOMIAL="binomial",t.SQUAREMATRIX="squarematrix",t.CYCLE="cycle",t.MULTILINE="multiline",t.MATRIX="matrix",t.VECTOR="vector",t.CASES="cases",t.TABLE="table",t.CAYLEY="cayley",t.PROOF="proof",t.LEFT="left",t.RIGHT="right",t.UP="up",t.DOWN="down",t.FINAL="final",t.SINGLE="single",t.HYP="hyp",t.AXIOM="axiom",t.LOGIC="logic",t.UNKNOWN="unknown",t.MGLYPH="mglyph"}(q||(q={}));const z=Object.assign({},q);var Q;!function(t){t.CALIGRAPHIC="caligraphic",t.CALIGRAPHICBOLD="caligraphic-bold",t.OLDSTYLE="oldstyle",t.OLDSTYLEBOLD="oldstyle-bold",t.UNKNOWN="unknown"}(Q||(Q={}));const J=Object.assign(Object.assign(Object.assign({},M),Q),_);var Z;!function(t){t.ALLLETTERS="allLetters",t.D="d",t.BAR="bar",t.TILDE="tilde"}(Z||(Z={}));const tt=Object.assign(Object.assign({},P),Z);function et(t,e){return t.toString()}function nt(t){return t.toString()}function rt(t,e){return t+e.toLowerCase()}const st={};function ot(t,e=""){if(!t.childNodes||!t.childNodes[0]||!t.childNodes[0].childNodes||t.childNodes[0].childNodes.length<2||t.childNodes[0].childNodes[0].tagName!==K.NUMBER||t.childNodes[0].childNodes[0].getAttribute("role")!==z.INTEGER||t.childNodes[0].childNodes[1].tagName!==K.NUMBER||t.childNodes[0].childNodes[1].getAttribute("role")!==z.INTEGER)return{convertible:!1,content:t.textContent};const n=t.childNodes[0].childNodes[1].textContent,r=t.childNodes[0].childNodes[0].textContent,s=Number(n),o=Number(r);return isNaN(s)||isNaN(o)?{convertible:!1,content:`${r} ${e} ${n}`}:{convertible:!0,enumerator:o,denominator:s}}function it(t,e,n){const r=ot(t);if(r.convertible){const t=r.enumerator,s=r.denominator;return t>0&&t<e&&s>0&&s<n}return!1}function ct(t={}){return Object.assign({zero:"zero",ones:[],tens:[],large:[],special:{},wordOrdinal:nt,numericOrdinal:nt,numberToWords:nt,numberToOrdinal:et,vulgarSep:" ",numSep:" "},t)}st.identityCombiner=function(t,e,n){return t+e+n},st.prefixCombiner=function(t,e,n){return t=n?n+" "+t:t,e?e+" "+t:t},st.postfixCombiner=function(t,e,n){return t=n?n+" "+t:t,e?t+" "+e:t},st.romanceCombiner=function(t,e,n){return t=n?t+" "+n:t,e?t+" "+e:t};const at=lt();function lt(){return{FUNCTIONS:{fracNestDepth:t=>it(t,10,100),radicalNestDepth:t=>"",combineRootIndex:function(t,e){return t},combineNestedFraction:st.identityCombiner,combineNestedRadical:st.identityCombiner,fontRegexp:function(t){return new RegExp("^"+t.split(/ |-/).join("( |-)")+"( |-)")},si:rt,plural:nt},MESSAGES:{MS:{},MSroots:{},font:{},embellish:{},role:{},enclose:{},navigate:{},regexp:{},unitTimes:""},ALPHABETS:{latinSmall:[],latinCap:[],greekSmall:[],greekCap:[],capPrefix:{default:""},smallPrefix:{default:""},digitPrefix:{default:""},languagePrefix:{},digitTrans:{default:nt,mathspeak:nt,clearspeak:nt},letterTrans:{default:nt},combiner:(t,e,n)=>t},NUMBERS:ct(),COMBINERS:{},CORRECTIONS:{},SUBISO:{default:"",current:"",all:[]}}}function ut(t){switch(t){case 1:return at.MESSAGES.MS.ONCE||"";case 2:return at.MESSAGES.MS.TWICE;default:return t.toString()}}function ht(t,e){return t===at.MESSAGES.MS.ROOTINDEX||t===at.MESSAGES.MS.INDEX?t:t+" "+e}function dt(t){return ft(at.MESSAGES.font[t],t)}function ft(t,e){return void 0===t?e:"string"==typeof t?t:t[0]}const pt="grammar";class mt{static getInstance(){return mt.instance=mt.instance||new mt,mt.instance}static parseInput(t){const e={},n=t.split(":");for(const t of n){const n=t.split("="),r=n[0].trim();n[1]?e[r]=n[1].trim():r.match(/^!/)?e[r.slice(1)]=!1:e[r]=!0}return e}static parseState(t){const e={},n=t.split(" ");for(const t of n){const n=t.split(":"),r=n[0],s=n[1];e[r]=s||!0}return e}static translateString(t){if(t.match(/:unit$/))return mt.translateUnit(t);const e=E.getInstance();let n=e.evaluator(t,e.dynamicCstr);return n=null===n?t:n,mt.getInstance().getParameter("plural")&&(n=at.FUNCTIONS.plural(n)),n}static translateUnit(t){t=mt.prepareUnit(t);const e=E.getInstance(),n=mt.getInstance().getParameter("plural"),r=e.strict,s=`${e.locale}.${e.modality}.default`;let o,i;return e.strict=!0,n&&(o=e.defaultParser.parse(s+".plural"),i=e.evaluator(t,o)),i?(e.strict=r,i):(o=e.defaultParser.parse(s+".default"),i=e.evaluator(t,o),e.strict=r,i?(n&&(i=at.FUNCTIONS.plural(i)),i):mt.cleanUnit(t))}static prepareUnit(t){const e=t.match(/:unit$/);return e?t.slice(0,e.index).replace(/\s+/g," ")+t.slice(e.index):t}static cleanUnit(t){return t.match(/:unit$/)?t.replace(/:unit$/,""):t}clear(){this.parameters_={},this.stateStack_=[]}setParameter(t,e){const n=this.parameters_[t];return e?this.parameters_[t]=e:delete this.parameters_[t],n}getParameter(t){return this.parameters_[t]}setCorrection(t,e){this.corrections_[t]=e}setPreprocessor(t,e){this.preprocessors_[t]=e}getCorrection(t){return this.corrections_[t]}getState(){const t=[];for(const[e,n]of Object.entries(this.parameters_))t.push("string"==typeof n?e+":"+n:e);return t.join(" ")}processSingles(){const t={};for(const e of this.singles)t[e]=!1;this.singles=[],this.pushState(t)}pushState(t){for(let[e,n]of Object.entries(t))e.match(/^\?/)&&(delete t[e],e=e.slice(1),this.singles.push(e)),t[e]=this.setParameter(e,n);this.stateStack_.push(t)}popState(){const t=this.stateStack_.pop();for(const[e,n]of Object.entries(t))this.setParameter(e,n)}setAttribute(t){if(t&&t.nodeType===y.ELEMENT_NODE){const e=this.getState();e&&t.setAttribute(pt,e)}}preprocess(t){return this.runProcessors(t,this.preprocessors_)}correct(t){return this.runProcessors(t,this.corrections_)}apply(t,e){return this.currentFlags=e||{},t=this.currentFlags.adjust||this.currentFlags.preprocess?mt.getInstance().preprocess(t):t,(this.parameters_.translate||this.currentFlags.translate)&&(t=mt.translateString(t)),t=this.currentFlags.adjust||this.currentFlags.correct?mt.getInstance().correct(t):t,this.currentFlags={},t}runProcessors(t,e){for(const[n,r]of Object.entries(this.parameters_)){const s=e[n];s&&(t=!0===r?s(t):s(t,r))}return t}constructor(){this.currentFlags={},this.parameters_={},this.corrections_={},this.preprocessors_={},this.stateStack_=[],this.singles=[]}}function Et(t,e){if(!e||!t)return t;const n=at.FUNCTIONS.fontRegexp(dt(e));return t.replace(n,"")}function gt(t){let e=t%1e3,n="",r=Tt.ones[Math.floor(e/100)];if(n+=r?r+Tt.numSep+"honderd":"",e%=100,e)if(n+=n?Tt.numSep:"",r=Tt.ones[e],r)n+=r;else{const t=Tt.tens[Math.floor(e/10)];r=Tt.ones[e%10],n+=r?r+"-en-"+t:t}return n}function Nt(t){if(0===t)return Tt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){if(t%1e3){const r=gt(t%1e3);if(e){const t=Tt.large[e];n=r+Tt.numSep+t+(n?Tt.numSep+n:"")}else n=r+(n?Tt.numSep+n:"")}t=Math.floor(t/1e3),e++}return n}function St(t){if(1===t)return"eerste";if(3===t)return"derde";if(8===t)return"agste";if(9===t)return"negende";return Nt(t)+(t<19?"de":"ste")}mt.getInstance().setCorrection("localFont",dt),mt.getInstance().setCorrection("localRole",(function(t){return ft(at.MESSAGES.role[t],t)})),mt.getInstance().setCorrection("localEnclose",(function(t){return ft(at.MESSAGES.enclose[t],t)})),mt.getInstance().setCorrection("ignoreFont",Et),mt.getInstance().setPreprocessor("annotation",(function(t,e){return t+":"+e})),mt.getInstance().setPreprocessor("noTranslateText",(function(t){return t.match(new RegExp("^["+at.MESSAGES.regexp.TEXT+"]+$"))&&(mt.getInstance().currentFlags.translate=!1),t})),mt.getInstance().setCorrection("ignoreCaps",(function(t){let e=at.ALPHABETS.capPrefix[E.getInstance().domain];return void 0===e&&(e=at.ALPHABETS.capPrefix.default),Et(t,e)})),mt.getInstance().setPreprocessor("numbers2alpha",(function(t){return t.match(/\d+/)?at.NUMBERS.numberToWords(parseInt(t,10)):t}));const Tt=ct({wordOrdinal:St,numericOrdinal:function(t){return t.toString()+"."},numberToWords:Nt,numberToOrdinal:function(t,e){return 1===t?"enkel":2===t?e?"helftes":"helfte":4===t?e?"kwarte":"kwart":St(t)+(e?"s":"")}}),It=function(t,e,n){return t=n?n+" "+t:t,e?t+" "+e:t};let At=null;function Rt(t){const e=t%1e3,n=Math.floor(e/100),r=n?1===n?"cent":bt.ones[n]+"-cents":"",s=function(t){const e=t%100;if(e<20)return bt.ones[e];const n=Math.floor(e/10),r=bt.tens[n],s=bt.ones[e%10];return r&&s?r+(2===n?"-i-":"-")+s:r||s}(e%100);return r&&s?r+bt.numSep+s:r||s}function Ot(t){if(0===t)return bt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%(e>1?1e6:1e3);if(r){let t=bt.large[e];if(e)if(1===e)n=(1===r?"":Rt(r)+bt.numSep)+t+(n?bt.numSep+n:"");else{const e=Ot(r);t=1===r?t:t.replace(/\u00f3$/,"ons"),n=e+bt.numSep+t+(n?bt.numSep+n:"")}else n=Rt(r)}t=Math.floor(t/(e>1?1e6:1e3)),e++}return n}function Ct(t){const e=mt.getInstance().getParameter("gender");return t.toString()+("f"===e?"a":"n")}const bt=ct({numericOrdinal:Ct,numberToWords:Ot,numberToOrdinal:function(t,e){if(t>1999)return Ct(t);if(t<=10)return bt.special.onesOrdinals[t-1];const n=Ot(t);return n.match(/mil$/)?n.replace(/mil$/,"mil\xb7l\xe8sima"):n.match(/u$/)?n.replace(/u$/,"vena"):n.match(/a$/)?n.replace(/a$/,"ena"):n+(n.match(/e$/)?"na":"ena")}}),Lt=function(t,e,n){return t="sans serif "+(n?n+" "+t:t),e?t+" "+e:t};let yt=null;function Mt(t,e=!1){return t===Ut.ones[1]?e?"et":"en":t}function _t(t,e=!1){let n=t%1e3,r="",s=Ut.ones[Math.floor(n/100)];if(r+=s?Mt(s,!0)+" hundrede":"",n%=100,n)if(r+=r?" og ":"",s=e?Ut.special.smallOrdinals[n]:Ut.ones[n],s)r+=s;else{const t=e?Ut.special.tensOrdinals[Math.floor(n/10)]:Ut.tens[Math.floor(n/10)];s=Ut.ones[n%10],r+=s?Mt(s)+"og"+t:t}return r}function Pt(t,e=!1){if(0===t)return Ut.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const t=_t(s,e&&!n);if(n){const e=Ut.large[n],o=s>1?"er":"";r=Mt(t,n<=1)+" "+e+o+(r?" og ":"")+r}else r=Mt(t)+r}t=Math.floor(t/1e3),n++}return r}function Ft(t){if(t%100)return Pt(t,!0);const e=Pt(t);return e.match(/e$/)?e:e+"e"}const Ut=ct({wordOrdinal:Ft,numericOrdinal:function(t){return t.toString()+"."},numberToWords:Pt,numberToOrdinal:function(t,e){return 1===t?e?"hel":"hele":2===t?e?"halv":"halve":Ft(t)+(e?"dele":"del")}});let xt=null;function Dt(t,e=!1){return t===kt.ones[1]?e?"eine":"ein":t}function vt(t){let e=t%1e3,n="",r=kt.ones[Math.floor(e/100)];if(n+=r?Dt(r)+"hundert":"",e%=100,e)if(n+=n?kt.numSep:"",r=kt.ones[e],r)n+=r;else{const t=kt.tens[Math.floor(e/10)];r=kt.ones[e%10],n+=r?Dt(r)+"und"+t:t}return n}function wt(t){if(0===t)return kt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%1e3;if(r){const s=vt(t%1e3);if(e){const t=kt.large[e],o=e>1&&r>1?t.match(/e$/)?"n":"en":"";n=Dt(s,e>1)+t+o+n}else n=Dt(s,e>1)+n}t=Math.floor(t/1e3),e++}return n.replace(/ein$/,"eins")}function Bt(t){if(1===t)return"erste";if(3===t)return"dritte";if(7===t)return"siebte";if(8===t)return"achte";return wt(t)+(t<19?"te":"ste")}const kt=ct({wordOrdinal:Bt,numericOrdinal:function(t){return t.toString()+"."},numberToWords:wt,numberToOrdinal:function(t,e){return 1===t?"eintel":2===t?e?"halbe":"halb":Bt(t)+"l"}}),Gt=function(t,e,n){return"s"===n&&(e=e.split(" ").map((function(t){return t.replace(/s$/,"")})).join(" "),n=""),t=n?n+" "+t:t,e?e+" "+t:t},Vt=function(t,e,n){return t=n&&"s"!==n?n+" "+t:t,e?t+" "+e:t};let jt=null;function $t(t){let e=t%1e3,n="";return n+=Wt.ones[Math.floor(e/100)]?Wt.ones[Math.floor(e/100)]+Wt.numSep+"hundred":"",e%=100,e&&(n+=n?Wt.numSep:"",n+=Wt.ones[e]||Wt.tens[Math.floor(e/10)]+(e%10?Wt.numSep+Wt.ones[e%10]:"")),n}function Ht(t){if(0===t)return Wt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){t%1e3&&(n=$t(t%1e3)+(e?"-"+Wt.large[e]+"-":"")+n),t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}function Xt(t){let e=Ht(t);return e.match(/one$/)?e=e.slice(0,-3)+"first":e.match(/two$/)?e=e.slice(0,-3)+"second":e.match(/three$/)?e=e.slice(0,-5)+"third":e.match(/five$/)?e=e.slice(0,-4)+"fifth":e.match(/eight$/)?e=e.slice(0,-5)+"eighth":e.match(/nine$/)?e=e.slice(0,-4)+"ninth":e.match(/twelve$/)?e=e.slice(0,-6)+"twelfth":e.match(/ty$/)?e=e.slice(0,-2)+"tieth":e+="th",e}const Wt=ct({wordOrdinal:Xt,numericOrdinal:function(t){const e=t%100,n=t.toString();if(e>10&&e<20)return n+"th";switch(t%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd";default:return n+"th"}},numberToWords:Ht,numberToOrdinal:function(t,e){if(1===t)return e?"oneths":"oneth";if(2===t)return e?"halves":"half";const n=Xt(t);return e?n+"s":n}});let Yt=null;function Kt(t){const e=t%1e3,n=Math.floor(e/100),r=qt.special.hundreds[n],s=function(t){const e=t%100;if(e<30)return qt.ones[e];const n=qt.tens[Math.floor(e/10)],r=qt.ones[e%10];return n&&r?n+" y "+r:n||r}(e%100);return 1===n?s?r+"to "+s:r:r&&s?r+" "+s:r||s}const qt=ct({numericOrdinal:function(t){const e=mt.getInstance().getParameter("gender");return t.toString()+("f"===e?"a":"o")},numberToWords:function(t){if(0===t)return qt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%1e3;if(r){let t=qt.large[e];const s=Kt(r);e?1===r?(t=t.match("/^mil( |$)/")?t:"un "+t,n=t+(n?" "+n:"")):(t=t.replace(/\u00f3n$/,"ones"),n=Kt(r)+" "+t+(n?" "+n:"")):n=s}t=Math.floor(t/1e3),e++}return n},numberToOrdinal:function(t,e){if(t>1999)return t.toString()+"a";if(t<=12)return qt.special.onesOrdinals[t-1];const n=[];if(t>=1e3&&(t-=1e3,n.push("mil\xe9sima")),!t)return n.join(" ");let r=0;return r=Math.floor(t/100),r>0&&(n.push(qt.special.hundredsOrdinals[r-1]),t%=100),t<=12?n.push(qt.special.onesOrdinals[t-1]):(r=Math.floor(t/10),r>0&&(n.push(qt.special.tensOrdinals[r-1]),t%=10),t>0&&n.push(qt.special.onesOrdinals[t-1])),n.join(" ")}}),zt=function(t,e,n){return t="sans serif "+(n?n+" "+t:t),e?t+" "+e:t};let Qt=null;let Jt=null;function Zt(t){let e=t%1e3,n="";if(n+=re.ones[Math.floor(e/100)]?re.ones[Math.floor(e/100)]+"-cent":"",e%=100,e){n+=n?"-":"";let t=re.ones[e];if(t)n+=t;else{const r=re.tens[Math.floor(e/10)];r.match(/-dix$/)?(t=re.ones[e%10+10],n+=r.replace(/-dix$/,"")+"-"+t):n+=r+(e%10?"-"+re.ones[e%10]:"")}}const r=n.match(/s-\w+$/);return r?n.replace(/s-\w+$/,r[0].slice(1)):n.replace(/-un$/,"-et-un")}function te(t){if(0===t)return re.zero;if(t>=Math.pow(10,36))return t.toString();re.special["tens-"+E.getInstance().subiso]&&(re.tens=re.special["tens-"+E.getInstance().subiso]);let e=0,n="";for(;t>0;){const r=t%1e3;if(r){let t=re.large[e];const s=Zt(r);if(t&&t.match(/^mille /)){const r=t.replace(/^mille /,"");n=n.match(RegExp(r))?s+(e?"-mille-":"")+n:n.match(RegExp(r.replace(/s$/,"")))?s+(e?"-mille-":"")+n.replace(r.replace(/s$/,""),r):s+(e?"-"+t+"-":"")+n}else t=1===r&&t?t.replace(/s$/,""):t,n=s+(e?"-"+t+"-":"")+n}t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}const ee={1:"uni\xe8me",2:"demi",3:"tiers",4:"quart"};function ne(t){if(1===t)return"premi\xe8re";let e=te(t);return e.match(/^neuf$/)?e=e.slice(0,-1)+"v":e.match(/cinq$/)?e+="u":e.match(/trois$/)?e+="":(e.match(/e$/)||e.match(/s$/))&&(e=e.slice(0,-1)),e+="i\xe8me",e}const re=ct({wordOrdinal:ne,numericOrdinal:function(t){const e=mt.getInstance().getParameter("gender");return 1===t?t.toString()+("m"===e?"er":"re"):t.toString()+"e"},numberToWords:te,numberToOrdinal:function(t,e){const n=ee[t]||ne(t);return 3===t?n:e?n+"s":n}});let se=null;function oe(t){if(0===t)return ce.zero;if(t>=Math.pow(10,32))return t.toString();let e=0,n="";const r=function(t){let e=t%1e3,n="";return n+=ce.ones[Math.floor(e/100)]?ce.ones[Math.floor(e/100)]+ce.numSep+ce.special.hundred:"",e%=100,e&&(n+=n?ce.numSep:"",n+=ce.ones[e]),n}(t%1e3);if(!(t=Math.floor(t/1e3)))return r;for(;t>0;){const r=t%100;r&&(n=ce.ones[r]+ce.numSep+ce.large[e]+(n?ce.numSep+n:"")),t=Math.floor(t/100),e++}return r?n+ce.numSep+r:n}function ie(t){const e=mt.getInstance().getParameter("gender");if(t<=0)return t.toString();if(t<10)return"f"===e?ce.special.ordinalsFeminine[t]:ce.special.ordinalsMasculine[t];return oe(t)+("f"===e?"\u0935\u0940\u0902":"\u0935\u093e\u0901")}const ce=ct({wordOrdinal:ie,numericOrdinal:function(t){const e=mt.getInstance().getParameter("gender");return t>0&&t<10?"f"===e?ce.special.simpleSmallOrdinalsFeminine[t]:ce.special.simpleSmallOrdinalsMasculine[t]:t.toString().split("").map((function(t){const e=parseInt(t,10);return isNaN(e)?"":ce.special.simpleNumbers[e]})).join("")+("f"===e?"\u0935\u0940\u0902":"\u0935\u093e\u0901")},numberToWords:oe,numberToOrdinal:function(t,e){return t<=10?ce.special.smallDenominators[t]:ie(t)+" \u0905\u0902\u0936"}});let ae=null;function le(t){let e=t%1e4,n="";return n+=fe.ones[Math.floor(e/1e3)]?1===Math.floor(e/1e3)?"\ucc9c":fe.ones[Math.floor(e/1e3)]+"\ucc9c":"",e%=1e3,e&&(n+=fe.ones[Math.floor(e/100)]?1===Math.floor(e/100)?"\ubc31":fe.ones[Math.floor(e/100)]+"\ubc31":"",e%=100,n+=fe.tens[Math.floor(e/10)]+(e%10?fe.ones[e%10]:"")),n}function ue(t){if(0===t)return fe.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){t%1e4&&(n=le(t%1e4)+(e?fe.large[e]+fe.numSep:"")+n),t=Math.floor(t/1e4),e++}return n.replace(/ $/,"")}function he(t,e){return 1===t?"\uccab\ubc88\uc9f8":de(t)+"\ubc88\uc9f8"}function de(t){const e=ue(t),n=ue(t%=100);if(!n||!t)return e;const r=20===t?"\uc2a4\ubb34":fe.tens[10+Math.floor(t/10)],s=fe.ones[10+Math.floor(t%10)];return e.slice(0,-n.length)+r+s}const fe=ct({wordOrdinal:de,numericOrdinal:function(t){return he(t)},numberToWords:ue,numberToOrdinal:he});let pe=null;function me(t){let e=t%1e3,n="";if(n+=Ne.ones[Math.floor(e/100)]?Ne.ones[Math.floor(e/100)]+Ne.numSep+"cento":"",e%=100,e){n+=n?Ne.numSep:"";const t=Ne.ones[e];if(t)n+=t;else{let t=Ne.tens[Math.floor(e/10)];const r=e%10;1!==r&&8!==r||(t=t.slice(0,-1)),n+=t,n+=r?Ne.numSep+Ne.ones[e%10]:""}}return n}function Ee(t){if(0===t)return Ne.zero;if(t>=Math.pow(10,36))return t.toString();if(1===t&&mt.getInstance().getParameter("fraction"))return"un";let e=0,n="";for(;t>0;){t%1e3&&(n=me(t%1e3)+(e?"-"+Ne.large[e]+"-":"")+n),t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}function ge(t){const e="m"===mt.getInstance().getParameter("gender")?"o":"a";let n=Ne.special.onesOrdinals[t];return n?n.slice(0,-1)+e:(n=Ee(t),n.slice(0,-1)+"esim"+e)}const Ne=ct({wordOrdinal:ge,numericOrdinal:function(t){const e=mt.getInstance().getParameter("gender");return t.toString()+("m"===e?"o":"a")},numberToWords:Ee,numberToOrdinal:function(t,e){if(2===t)return e?"mezzi":"mezzo";const n=ge(t);if(!e)return n;const r=n.match(/o$/)?"i":"e";return n.slice(0,-1)+r}}),Se=function(t,e,n){return t.match(/^[a-zA-Z]$/)&&(e=e.replace("cerchiato","cerchiata")),t=n?t+" "+n:t,e?t+" "+e:t};let Te=null;function Ie(t,e=!1){let n=t%1e3,r="";const s=Math.floor(n/100),o=Oe.ones[s];if(r+=o?(1===s?"":o)+"hundre":"",n%=100,n){if(r+=r?"og":"",e){const t=Oe.special.smallOrdinals[n];if(t)return r+t;if(n%10)return r+Oe.tens[Math.floor(n/10)]+Oe.special.smallOrdinals[n%10]}r+=Oe.ones[n]||Oe.tens[Math.floor(n/10)]+(n%10?Oe.ones[n%10]:"")}return e?Ae(r):r}function Ae(t){const e=Oe.special.endOrdinal[0];return"a"===e&&t.match(/en$/)?t.slice(0,-2)+Oe.special.endOrdinal:t.match(/(d|n)$/)||t.match(/hundre$/)?t+"de":t.match(/i$/)?t+Oe.special.endOrdinal:"a"===e&&t.match(/e$/)?t.slice(0,-1)+Oe.special.endOrdinal:(t.match(/e$/),t+"nde")}function Re(t){return Le(t,!0)}const Oe=ct({wordOrdinal:Re,numericOrdinal:function(t){return t.toString()+"."},numberToWords:Le,numberToOrdinal:function(t,e){return Re(t)}});function Ce(t,e=!1){return t===Oe.ones[1]?"ein"===t?"eitt ":e?"et":"ett":t}function be(t,e=!1){let n=t%1e3,r="",s=Oe.ones[Math.floor(n/100)];if(r+=s?Ce(s)+"hundre":"",n%=100,n){if(r+=r?"og":"",e){const t=Oe.special.smallOrdinals[n];if(t)return r+t}if(s=Oe.ones[n],s)r+=s;else{const t=Oe.tens[Math.floor(n/10)];s=Oe.ones[n%10],r+=s?s+"og"+t:t}}return e?Ae(r):r}function Le(t,e=!1){const n="alt"===E.getInstance().subiso?function(t,e=!1){if(0===t)return e?Oe.special.smallOrdinals[0]:Oe.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=be(t%1e3,!n&&e);!n&&e&&(e=!e),r=(1===n?Ce(o,!0):o)+(n>1?Oe.numSep:"")+(n?Oe.large[n]+(n>1&&s>1?"er":""):"")+(n>1&&r?Oe.numSep:"")+r}t=Math.floor(t/1e3),n++}return e?r+(r.match(/tusen$/)?"de":"te"):r}(t,e):function(t,e=!1){if(0===t)return e?Oe.special.smallOrdinals[0]:Oe.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=Ie(t%1e3,!n&&e);!n&&e&&(e=!e),r=o+(n?" "+Oe.large[n]+(n>1&&s>1?"er":"")+(r?" ":""):"")+r}t=Math.floor(t/1e3),n++}return e?r+(r.match(/tusen$/)?"de":"te"):r}(t,e);return n}let ye=null;function Me(t){return t.toString().split("").map((function(t){return _e.ones[parseInt(t,10)]})).join("")}const _e=ct({numberToWords:Me,numberToOrdinal:Me}),Pe=function(t){return t.match(RegExp("^"+we.ALPHABETS.languagePrefix.english))?t.slice(1):t},Fe=function(t,e,n){return t=Pe(t),e?t+e:t},Ue=function(t,e,n){return e+Pe(t)},xe=function(t,e,n){return e+(n||"")+(t=Pe(t))+"\u283b"},De=function(t,e,n){return e+(n||"")+(t=Pe(t))+"\u283b\u283b"},ve=function(t,e,n){return e+(t=Pe(t))+"\u283e"};let we=null;let Be=null;function ke(t){let e=t%1e3,n="";const r=Math.floor(e/100);return n+=je.ones[r]?(1===r?"":je.ones[r]+je.numSep)+"hundra":"",e%=100,e&&(n+=n?je.numSep:"",n+=je.ones[e]||je.tens[Math.floor(e/10)]+(e%10?je.numSep+je.ones[e%10]:"")),n}function Ge(t,e=!1){if(0===t)return je.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=je.large[n],i=s>1&&n>1&&!e?"er":"";r=(1===n&&1===s?"":(n>1&&1===s?"en":ke(t%1e3))+(n>1?" ":""))+(n?o+i+(n>1?" ":""):"")+r}t=Math.floor(t/1e3),n++}return r.replace(/ $/,"")}function Ve(t){let e=Ge(t,!0);return e.match(/^noll$/)?e="nollte":e.match(/ett$/)?e=e.replace(/ett$/,"f\xf6rsta"):e.match(/tv\xe5$/)?e=e.replace(/tv\xe5$/,"andra"):e.match(/tre$/)?e=e.replace(/tre$/,"tredje"):e.match(/fyra$/)?e=e.replace(/fyra$/,"fj\xe4rde"):e.match(/fem$/)?e=e.replace(/fem$/,"femte"):e.match(/sex$/)?e=e.replace(/sex$/,"sj\xe4tte"):e.match(/sju$/)?e=e.replace(/sju$/,"sjunde"):e.match(/\xe5tta$/)?e=e.replace(/\xe5tta$/,"\xe5ttonde"):e.match(/nio$/)?e=e.replace(/nio$/,"nionde"):e.match(/tio$/)?e=e.replace(/tio$/,"tionde"):e.match(/elva$/)?e=e.replace(/elva$/,"elfte"):e.match(/tolv$/)?e=e.replace(/tolv$/,"tolfte"):e.match(/tusen$/)?e=e.replace(/tusen$/,"tusonde"):e.match(/jard$/)||e.match(/jon$/)?e+="te":e+="de",e}const je=ct({wordOrdinal:Ve,numericOrdinal:function(t){const e=t.toString();return e.match(/11$|12$/)?e+":e":e+(e.match(/1$|2$/)?":a":":e")},numberToWords:Ge,numberToOrdinal:function(t,e){if(1===t)return"hel";if(2===t)return e?"halva":"halv";let n=Ve(t);return n=n.match(/de$/)?n.replace(/de$/,""):n,n+(e?"delar":"del")}});let $e=null;const He={af:function(){return At||(At=function(){const t=lt();return t.NUMBERS=Tt,t.COMBINERS.germanPostfix=It,t.FUNCTIONS.radicalNestDepth=ut,t.FUNCTIONS.plural=t=>/.*s$/.test(t)?t:t+"s",t.FUNCTIONS.fontRegexp=function(t){return new RegExp("((^"+t+" )|( "+t+"$))")},t.ALPHABETS.combiner=st.prefixCombiner,t.ALPHABETS.digitTrans.default=Tt.numberToWords,t.CORRECTIONS.article=t=>mt.getInstance().getParameter("noArticle")?"":t,t}()),At},ca:function(){return yt||(yt=function(){const t=lt();return t.NUMBERS=bt,t.COMBINERS.sansserif=Lt,t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.combineRootIndex=ht,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>t+n,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t+" "),t.FUNCTIONS.plural=t=>/.*os$/.test(t)?t+"sos":/.*s$/.test(t)?t+"os":/.*ga$/.test(t)?t.slice(0,-2)+"gues":/.*\xe7a$/.test(t)?t.slice(0,-2)+"ces":/.*ca$/.test(t)?t.slice(0,-2)+"ques":/.*ja$/.test(t)?t.slice(0,-2)+"ges":/.*qua$/.test(t)?t.slice(0,-3)+"q\xfces":/.*a$/.test(t)?t.slice(0,-1)+"es":/.*(e|i)$/.test(t)?t+"ns":/.*\xed$/.test(t)?t.slice(0,-1)+"ins":t+"s",t.FUNCTIONS.si=(t,e)=>(e.match(/^metre/)&&(t=t.replace(/a$/,"\xe0").replace(/o$/,"\xf2").replace(/i$/,"\xed")),t+e),t.ALPHABETS.combiner=st.prefixCombiner,t}()),yt},da:function(){return xt||(xt=function(){const t=lt();return t.NUMBERS=Ut,t.FUNCTIONS.radicalNestDepth=ut,t.FUNCTIONS.fontRegexp=e=>e===t.ALPHABETS.capPrefix.default?RegExp("^"+e+" "):RegExp(" "+e+"$"),t.ALPHABETS.combiner=st.postfixCombiner,t.ALPHABETS.digitTrans.default=Ut.numberToWords,t}()),xt},de:function(){return jt||(jt=function(){const t=lt();return t.NUMBERS=kt,t.COMBINERS.germanPostfix=Vt,t.ALPHABETS.combiner=Gt,t.FUNCTIONS.radicalNestDepth=e=>e>1?t.NUMBERS.numberToWords(e)+"fach":"",t.FUNCTIONS.combineRootIndex=(t,e)=>{const n=e?e+"wurzel":"";return t.replace("Wurzel",n)},t.FUNCTIONS.combineNestedRadical=(t,e,n)=>{const r=(e?e+" ":"")+(t=n.match(/exponent$/)?t+"r":t);return n.match(/ /)?n.replace(/ /," "+r+" "):r+" "+n},t.FUNCTIONS.fontRegexp=function(t){return t=t.split(" ").map((function(t){return t.replace(/s$/,"(|s)")})).join(" "),new RegExp("((^"+t+" )|( "+t+"$))")},t.CORRECTIONS.correctOne=t=>t.replace(/^eins$/,"ein"),t.CORRECTIONS.localFontNumber=t=>dt(t).split(" ").map((function(t){return t.replace(/s$/,"")})).join(" "),t.CORRECTIONS.lowercase=t=>t.toLowerCase(),t.CORRECTIONS.article=t=>{const e=mt.getInstance().getParameter("case"),n=mt.getInstance().getParameter("plural");return"dative"===e?{der:"dem",die:n?"den":"der",das:"dem"}[t]:t},t.CORRECTIONS.masculine=t=>"dative"===mt.getInstance().getParameter("case")?t+"n":t,t}()),jt},en:function(){return Yt||(Yt=function(){const t=lt();return t.NUMBERS=Wt,t.FUNCTIONS.radicalNestDepth=ut,t.FUNCTIONS.plural=t=>/.*s$/.test(t)?t:t+"s",t.ALPHABETS.combiner=st.prefixCombiner,t.ALPHABETS.digitTrans.default=Wt.numberToWords,t.CORRECTIONS.article=t=>mt.getInstance().getParameter("noArticle")?"":t,t}()),Yt},es:function(){return Qt||(Qt=function(){const t=lt();return t.NUMBERS=qt,t.COMBINERS.sansserif=zt,t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.combineRootIndex=ht,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>t+n,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t+" "),t.FUNCTIONS.plural=t=>/.*(a|e|i|o|u)$/.test(t)?t+"s":/.*z$/.test(t)?t.slice(0,-1)+"ces":/.*c$/.test(t)?t.slice(0,-1)+"ques":/.*g$/.test(t)?t+"ues":/.*\u00f3n$/.test(t)?t.slice(0,-2)+"ones":t+"es",t.FUNCTIONS.si=(t,e)=>(e.match(/^metro/)&&(t=t.replace(/a$/,"\xe1").replace(/o$/,"\xf3").replace(/i$/,"\xed")),t+e),t.ALPHABETS.combiner=st.prefixCombiner,t}()),Qt},euro:function(){return Jt||(Jt=lt()),Jt},fr:function(){return se||(se=function(){const t=lt();return t.NUMBERS=re,t.FUNCTIONS.radicalNestDepth=ut,t.FUNCTIONS.combineRootIndex=ht,t.FUNCTIONS.combineNestedFraction=(t,e,n)=>n.replace(/ $/g,"")+e+t,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>n+" "+t,t.FUNCTIONS.fontRegexp=t=>RegExp(" (en |)"+t+"$"),t.FUNCTIONS.plural=t=>/.*s$/.test(t)?t:t+"s",t.CORRECTIONS.article=t=>mt.getInstance().getParameter("noArticle")?"":t,t.ALPHABETS.combiner=st.romanceCombiner,t.SUBISO={default:"fr",current:"fr",all:["fr","be","ch"]},t}()),se},hi:function(){return ae||(ae=function(){const t=lt();return t.NUMBERS=ce,t.ALPHABETS.combiner=st.prefixCombiner,t.FUNCTIONS.radicalNestDepth=ut,t}()),ae},it:function(){return Te||(Te=function(){const t=lt();return t.NUMBERS=Ne,t.COMBINERS.italianPostfix=Se,t.FUNCTIONS.radicalNestDepth=ut,t.FUNCTIONS.combineRootIndex=ht,t.FUNCTIONS.combineNestedFraction=(t,e,n)=>n.replace(/ $/g,"")+e+t,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>n+" "+t,t.FUNCTIONS.fontRegexp=t=>RegExp(" (en |)"+t+"$"),t.ALPHABETS.combiner=st.romanceCombiner,t}()),Te},ko:function(){return pe||(pe=function(){const t=lt();return t.NUMBERS=fe,t.FUNCTIONS.radicalNestDepth=ut,t.FUNCTIONS.plural=function(t){return t},t.FUNCTIONS.si=(t,e)=>t+e,t.FUNCTIONS.combineRootIndex=function(t,e){return t+e},t.ALPHABETS.combiner=st.prefixCombiner,t.ALPHABETS.digitTrans.default=fe.numberToWords,t.CORRECTIONS.postposition=t=>{if(["\uac19\ub2e4","\ub294","\uc640","\ub97c","\ub85c"].includes(t))return t;const e=t.slice(-1);let n=(e.charCodeAt(0)-44032)%28>0;return e.match(/[r,l,n,m,1,3,6,7,8,0]/i)&&(n=!0),mt.getInstance().setParameter("final",n),t},t.CORRECTIONS.article=t=>{const e=mt.getInstance().getParameter("final");e&&mt.getInstance().setParameter("final",!1),"\uac19\ub2e4"===t&&(t="\ub294");const n={\ub294:"\uc740",\uc640:"\uacfc",\ub97c:"\uc744",\ub85c:"\uc73c\ub85c"}[t];return void 0!==n&&e?n:t},t}()),pe},nb:function(){return ye||(ye=function(){const t=lt();return t.NUMBERS=Oe,t.ALPHABETS.combiner=st.prefixCombiner,t.ALPHABETS.digitTrans.default=Oe.numberToWords,t.FUNCTIONS.radicalNestDepth=ut,t}()),ye},nn:function(){return Be||(Be=function(){const t=lt();return t.NUMBERS=Oe,t.ALPHABETS.combiner=st.prefixCombiner,t.ALPHABETS.digitTrans.default=Oe.numberToWords,t.FUNCTIONS.radicalNestDepth=ut,t.SUBISO={default:"",current:"",all:["","alt"]},t}()),Be},sv:function(){return $e||($e=function(){const t=lt();return t.NUMBERS=je,t.FUNCTIONS.radicalNestDepth=ut,t.FUNCTIONS.fontRegexp=function(t){return new RegExp("((^"+t+" )|( "+t+"$))")},t.ALPHABETS.combiner=st.prefixCombiner,t.ALPHABETS.digitTrans.default=je.numberToWords,t.CORRECTIONS.correctOne=t=>t.replace(/^ett$/,"en"),t}()),$e},nemeth:function(){return we||(we=function(){const t=lt();return t.NUMBERS=_e,t.COMBINERS={postfixCombiner:Fe,germanCombiner:Ue,embellishCombiner:xe,doubleEmbellishCombiner:De,parensCombiner:ve},t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t),t.FUNCTIONS.si=nt,t.ALPHABETS.combiner=(t,e,n)=>e?e+n+t:Pe(t),t.ALPHABETS.digitTrans={default:_e.numberToWords},t}()),we}};function Xe(){const t=function(){const t=p.u.ensureLocale(E.getInstance().locale,E.getInstance().defaultLocale);return E.getInstance().locale=t,He[t]()}();if(function(t){const e=E.getInstance().subiso;-1===t.SUBISO.all.indexOf(e)&&(E.getInstance().subiso=t.SUBISO.default);t.SUBISO.current=E.getInstance().subiso}(t),t){for(const e of Object.getOwnPropertyNames(t))at[e]=t[e];for(const[e,n]of Object.entries(t.CORRECTIONS))mt.getInstance().setCorrection(e,n)}}function We(){return"undefined"!=typeof window&&"ActiveXObject"in window&&"clipboardData"in window&&(ze(d.f.mathmapsIePath),Ke(),!0)}const Ye=null;function Ke(t){ze(d.f.WGXpath),qe(t)}function qe(t,e){let n=e||1;"undefined"==typeof wgxpath&&n<10?setTimeout((function(){qe(t,n++)}),200):n>=10||(d.f.wgxpath=wgxpath,t?d.f.wgxpath.install({document}):d.f.wgxpath.install(),S.evaluate=document.evaluate,S.result=XPathResult,S.createNSResolver=document.createNSResolver)}function ze(t){const e=d.f.document.createElement("script");e.type="text/javascript",e.src=t,d.f.document.head?d.f.document.head.appendChild(e):d.f.document.body.appendChild(e)}function Qe(t){return t.match("/$")?t:t+"/"}function Je(t,e="json"){return Qe(d.f.jsonPath)+t+(e.match(/^\./)?e:"."+e)}var Ze=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]])}return n};const tn={functionApplication:String.fromCodePoint(8289),invisibleTimes:String.fromCodePoint(8290),invisibleComma:String.fromCodePoint(8291),invisiblePlus:String.fromCodePoint(8292)};class en extends Map{get(t){return super.get(t)||{role:z.UNKNOWN,type:K.UNKNOWN,font:J.UNKNOWN}}}class nn extends Map{set(t,e,n=""){return super.set(this.secKey(e,t),n||e),this}has(t,e){return super.has(this.secKey(e,t))}get(t,e){return super.get(this.secKey(e,t))}secKey(t,e){return e?`${t} ${e}`:`${t}`}}const rn={Meaning:new en,Secondary:new nn,FencesHoriz:new Map,FencesVert:new Map,LatexCommands:new Map};function sn(t,e){for(const n of t)rn.Meaning.set(n,{role:e.role||z.UNKNOWN,type:e.type||K.UNKNOWN,font:e.font||J.UNKNOWN}),e.secondary&&rn.Secondary.set(n,e.secondary)}function on(t,e,n=1){const r={},s=function(t){let e=[];for(const n of t)Array.isArray(n)?e=e.concat(j(n,{}).map((t=>parseInt(t,16)))):e.push(parseInt(n,16));return e}(e);for(const e of s)r[e]||(t.set(String.fromCodePoint(e),String.fromCodePoint(e+n)),r[e]=!0,r[e+n]=!0)}const cn=["cos","cot","csc","sec","sin","tan","arccos","arccot","arccsc","arcsec","arcsin","arctan"].concat(["cosh","coth","csch","sech","sinh","tanh","arcosh","arcoth","arcsch","arsech","arsinh","artanh"],["deg","det","dim","hom","ker","Tr"],["log","ln","lg","exp","gcd","lcm","arg","im","re","Pr"]);function an(t,e,n,r,s,o=[],i={},c={}){const a=X.get(W(t,r));a&&(a.unicode.forEach((t=>{rn.Meaning.set(t,{type:e,role:n,font:s}),o.forEach((e=>rn.Secondary.set(t,e)))})),function(t,e){for(const[n,r]of Object.entries(e)){const e=t[n];void 0!==e&&rn.Meaning.set(e,r)}}(a.unicode,i),function(t,e){for(const[n,r]of Object.entries(e)){const e=t[n];void 0!==e&&rn.Secondary.set(e,r)}}(a.unicode,c))}[{set:["23","26","40","5c","a1","a7","b6","bf","2017",["2022","2025"],"2027","203b","203c",["2041","2043"],["2047","2049"],["204b","204d"],"2050","2055","2056",["2058","205e"],"2234","2235","fe45","fe46","fe5f","fe60","fe68","fe6b","ff03","ff06","ff0f","ff20","ff3c"],type:K.PUNCTUATION,role:z.UNKNOWN},{set:["22","ab","bb","2dd",["2018","201f"],"2039","203a",["301d","301f"],"fe10","ff02","ff07"],type:K.PUNCTUATION,role:z.QUOTES},{set:["3b","204f","2a1f","2a3e","fe14","fe54","ff1b"],type:K.PUNCTUATION,role:z.SEMICOLON},{set:["3f","203d","fe16","fe56","ff1f"],type:K.PUNCTUATION,role:z.QUESTION},{set:["21","fe15","fe57","ff01"],type:K.PUNCTUATION,role:z.EXCLAMATION},{set:["5e","60","a8","aa","b4","ba","2c7",["2d8","2da"],"2040","207a","207d","207e","ff3e","ff40"],type:K.PUNCTUATION,role:z.OVERACCENT},{set:["b8","2db","2038","203f","2054","208a","208d","208e"],type:K.PUNCTUATION,role:z.UNDERACCENT},{set:["3a","2982","fe13","fe30","fe55","ff1a"],type:K.PUNCTUATION,role:z.COLON},{set:["2c","2063","fe50","ff0c"],type:K.PUNCTUATION,role:z.COMMA},{set:["2026",["22ee","22f1"],"fe19"],type:K.PUNCTUATION,role:z.ELLIPSIS},{set:["2e","fe52","ff0e"],type:K.PUNCTUATION,role:z.FULLSTOP},{set:["2d","207b","208b","2212","2796","fe63","ff0d"],type:K.OPERATOR,role:z.DASH,secondary:tt.BAR},{set:["5f","af",["2010","2015"],"203e","208b",["fe49","fe4f"],"fe58","ff3f","ffe3"],type:K.PUNCTUATION,role:z.DASH,secondary:tt.BAR},{set:["7e","2dc","2f7","303","330","334","2053","223c","223d","301c","ff5e"],type:K.OPERATOR,role:z.TILDE,secondary:tt.TILDE},{set:["27","2b9","2ba",["2032","2037"],"2057"],type:K.PUNCTUATION,role:z.PRIME},{set:["b0"],type:K.PUNCTUATION,role:z.DEGREE},{set:["2b","b1","2064","2213","2214","2228","222a",["228c","228e"],"2294","2295","229d","229e","22bb","22bd","22c4","22ce","22d3","2304","271b","271c","2795","27cf","29fa","29fb","29fe",["2a22","2a28"],"2a2d","2a2e","2a39","2a42","2a45","2a46","2a48","2a4a","2a4c","2a4f","2a50","2a52","2a54","2a56","2a57","2a59","2a5b","2a5d",["2a61","2a63"],"2adc","2add","fe62","ff0b"],type:K.OPERATOR,role:z.ADDITION},{set:["2a","b7","d7","2020","2021","204e","2051","2062",["2217","2219"],"2227","2229","2240","2293","2297",["2299","229b"],"22a0","22a1","22b9","22bc",["22c5","22cc"],"22cf","22d2","22d4","2303","2305","2306","25cb","2715","2716","27ce","27d1",["29d1","29d7"],"29e2","2a1d",["2a2f","2a37"],["2a3b","2a3d"],"2a40","2a43","2a44","2a47","2a49","2a4b","2a4d","2a4e","2a51","2a53","2a55","2a58","2a5a","2a5c",["2a5e","2a60"],"2ada","2adb","fe61","ff0a"],type:K.OPERATOR,role:z.MULTIPLICATION},{set:["2d","af","2010","2011","2052","207b","208b","2212","2216","2238","2242","2296","229f","2796","29ff",["2a29","2a2c"],"2a3a","2a41","fe63","ff0d"],type:K.OPERATOR,role:z.SUBTRACTION},{set:["2f","f7","2044","2215","2298","2797","27cc","29bc",["29f5","29f9"],"2a38"],type:K.OPERATOR,role:z.DIVISION},{set:["25","2030","2031","ff05","fe6a"],type:K.OPERATOR,role:z.POSTFIXOP},{set:["ac","2200","2201","2203","2204","2206",["221a","221c"],"2310","ffe2"],type:K.OPERATOR,role:z.PREFIXOP},{set:["2320","2321","23aa","23ae","23af","23b2","23b3","23b6","23b7"],type:K.OPERATOR,role:z.PREFIXOP},{set:["1d7ca","1d7cb"],type:K.OPERATOR,role:z.PREFIXOP,font:J.BOLD},{set:["3d","7e","207c","208c","221d","2237",["223a","223f"],"2243","2245","2248",["224a","224e"],["2251","225f"],"2261","2263","229c","22cd","22d5","29e4","29e6","2a66","2a67",["2a6a","2a6c"],["2a6c","2a78"],"fe66","ff1d"],type:K.RELATION,role:z.EQUALITY},{set:["3c","3e","2241","2242","2244","2246","2247","2249","224f","2250","2260","2262",["2264","2281"],"22b0","22b1",["22d6","22e1"],["22e6","22e9"],["2976","2978"],"29c0","29c1","29e1","29e3","29e5",["2a79","2abc"],["2af7","2afa"],"fe64","fe65","ff1c","ff1e"],type:K.RELATION,role:z.INEQUALITY},{set:[["2282","228b"],["228f","2292"],["22b2","22b8"],"22d0","22d1",["22e2","22e5"],["22ea","22ed"],"27c3","27c4",["27c7","27c9"],["27d5","27d7"],"27dc",["2979","297b"],"29df",["2abd","2ad8"]],type:K.RELATION,role:z.SET},{set:["2236",["27e0","27e5"],"292b","292c",["29b5","29bb"],"29be","29bf",["29c2","29d0"]],type:K.RELATION,role:z.UNKNOWN},{set:["2205",["29b0","29b4"]],type:K.IDENTIFIER,role:z.SETEMPTY},{set:["1ab2","221e",["29dc","29de"]],type:K.IDENTIFIER,role:z.INFTY},{set:["22a2","22a3",["22a6","22af"],"27da","27db","27dd","27de","2ade",["2ae2","2ae6"],"2aec","2aed"],type:K.RELATION,role:z.LOGIC},{set:["22a4","22a5","22ba","27d8","27d9","27df","2adf","2ae0",["2ae7","2aeb"],"2af1"],type:K.IDENTIFIER,role:z.LOGIC},{set:[["2190","21ff"],"2301","2324","238b","2794",["2798","27af"],["27b1","27be"],["27f0","27ff"],["2900","292a"],["292d","2975"],["297c","297f"],["2b00","2b11"],["2b30","2b4c"],["ffe9","ffec"]],type:K.RELATION,role:z.ARROW},{set:["2208","220a",["22f2","22f9"],"22ff","27d2","2ad9"],type:K.OPERATOR,role:z.ELEMENT},{set:["2209"],type:K.OPERATOR,role:z.NONELEMENT},{set:["220b","220d",["22fa","22fe"]],type:K.OPERATOR,role:z.REELEMENT},{set:["220c"],type:K.OPERATOR,role:z.RENONELEMENT},{set:[["220f","2211"],["22c0","22c3"],["2a00","2a0b"],"2a3f","2afc","2aff"],type:K.LARGEOP,role:z.SUM},{set:["2140"],type:K.LARGEOP,role:z.SUM,font:J.DOUBLESTRUCK},{set:[["222b","2233"],["2a0c","2a17"],["2a17","2a1c"]],type:K.LARGEOP,role:z.INTEGRAL},{set:[["2500","257F"]],type:K.RELATION,role:z.BOX},{set:[["2580","259F"]],type:K.IDENTIFIER,role:z.BLOCK},{set:[["25A0","25FF"],["2B12","2B2F"],["2B50","2B59"]],type:K.RELATION,role:z.GEOMETRY},{set:["220e","2300","2302","2311","29bd","29e0",["29e8","29f3"],"2a1e","2afe","ffed","ffee"],type:K.OPERATOR,role:z.GEOMETRY},{set:[["221f","2222"],"22be","22bf",["2312","2314"],"237c","27c0",["299b","29af"]],type:K.OPERATOR,role:z.GEOMETRY},{set:["24",["a2","a5"],"b5","2123",["2125","2127"],"212a","212b","fe69","ff04","ffe0","ffe1","ffe5","ffe6"],type:K.IDENTIFIER,role:z.UNKNOWN},{set:["a9","ae","210f","2114","2116","2117",["211e","2122"],"212e","2132",["2139","213b"],["2141","2144"],"214d","214e",["1f12a","1f12c"],"1f18a"],type:K.IDENTIFIER,role:z.OTHERLETTER},{set:["2224","2226","2239","2307","27b0","27bf","27c1","27c2","27ca","27cb","27cd","27d0","27d3","27d4","2981","2999","299a","29e7","29f4","2a20","2a21","2a64","2a65","2a68","2a69","2ae1",["2aee","2af0"],"2af2","2af3","2af5","2af6","2afb","2afd"],type:K.OPERATOR,role:z.UNKNOWN},{set:["2605","2606","26aa","26ab",["2720","274d"]],type:K.OPERATOR,role:z.UNKNOWN},{set:[["2145","2149"]],type:K.IDENTIFIER,role:z.LATINLETTER,font:J.DOUBLESTRUCKITALIC,secondary:tt.ALLLETTERS},{set:[["213c","213f"]],type:K.IDENTIFIER,role:z.GREEKLETTER,font:J.DOUBLESTRUCK,secondary:tt.ALLLETTERS},{set:["3d0","3d7","3f6",["1d26","1d2a"],"1d5e","1d60",["1d66","1d6a"]],type:K.IDENTIFIER,role:z.GREEKLETTER,font:J.NORMAL,secondary:tt.ALLLETTERS},{set:[["2135","2138"]],type:K.IDENTIFIER,role:z.OTHERLETTER,font:J.NORMAL,secondary:tt.ALLLETTERS},{set:["131","237"],type:K.IDENTIFIER,role:z.LATINLETTER,font:J.NORMAL},{set:["1d6a4","1d6a5"],type:K.IDENTIFIER,role:z.LATINLETTER,font:J.ITALIC},{set:["2113","2118"],type:K.IDENTIFIER,role:z.LATINLETTER,font:J.SCRIPT},{set:[["c0","d6"],["d8","f6"],["f8","1bf"],["1c4","2af"],["1d00","1d25"],["1d6b","1d9a"],["1e00","1ef9"],["363","36f"],["1dd3","1de6"],["1d62","1d65"],"1dca","2071","207f",["2090","209c"],"2c7c"],type:K.IDENTIFIER,role:z.LATINLETTER,font:J.NORMAL},{set:[["00bc","00be"],["2150","215f"],"2189"],type:K.NUMBER,role:z.FLOAT},{set:["23E8",["3248","324f"]],type:K.NUMBER,role:z.INTEGER},{set:[["214A","214C"],"2705","2713","2714","2717","2718"],type:K.IDENTIFIER,role:z.UNKNOWN},{set:["20","a0","ad",["2000","200f"],["2028","202f"],["205f","2060"],"206a","206b","206e","206f","feff",["fff9","fffb"]],type:K.TEXT,role:z.SPACE},{set:["7c","a6","2223","23b8","23b9","23d0","2758",["fe31","fe34"],"ff5c","ffe4","ffe8"],type:K.FENCE,role:z.NEUTRAL},{set:["2016","2225","2980","2af4"],type:K.FENCE,role:z.METRIC}].forEach((t=>{var{set:e}=t,n=Ze(t,["set"]);return sn(function(t){let e=[];for(const n of t)Array.isArray(n)?e=e.concat($(n)):e.push(String.fromCodePoint(parseInt(n,16)));return e}(e),n)})),on(rn.FencesVert,["23b4",["23dc","23e1"],["fe35","fe44"],"fe47"]),on(rn.FencesHoriz,["28","2045",["2308","230f"],["231c","231f"],"2329","23b0",["2768","2775"],"27c5",["27e6","27ef"],["2983","2998"],["29d8","29db"],"29fc",["2e22","2e29"],["3008","3011"],["3014","301b"],"fd3e","fe17",["fe59","fe5e"],"ff08","ff5f","ff62"]),on(rn.FencesHoriz,["5b","7b","ff3b","ff5b"],2),on(rn.FencesHoriz,[["239b","23a6"]],3),on(rn.FencesHoriz,[["23a7","23a9"]],4),sn([...rn.FencesHoriz.keys()],{type:K.FENCE,role:z.OPEN}),sn([...rn.FencesHoriz.values()],{type:K.FENCE,role:z.CLOSE}),sn([...rn.FencesVert.keys()],{type:K.FENCE,role:z.TOP}),sn([...rn.FencesVert.values()],{type:K.FENCE,role:z.BOTTOM}),function(){for(const[t,e]of Object.entries(J)){const n=!!_[t]?J.UNKNOWN:e===J.FULLWIDTH?J.NORMAL:e;an(P.LATINCAP,K.IDENTIFIER,z.LATINLETTER,e,n,[tt.ALLLETTERS]),an(P.LATINSMALL,K.IDENTIFIER,z.LATINLETTER,e,n,[tt.ALLLETTERS],{},{3:tt.D}),an(P.GREEKCAP,K.IDENTIFIER,z.GREEKLETTER,e,n,[tt.ALLLETTERS]),an(P.GREEKSMALL,K.IDENTIFIER,z.GREEKLETTER,e,n,[tt.ALLLETTERS],{0:{type:K.OPERATOR,role:z.PREFIXOP,font:n},26:{type:K.OPERATOR,role:z.PREFIXOP,font:n}}),an(P.DIGIT,K.NUMBER,z.INTEGER,e,n)}}(),sn(["inf","lim","liminf","limsup","max","min","sup","injlim","projlim"],{type:K.FUNCTION,role:z.LIMFUNC}),sn(cn,{type:K.FUNCTION,role:z.PREFIXFUNC}),sn(["mod","rem"],{type:K.OPERATOR,role:z.PREFIXFUNC});class ln{constructor(){this.rules=new Map}static parseUnicode(t){const e=parseInt(t,16);return String.fromCodePoint(e)}static testDynamicConstraints_(t,e){return E.getInstance().strict?e.cstr.equal(t):E.getInstance().comparator.match(e.cstr)}defineRulesFromMappings(t,e,n){for(const[r,s]of Object.entries(n))for(const[n,o]of Object.entries(s))this.defineRuleFromStrings(t,e,r,n,o)}getRules(t){let e=this.rules.get(t);return e||(e=[],this.rules.set(t,e)),e}defineRuleFromStrings(t,e,n,r,s){let o=this.getRules(t);const i=E.getInstance().parsers[n]||E.getInstance().defaultParser,c=E.getInstance().comparators[n],a=`${t}.${e}.${n}.${r}`,l=i.parse(a),u=c?c():E.getInstance().comparator,h=u.getReference();u.setReference(l);const d={cstr:l,action:s};o=o.filter((t=>!l.equal(t.cstr))),o.push(d),this.rules.set(t,o),u.setReference(h)}lookupRule(e,n){let r=this.getRules(n.getValue(t.LOCALE));return r=r.filter((function(t){return ln.testDynamicConstraints_(n,t)})),1===r.length?r[0]:r.length?r.sort(((t,e)=>E.getInstance().comparator.compare(t.cstr,e.cstr)))[0]:null}}let un=o.DEFAULT_VALUES[t.LOCALE],hn=o.DEFAULT_VALUES[t.MODALITY];function dn(t){return!(!t.locale&&!t.modality)&&(un=t.locale||un,hn=t.modality||hn,!0)}let fn={};function pn(t){fn=t}const mn=new Map,En=new Map;function gn(t,e){let n=mn.get(e);return n||(n=new ln,n.base=En.get(t),mn.set(e,n),n)}function Nn(t){const e=En.get(t.key);if(!e)return;const n=t.names;Object.assign(t,e),n&&e.names&&(t.names=t.names.concat(n))}function Sn(t,e,n){gn(t,e).defineRulesFromMappings(un,hn,n)}function Tn(t,e,n,r){gn(n,n).defineRuleFromStrings(un,hn,t,e,r)}function In(t){if(!dn(t))for(const[e,n]of Object.entries(t))Tn("default","default",e,n)}function An(t){for(let e,n=0;e=t.names[n];n++)Sn(t.key,e,t.mappings)}function Rn(t){for(const e of Object.keys(fn)){const n=Object.assign({},t);n.mappings={};const r=fn[e];n.names=n.names.map((function(t){return e+t}));for(const e of Object.keys(t.mappings)){n.mappings[e]={};for(const s of Object.keys(t.mappings[e]))n.mappings[e][s]=He[un]().FUNCTIONS.si(r,t.mappings[e][s])}An(n)}}function On(t={}){for(const e of mn.values())for(const[,n]of e.rules.entries())for(const{cstr:e}of n)t=Cn(e.getValues(),t);return t}function Cn(t,e){return e=e||{},t.length?(e[t[0]]=Cn(t.slice(1),e[t[0]]),e):e}E.getInstance().evaluator=function(t,e){const n=function(t,e){const n=mn.get(t);return n?n.lookupRule(null,e):null}(t,e);return n?n.action:null};class bn{constructor(t,e){this.speech=t,this.attributes=e}static empty(){return new bn("",{})}static stringEmpty(t){return new bn(t,{})}static stringAttr(t,e){return new bn(t,e)}static singleton(t,e={}){return[bn.stringAttr(t,e)]}static node(t,e,n={}){const r=bn.getAttributes(e);return Object.assign(r,n),new bn(t,r)}static getAttributes(t){const e={};for(const n of bn.attributeList)t.hasAttribute(n)&&(e[n]=t.getAttribute(n));return e}}bn.attributeList=["id","extid"];class Ln{constructor(t=null){this.data=t,this.prev=null,this.next=null}}class yn extends Set{constructor(t){super(),this.annotations=[],this.anchor=new Ln,this.anchor.next=this.anchor,this.anchor.prev=this.anchor,t.forEach((t=>{let e=new Ln(t);t.annotation&&this.annotations.push(e),this.push(e)}))}first(){return this.empty?null:this.anchor.next}last(){return this.empty?null:this.anchor.prev}push(t){t.next=this.anchor,t.prev=this.anchor.prev,t.prev.next=t,this.anchor.prev=t,super.add(t)}pop(){let t=this.last();return t?(this.delete(t),t):null}delete(t){return!!this.has(t)&&(super.delete(t),t.prev.next=t.next,t.next=t.prev,!0)}insertAfter(t,e){this.insertBefore(t,e.next)}insertBefore(t,e){let n=new Ln(t);e&&this.has(e)?(e.prev.next=n,n.prev=e.prev,n.next=e,e.prev=n):this.push(n)}prevText(t){do{t=t.prev}while(t!==this.anchor&&!t.data.text);return t===this.anchor?null:t}*[Symbol.iterator](){let t=this.anchor.next;for(;t!==this.anchor;)yield t,t=t.next}nextText(t){for(;t!==this.anchor&&!t.data.text;)t=t.next;return t}clear(){this.anchor.next=this.anchor,this.anchor.prev=this.anchor,super.clear()}empty(){return this.anchor.prev===this.anchor&&this.anchor===this.anchor.next}toList(){let t=[],e=this.anchor.next;for(;e!==this.anchor;)t.push(e.data),e=e.next;return t}}class Mn{static create(t,e={}){return t.text=mt.getInstance().apply(t.text,e),new Mn(t)}constructor({context:t,text:e,userValue:n,annotation:r,attributes:s,personality:o,layout:i}){this.context=t||"",this.text=e||"",this.userValue=n||"",this.annotation=r||"",this.attributes=s||{},this.personality=o||{},this.layout=i||""}isEmpty(){return 0===this.context.length&&0===this.text.length&&0===this.userValue.length&&0===this.annotation.length}clone(){let t,e;if(this.personality){t={};for(const[e,n]of Object.entries(this.personality))t[e]=n}if(this.attributes){e={};for(const[t,n]of Object.entries(this.attributes))e[t]=n}return new Mn({context:this.context,text:this.text,userValue:this.userValue,annotation:this.annotation,personality:t,attributes:e,layout:this.layout})}toString(){return'AuditoryDescription(context="'+this.context+'"  text="'+this.text+'"  userValue="'+this.userValue+'"  annotation="'+this.annotation+'")'}descriptionString(){return this.context&&this.text?this.context+" "+this.text:this.context||this.text}descriptionSpan(){return bn.stringAttr(this.descriptionString(),this.attributes)}equals(t){return this.context===t.context&&this.text===t.text&&this.userValue===t.userValue&&this.annotation===t.annotation}}const _n=new Map;function Pn(t,e,n){const r={};if(e){const t=_n.get(e)||{};Object.assign(r,t)}_n.set(t,Object.assign(r,n))}function Fn(t,e){const n=t.length;let r=0,s=e;return e||(s=""),function(){return r<n&&(r+=1),s+" "+r}}function Un(t,e){const n=parseFloat(e),r=isNaN(n)?e:n;return function(){return[Mn.create({text:"",personality:{pause:r}})]}}function xn(t,e){let n;return n=t.length>0?O("../../content/*",t[0]):[],function(){const t=n.shift(),r=e?[Mn.create({text:e},{translate:!0})]:[];if(!t)return r;const s=E.evaluateNode(t);return r.concat(s)}}class Dn{constructor(t,e,n){this.domain=t,this.name=e,this.func=n,this.active=!1}annotate(t){t.childNodes.forEach(this.annotate.bind(this)),t.contentNodes.forEach(this.annotate.bind(this)),t.addAnnotation(this.domain,this.func(t))}}class vn{constructor(t,e,n,r={}){this.domain=t,this.name=e,this.func=n,this.def=r,this.active=!1}visit(t,e){let n=this.func(t,e);t.addAnnotation(this.domain,n[0]);for(let e,r=0;e=t.childNodes[r];r++)n=this.visit(e,n[1]);for(let e,r=0;e=t.contentNodes[r];r++)n=this.visit(e,n[1]);return n}}const wn=new Map,Bn=new Map;function kn(t){const e=t.domain+":"+t.name;t instanceof Dn?wn.set(e,t):Bn.set(e,t)}function Gn(t,e){const n=t+":"+e,r=wn.get(n)||Bn.get(n);r&&(r.active=!0)}function Vn(t,e){const n=e.split("-"),r=Fn(t,n[0]||""),s=n[1]||"",o=n[2]||"";let i=!0;return function(){const t=r();return i?(i=!1,o+t+s):t+s}}function jn(t){return Wn(t)||function(t){return Hn(t)||t.type===K.INFIXOP&&t.role===z.IMPLICIT&&(2===t.childNodes.length&&(Hn(t.childNodes[0])||Wn(t.childNodes[0]))&&Hn(t.childNodes[1])||3===t.childNodes.length&&Wn(t.childNodes[0])&&Hn(t.childNodes[1])&&Hn(t.childNodes[2]))}(t)||function(t){return t.type===K.PUNCTUATED&&t.role===z.ENDPUNCT&&2===t.childNodes.length&&t.childNodes[1].role===z.DEGREE&&(Hn(t.childNodes[0])||Xn(t.childNodes[0])||t.childNodes[0].type===K.PREFIXOP&&t.childNodes[0].role===z.NEGATIVE&&(Hn(t.childNodes[0].childNodes[0])||Xn(t.childNodes[0].childNodes[0])))}(t)||function(t){return t.type===K.PREFIXOP&&t.role===z.NEGATIVE&&$n(t.childNodes[0])&&t.childNodes[0].type!==K.PREFIXOP&&t.childNodes[0].type!==K.APPL&&t.childNodes[0].type!==K.PUNCTUATED}(t)||function(t){return t.type===K.APPL&&(t.childNodes[0].role===z.PREFIXFUNC||t.childNodes[0].role===z.SIMPLEFUNC)&&($n(t.childNodes[1])||t.childNodes[1].type===K.FENCED&&$n(t.childNodes[1].childNodes[0]))}(t)}function $n(t){return t.hasAnnotation("clearspeak","simple")}function Hn(t){return t.type===K.IDENTIFIER&&(t.role===z.LATINLETTER||t.role===z.GREEKLETTER||t.role===z.OTHERLETTER||t.role===z.SIMPLEFUNC)}function Xn(t){return t.type===K.NUMBER&&(t.role===z.INTEGER||t.role===z.FLOAT)}function Wn(t){return Xn(t)||function(t){if(Yn("Fraction_Over")||Yn("Fraction_FracOver"))return!1;if(t.type!==K.FRACTION||t.role!==z.VULGAR)return!1;if(Yn("Fraction_Ordinal"))return!0;const e=parseInt(t.childNodes[0].textContent,10),n=parseInt(t.childNodes[1].textContent,10);return e>0&&e<20&&n>0&&n<11}(t)}function Yn(t){return E.getInstance().style===t}function Kn(t){if(function(t){if(!t.hasAttribute("annotation"))return!1;const e=t.getAttribute("annotation");return!!/clearspeak:simple$|clearspeak:simple;/.exec(e)}(t))return!0;if(t.tagName!==K.SUBSCRIPT)return!1;const e=t.childNodes[0].childNodes,n=e[1];return e[0].tagName===K.IDENTIFIER&&(qn(n)||n.tagName===K.INFIXOP&&n.hasAttribute("role")&&n.getAttribute("role")===z.IMPLICIT&&function(t){const e=O("children/*",t);return e.every((t=>qn(t)||t.tagName===K.IDENTIFIER))}(n))}function qn(t){return t.tagName===K.NUMBER&&t.hasAttribute("role")&&t.getAttribute("role")===z.INTEGER}function zn(t){return O(t.tagName===K.MATRIX?"children/row/children/cell/children/*":"children/line/children/*",t).every(Kn)?[t]:[]}function Qn(t){return it(t,20,11)?[t]:[]}function Jn(t){return t.type===K.TEXT&&t.role!==z.LABEL||t.type===K.PUNCTUATED&&t.role===z.TEXT&&Xn(t.childNodes[0])&&function(t){for(let e=0;e<t.length-1;e++)if(t[e].type!==K.TEXT||""!==t[e].textContent)return!1;return t[t.length-1].type===K.TEXT}(t.childNodes.slice(1))||t.type===K.IDENTIFIER&&t.role===z.UNIT||t.type===K.INFIXOP&&(t.role===z.IMPLICIT||t.role===z.UNIT)}function Zn(t){const e=parseInt(t.textContent,10);return[bn.stringEmpty(isNaN(e)?t.textContent:e>10?at.NUMBERS.numericOrdinal(e):at.NUMBERS.wordOrdinal(e))]}kn(new Dn("clearspeak","simple",(function(t){return jn(t)?"simple":""}))),kn(new Dn("clearspeak","unit",(function(t){return Jn(t)?"unit":""})));let tr=null;function er(t){let e=0;const n=t.textContent,r="open"===t.getAttribute("role")?0:1;let s=t.parentNode;for(;s;)s.tagName===K.FENCED&&s.childNodes[0].childNodes[r].textContent===n&&e++,s=s.parentNode;return tr=e>1?at.NUMBERS.wordOrdinal(e):"",[bn.stringEmpty(tr)]}function nr(t){const e=t.previousSibling;let n,r;return e?(n=e,r=t):(n=t,r=t.nextSibling),r&&function(t,e){const n=rn.Meaning.get(t);return n.type===K.FENCE&&(n.role===z.NEUTRAL||n.role===z.METRIC?t===e:rn.FencesHoriz.get(t)===e||rn.FencesVert.get(t)===e)}(n.textContent,r.textContent)?[t]:[]}function rr(t){const e=b(t.parentNode.childNodes),n=O("../../children/*",t),r=e.indexOf(t);return ir(n[r])||ir(n[r+1])?[t]:[]}function sr(t){const e=b(t.parentNode.childNodes),n=O("../../children/*",t),r=e.indexOf(t);return or(n[r])&&n[r+1]&&(or(n[r+1])||n[r+1].tagName===K.ROOT||n[r+1].tagName===K.SQRT||n[r+1].tagName===K.SUPERSCRIPT&&n[r+1].childNodes[0].childNodes[0]&&(n[r+1].childNodes[0].childNodes[0].tagName===K.NUMBER||n[r+1].childNodes[0].childNodes[0].tagName===K.IDENTIFIER)&&("2"===n[r+1].childNodes[0].childNodes[1].textContent||"3"===n[r+1].childNodes[0].childNodes[1].textContent))?[t]:[]}function or(t){return!!t&&(t.tagName===K.NUMBER||t.tagName===K.IDENTIFIER||t.tagName===K.FUNCTION||t.tagName===K.APPL||t.tagName===K.FRACTION)}function ir(t){return t&&(t.tagName===K.FENCED||t.hasAttribute("role")&&t.getAttribute("role")===z.LEFTRIGHT||function(t){return!!t&&(t.tagName===K.MATRIX||t.tagName===K.VECTOR)}(t))}function cr(t){return[bn.stringEmpty(at.NUMBERS.wordOrdinal(parseInt(t.textContent,10)))]}function ar(t,e){const n=[];for(;t.length||e.length;)t.length&&n.push(t.shift()),e.length&&n.push(e.shift());return n}function lr(t,e){return t?e?t.filter((t=>e.indexOf(t)<0)):t:[]}mt.getInstance().setCorrection("insertNesting",(function(t,e){if(!e||!t)return t;const n=t.match(/^(open|close) /);return n?n[0]+e+" "+t.substring(n[0].length):e+" "+t}));const ur={factory:null,updateFactory:function(t){ur.factory=t},heuristics:new Map,flags:{combine_juxtaposition:!0,convert_juxtaposition:!0,multioperator:!0},blacklist:{},add:function(t){const e=t.name;ur.heuristics.set(e,t),ur.flags[e]||(ur.flags[e]=!1)},run:function(t,e,n){const r=ur.heuristics.get(t);return r&&!ur.blacklist[t]&&(ur.flags[t]||r.applicable(e))?r.apply(e):n?n(e):e}},hr=[];function dr(t,e){for(let n,r=0;n=hr[r];r++){const r=n.compare(t,e);if(0!==r)return r}return 0}function fr(t){if(t.length<=1)return t;const e=t.slice();!function(t){t.sort(dr)}(e);const n=[];let r;do{r=e.pop(),n.push(r)}while(r&&e.length&&0===dr(e[e.length-1],r));return n}function pr(t,e){return t.match(/^.+:.+$/)||!e?t:t+":"+e}new class{constructor(t,e=null){this.comparator=t,this.type=e,function(t){hr.push(t)}(this)}compare(t,e){return this.type&&this.type===t.type&&this.type===e.type?this.comparator(t,e):0}}((function(t,e){return t.role===z.SIMPLEFUNC?1:e.role===z.SIMPLEFUNC?-1:0}),K.IDENTIFIER);class mr extends Map{set(t,e){return super.set(pr(t,e.font),e),this}setNode(t){this.set(t.textContent,t.meaning())}get(t,e=null){return super.get(pr(t,e))}getNode(t){return this.get(t.textContent,t.font)}}class Er extends Map{add(t,e){const n=this.get(t);n?n.push(e):super.set(t,[e])}get(t,e=null){return super.get(pr(t,e))}getNode(t){return this.get(t.textContent,t.font)}minimize(){for(const[t,e]of this)1===e.length&&this.delete(t)}isMultiValued(){for(const t of this.values())if(t.length>1)return!0;return!1}}class gr extends Er{add(t,e){super.add(pr(t,e.font),e)}addNode(t){this.add(t.textContent,t)}toString(){const t=[];for(const[e,n]of this){const r=Array(e.length+3).join(" "),s=n.map((t=>t.toString())).join("\n"+r);t.push(e+": "+s)}return t.join("\n")}collateMeaning(){const t=new Nr;for(const[e,n]of this)t.set(e,n.map((t=>t.meaning())));return t}}class Nr extends Er{add(t,e){const n=this.get(t,e.font);n&&n.find((function(t){return r=e,(n=t).type===r.type&&n.role===r.role&&n.font===r.font;var n,r}))||super.add(pr(t,e.font),e)}addNode(t){this.add(t.textContent,t.meaning())}toString(){const t=[];for(const[e,n]of this){const r=Array(e.length+3).join(" "),s=n.map((t=>`{type: ${t.type}, role: ${t.role}, font: ${t.font}}`)).join("\n"+r);t.push(e+": "+s)}return t.join("\n")}reduce(){for(const[t,e]of this)1!==e.length&&this.set(t,fr(e))}default(){const t=new mr;for(const[e,n]of this)1===n.length&&t.set(e,n[0]);return t}newDefault(){const t=this.default();this.reduce();const e=this.default();return t.size!==e.size?e:null}}var Sr;!function(t){t.ANNOTATION="ANNOTATION",t.ANNOTATIONXML="ANNOTATION-XML",t.MACTION="MACTION",t.MALIGNGROUP="MALIGNGROUP",t.MALIGNMARK="MALIGNMARK",t.MATH="MATH",t.MENCLOSE="MENCLOSE",t.MERROR="MERROR",t.MFENCED="MFENCED",t.MFRAC="MFRAC",t.MGLYPH="MGLYPH",t.MI="MI",t.MLABELEDTR="MLABELEDTR",t.MMULTISCRIPTS="MMULTISCRIPTS",t.MN="MN",t.MO="MO",t.MOVER="MOVER",t.MPADDED="MPADDED",t.MPHANTOM="MPHANTOM",t.MPRESCRIPTS="MPRESCRIPTS",t.MROOT="MROOT",t.MROW="MROW",t.MS="MS",t.MSPACE="MSPACE",t.MSQRT="MSQRT",t.MSTYLE="MSTYLE",t.MSUB="MSUB",t.MSUBSUP="MSUBSUP",t.MSUP="MSUP",t.MTABLE="MTABLE",t.MTD="MTD",t.MTEXT="MTEXT",t.MTR="MTR",t.MUNDER="MUNDER",t.MUNDEROVER="MUNDEROVER",t.NONE="NONE",t.SEMANTICS="SEMANTICS"}(Sr||(Sr={}));const Tr=[Sr.MO,Sr.MI,Sr.MN,Sr.MTEXT,Sr.MS,Sr.MSPACE],Ir=[Sr.MERROR,Sr.MPHANTOM,Sr.MALIGNGROUP,Sr.MALIGNMARK,Sr.MPRESCRIPTS,Sr.ANNOTATION,Sr.ANNOTATIONXML],Ar=[Sr.MATH,Sr.MROW,Sr.MPADDED,Sr.MACTION,Sr.NONE,Sr.MSTYLE,Sr.SEMANTICS],Rr=[Sr.MROOT,Sr.MSQRT],Or=["aria-label","exact-speech","alt"];function Cr(t){return!!t&&B(t)===Sr.MATH}function br(t){return!!t&&-1!==Ir.indexOf(B(t))}function Lr(t){return!!t&&-1!==Ar.indexOf(B(t))}function yr(t){return!!t&&B(t)===Sr.MGLYPH&&!function(t){return!!t&&-1!==Tr.indexOf(B(t))}(t.parentNode)}function Mr(t){const e=[];for(let n,r=0;n=t[r];r++){if(n.nodeType!==y.ELEMENT_NODE)continue;const t=B(n);-1===Ir.indexOf(t)&&(-1!==Ar.indexOf(t)&&0===n.childNodes.length||e.push(n))}return e}function _r(t,e){if(e.hasAttributes()){const n=e.attributes;for(let e=n.length-1;e>=0;e--){const r=n[e].name;r.match(/^ext/)&&(t.attributes[r]=n[e].value,t.nobreaking=!0),-1!==Or.indexOf(r)&&(t.attributes["ext-speech"]=n[e].value,t.nobreaking=!0),r.match(/texclass$/)&&(t.attributes.texclass=n[e].value),"data-latex"===r.toLowerCase()&&(t.attributes.latex=n[e].value),"href"===r&&(t.attributes.href=n[e].value,t.nobreaking=!0)}}}function Pr(t){return t&&t.embellished&&t.childNodes.length>0?Pr(t.childNodes[0]):t}function Fr(t,e,n){n&&t.reverse();const r=[];for(let s,o=0;s=t[o];o++){if(e(s))return n?{head:t.slice(o+1).reverse(),div:s,tail:r.reverse()}:{head:r,div:s,tail:t.slice(o+1)};r.push(s)}return n?{head:[],div:null,tail:r.reverse()}:{head:r,div:null,tail:[]}}function Ur(t,e){let n=t;const r=[],s=[];let o=null;do{o=Fr(n,e),s.push(o.head),r.push(o.div),n=o.tail}while(o.div);return r.pop(),{rel:r,comp:s}}class xr{static fromXml(t){const e=parseInt(t.getAttribute("id"),10),n=new xr(e);return n.type=t.tagName,xr.setAttribute(n,t,"role"),xr.setAttribute(n,t,"font"),xr.setAttribute(n,t,"embellished"),xr.setAttribute(n,t,"fencepointer","fencePointer"),t.getAttribute("annotation")&&n.parseAnnotation(t.getAttribute("annotation")),_r(n,t),xr.processChildren(n,t),n}static setAttribute(t,e,n,r){r=r||n;const s=e.getAttribute(n);s&&(t[r]=s)}static processChildren(t,e){for(const n of b(e.childNodes)){if(n.nodeType===y.TEXT_NODE){t.textContent=n.textContent;continue}const e=b(n.childNodes).map(xr.fromXml);e.forEach((e=>e.parent=t)),"CONTENT"===B(n)?t.contentNodes=e:t.childNodes=e}}constructor(t){this.id=t,this.mathml=[],this.parent=null,this.type=K.UNKNOWN,this.role=z.UNKNOWN,this.font=J.UNKNOWN,this.embellished=null,this.fencePointer="",this.childNodes=[],this.textContent="",this.mathmlTree=null,this.contentNodes=[],this.annotation={},this.attributes={},this.nobreaking=!1}querySelectorAll(t){let e=[];for(let n,r=0;n=this.childNodes[r];r++)e=e.concat(n.querySelectorAll(t));for(let n,r=0;n=this.contentNodes[r];r++)e=e.concat(n.querySelectorAll(t));return t(this)&&e.unshift(this),e}xml(t,e){const n=function(n,r){const s=r.map((function(n){return n.xml(t,e)})),o=t.createElementNS("",n);for(let t,e=0;t=s[e];e++)o.appendChild(t);return o},r=t.createElementNS("",this.type);return e||this.xmlAttributes(r),r.textContent=this.textContent,this.contentNodes.length>0&&r.appendChild(n("content",this.contentNodes)),this.childNodes.length>0&&r.appendChild(n("children",this.childNodes)),r}toString(t=!1){const e=L("<snode/>");return G(this.xml(e.ownerDocument,t))}allAttributes(){const t=[];return t.push(["role",this.role]),this.font!==J.UNKNOWN&&t.push(["font",this.font]),Object.keys(this.annotation).length&&t.push(["annotation",this.annotationXml()]),this.embellished&&t.push(["embellished",this.embellished]),this.fencePointer&&t.push(["fencepointer",this.fencePointer]),t.push(["id",this.id.toString()]),t}annotationXml(){const t=[];for(const[e,n]of Object.entries(this.annotation))n.forEach((n=>t.push(e+":"+n)));return t.join(";")}attributesXml(){const t=[];for(const[e,n]of Object.entries(this.attributes))t.push(e+":"+xr.escapeValue(n));return t.join(";")}toJson(){const t={};t.type=this.type;const e=this.allAttributes();for(let n,r=0;n=e[r];r++)t[n[0]]=n[1].toString();return this.textContent&&(t.$t=this.textContent),this.childNodes.length&&(t.children=this.childNodes.map((function(t){return t.toJson()}))),this.contentNodes.length&&(t.content=this.contentNodes.map((function(t){return t.toJson()}))),t}updateContent(t,e){const n=e?t.replace(/^[ \f\n\r\t\v\u200b]*/,"").replace(/[ \f\n\r\t\v\u200b]*$/,""):t.trim();if(t=t&&!n?t:n,this.textContent===t)return;const r=rn.Meaning.get(t.replace(/\s/g," "));this.textContent=t,this.role=r.role,this.type=r.type,this.font=r.font}addMathmlNodes(t){for(let e,n=0;e=t[n];n++)-1===this.mathml.indexOf(e)&&this.mathml.push(e)}appendChild(t){this.childNodes.push(t),this.addMathmlNodes(t.mathml),t.parent=this}replaceChild(t,e){const n=this.childNodes.indexOf(t);if(-1===n)return;t.parent=null,e.parent=this,this.childNodes[n]=e;const r=t.mathml.filter((function(t){return-1===e.mathml.indexOf(t)})),s=e.mathml.filter((function(e){return-1===t.mathml.indexOf(e)}));this.removeMathmlNodes(r),this.addMathmlNodes(s)}appendContentNode(t){t&&(this.contentNodes.push(t),this.addMathmlNodes(t.mathml),t.parent=this)}removeContentNode(t){if(t){const e=this.contentNodes.indexOf(t);-1!==e&&this.contentNodes.slice(e,1)}}equals(t){if(!t)return!1;if(this.type!==t.type||this.role!==t.role||this.textContent!==t.textContent||this.childNodes.length!==t.childNodes.length||this.contentNodes.length!==t.contentNodes.length)return!1;for(let e,n,r=0;e=this.childNodes[r],n=t.childNodes[r];r++)if(!e.equals(n))return!1;for(let e,n,r=0;e=this.contentNodes[r],n=t.contentNodes[r];r++)if(!e.equals(n))return!1;return!0}displayTree(){console.info(this.displayTree_(0))}addAnnotation(t,e){e&&this.addAnnotation_(t,e)}getAnnotation(t){const e=this.annotation[t];return e||[]}hasAnnotation(t,e){const n=this.annotation[t];return!!n&&-1!==n.indexOf(e)}parseAnnotation(t){const e=t.split(";");for(let t=0,n=e.length;t<n;t++){const n=e[t].split(":");this.addAnnotation(n[0],n[1])}}meaning(){return{type:this.type,role:this.role,font:this.font}}xmlAttributes(t){const e=this.allAttributes();for(let n,r=0;n=e[r];r++)t.setAttribute(n[0],n[1]);this.addExternalAttributes(t)}addExternalAttributes(t){for(const[e,n]of Object.entries(this.attributes))t.setAttribute(e,n)}static escapeValue(t){return t.replace(/;/g,"\\0003B")}parseAttributes(t){if(!t)return;const e=t.split(";");for(let t=0,n=e.length;t<n;t++){const[n,...r]=e[t].split(":");n&&(this.attributes[n]=r.join("").replace(/\\0003B/g,";"))}}removeMathmlNodes(t){const e=this.mathml;for(let n,r=0;n=t[r];r++){const t=e.indexOf(n);-1!==t&&e.splice(t,1)}this.mathml=e}displayTree_(t){t++;const e=Array(t).join("  ");let n="";n+="\n"+e+this.toString(),n+="\n"+e+"MathmlTree:",n+="\n"+e+this.mathmlTreeString(),n+="\n"+e+"MathML:";for(let t,r=0;t=this.mathml[r];r++)n+="\n"+e+t.toString();return n+="\n"+e+"Begin Content",this.contentNodes.forEach((function(e){n+=e.displayTree_(t)})),n+="\n"+e+"End Content",n+="\n"+e+"Begin Children",this.childNodes.forEach((function(e){n+=e.displayTree_(t)})),n+="\n"+e+"End Children",n}mathmlTreeString(){return this.mathmlTree?this.mathmlTree.toString():"EMPTY"}addAnnotation_(t,e){const n=this.annotation[t];n&&!n.includes(e)?n.push(e):this.annotation[t]=[e]}}class Dr{constructor(){this.leafMap=new gr,this.defaultMap=new mr,this.idCounter_=-1}makeNode(t){return this.createNode_(t)}makeUnprocessed(t){const e=this.createNode_();return e.mathml=[t],e.mathmlTree=t,e}makeEmptyNode(){const t=this.createNode_();return t.type=K.EMPTY,t}makeContentNode(t){const e=this.createNode_();return e.updateContent(t),e}makeMultipleContentNodes(t,e){const n=[];for(let r=0;r<t;r++)n.push(this.makeContentNode(e));return n}makeLeafNode(t,e){if(!t)return this.makeEmptyNode();const n=this.makeContentNode(t);n.font=e||n.font;const r=this.defaultMap.getNode(n);return r&&(n.type=r.type,n.role=r.role,n.font=r.font),this.leafMap.addNode(n),n}makeBranchNode(t,e,n,r){const s=this.createNode_();return r&&s.updateContent(r),s.type=t,s.childNodes=e,s.contentNodes=n,e.concat(n).forEach((function(t){t.parent=s,s.addMathmlNodes(t.mathml)})),s}createNode_(t){return void 0!==t?this.idCounter_=Math.max(this.idCounter_,t):t=++this.idCounter_,new xr(t)}}function vr(t,e){return t.type===e}function wr(t,e){return t.embellished===e}function Br(t,e){return t.role===e}function kr(t){return vr(t,K.FENCE)||vr(t,K.PUNCTUATION)||vr(t,K.OPERATOR)||vr(t,K.RELATION)}function Gr(t){return Wr(t)&&!Br(t,z.DIVISION)||vr(t,K.APPL)||Hr(t)}function Vr(t){return Wr(t)||Hr(t)}function jr(t,e){return!!e&&vr(e,K.IDENTIFIER)&&rn.Secondary.has(t.textContent,tt.D)}function $r(t){if(vr(t,K.IDENTIFIER)){const e=t.textContent[0];return e&&t.textContent[1]&&rn.Secondary.has(e,tt.D)}return!1}function Hr(t){return Yr(t)||Kr(t)}function Xr(t){return t.embellished?t.embellished:(e=t.type)===K.OPERATOR||e===K.RELATION||e===K.FENCE||e===K.PUNCTUATION?t.type:null;var e}function Wr(t){return vr(t,K.OPERATOR)||wr(t,K.OPERATOR)}function Yr(t){return vr(t,K.RELATION)||wr(t,K.RELATION)}function Kr(t){return vr(t,K.PUNCTUATION)||wr(t,K.PUNCTUATION)}function qr(t){return vr(t,K.FENCE)||wr(t,K.FENCE)}function zr(t){return!(!t||!qr(t))&&(!t.embellished||Qr(t))}function Qr(t){return!t.embellished||!function(t){return vr(t,K.TENSOR)&&(!vr(t.childNodes[1],K.EMPTY)||!vr(t.childNodes[2],K.EMPTY))&&(!vr(t.childNodes[3],K.EMPTY)||!vr(t.childNodes[4],K.EMPTY))}(t)&&((!Br(t,z.CLOSE)||!vr(t,K.TENSOR))&&((!Br(t,z.OPEN)||!vr(t,K.SUBSCRIPT)&&!vr(t,K.SUPERSCRIPT))&&Qr(t.childNodes[0])))}function Jr(t){return!!t&&(vr(t,K.TABLE)||vr(t,K.MULTILINE))}function Zr(t){return!!t&&ts(t)&&Jr(t.childNodes[0])}function ts(t){return!!t&&vr(t,K.FENCED)&&(Br(t,z.LEFTRIGHT)||ps(t))&&1===t.childNodes.length}function es(t,e){return e.length>0&&Br(e[e.length-1],z.OPENFENCE)}function ns(t){return t.childNodes.every((function(t){return t.childNodes.length<=1}))}function rs(t){return vr(t,K.LARGEOP)||vr(t,K.LIMBOTH)||vr(t,K.LIMLOWER)||vr(t,K.LIMUPPER)||vr(t,K.FUNCTION)&&Br(t,z.LIMFUNC)||(vr(t,K.OVERSCORE)||vr(t,K.UNDERSCORE))&&rs(t.childNodes[0])}function ss(t,e,n){return 1===e.length&&(t[n].type===K.PUNCTUATION||t[n].embellished===K.PUNCTUATION)&&t[n]===e[0]}function os(t){return vr(t,K.IDENTIFIER)&&Br(t,z.SIMPLEFUNC)}const is=[K.PUNCTUATION,K.PUNCTUATED,K.RELSEQ,K.MULTIREL,K.TABLE,K.MULTILINE,K.CASES,K.INFERENCE],cs=[K.LIMUPPER,K.LIMLOWER,K.LIMBOTH,K.SUBSCRIPT,K.SUPERSCRIPT,K.UNDERSCORE,K.OVERSCORE,K.TENSOR];function as(t){const e=t.type;return-1===is.indexOf(e)&&(e!==K.INFIXOP||t.role===z.IMPLICIT)&&(e===K.FENCED?t.role!==z.LEFTRIGHT||as(t.childNodes[0]):-1===cs.indexOf(e)||as(t.childNodes[0]))}function ls(t){return function(t){return t.type===K.NUMBER&&(t.role===z.INTEGER||t.role===z.FLOAT)}(t)||t.role===z.VULGAR||t.role===z.MIXED}function us(t){const e=t.childNodes;return t.role===z.UNIT&&(!e.length||e[0].role===z.UNIT)}function hs(t){const e=t.childNodes;return t.type===K.INFIXOP&&(t.role===z.MULTIPLICATION||t.role===z.IMPLICIT)&&e.length&&(us(e[0])||ls(e[0]))&&t.childNodes.slice(1).every(us)}function ds(t){return t.type===K.INFIXOP&&(t.role===z.IMPLICIT||t.role===z.UNIT&&!!t.contentNodes.length&&t.contentNodes[0].textContent===tn.invisibleTimes)}function fs(t){return t.type===K.INFIXOP&&t.role===z.IMPLICIT}function ps(t){return t.role===z.NEUTRAL||t.role===z.METRIC}function ms(t,e){return ps(t)&&ps(e)&&Pr(t).textContent===Pr(e).textContent}function Es(t){return!!ps(t)&&(!t.embellished||t.type!==K.SUPERSCRIPT&&t.type!==K.SUBSCRIPT&&(t.type!==K.TENSOR||t.childNodes[3].type===K.EMPTY&&t.childNodes[4].type===K.EMPTY))}function gs(t){return!!ps(t)&&(!t.embellished||(t.type!==K.TENSOR||t.childNodes[1].type===K.EMPTY&&t.childNodes[2].type===K.EMPTY))}class Ns{static getInstance(){return Ns.instance=Ns.instance||new Ns,Ns.instance}static tableToMultiline(t){if(!ns(t))return ur.run("rewrite_subcases",t,Ns.classifyTable);t.type=K.MULTILINE;for(let e,n=0;e=t.childNodes[n];n++)Ns.rowToLine_(e,z.MULTILINE);var e;return 1!==t.childNodes.length||vr(e=t.childNodes[0],K.LINE)&&e.contentNodes.length&&Br(e.contentNodes[0],z.LABEL)||!ts(t.childNodes[0].childNodes[0])||Ns.tableToMatrixOrVector_(Ns.rewriteFencedLine_(t)),Ns.binomialForm_(t),Ns.classifyMultiline(t),t}static number(t){t.type!==K.UNKNOWN&&t.type!==K.IDENTIFIER||(t.type=K.NUMBER),Ns.meaningFromContent(t,Ns.numberRole_),Ns.exprFont_(t)}static classifyMultiline(t){let e=0;const n=t.childNodes.length;let r;for(;e<n&&(!(r=t.childNodes[e])||!r.childNodes.length);)e++;if(e>=n)return;const s=r.childNodes[0].role;s!==z.UNKNOWN&&t.childNodes.every((function(t){const e=t.childNodes[0];return!e||e.role===s&&(vr(e,K.RELATION)||vr(e,K.RELSEQ))}))&&(t.role=s)}static classifyTable(t){const e=Ns.computeColumns_(t);return Ns.classifyByColumns_(t,e,z.EQUALITY)||Ns.classifyByColumns_(t,e,z.INEQUALITY,[z.EQUALITY])||Ns.classifyByColumns_(t,e,z.ARROW)||Ns.detectCaleyTable(t),t}static detectCaleyTable(t){if(!t.mathmlTree)return!1;const e=t.mathmlTree,n=e.getAttribute("columnlines"),r=e.getAttribute("rowlines");return!(!n||!r)&&(!(!Ns.cayleySpacing(n)||!Ns.cayleySpacing(r))&&(t.role=z.CAYLEY,!0))}static cayleySpacing(t){const e=t.split(" ");return("solid"===e[0]||"dashed"===e[0])&&e.slice(1).every((t=>"none"===t))}static proof(t,e,n){const r=Ns.separateSemantics(e);return Ns.getInstance().proof(t,r,n)}static findSemantics(t,e,n){const r=null==n?null:n,s=Ns.getSemantics(t);return!!s&&(!!s[e]&&(null==r||s[e]===r))}static getSemantics(t){const e=t.getAttribute("semantics");return e?Ns.separateSemantics(e):null}static removePrefix(t){const[,...e]=t.split("_");return e.join("_")}static separateSemantics(t){const e={};return t.split(";").forEach((function(t){const[n,r]=t.split(":");e[Ns.removePrefix(n)]=r})),e}static matchSpaces_(t,e){for(let n,r=0;n=e[r];r++){const e=t[r].mathmlTree,s=t[r+1].mathmlTree;if(!e||!s)continue;const o=e.nextSibling;if(!o||o===s)continue;const i=Ns.getSpacer_(o);i&&(n.mathml.push(i),n.mathmlTree=i,n.role=z.SPACE)}}static getSpacer_(t){if(B(t)===Sr.MSPACE)return t;for(;Lr(t)&&1===t.childNodes.length;)if(B(t=t.childNodes[0])===Sr.MSPACE)return t;return null}static fenceToPunct_(t){const e=Ns.FENCE_TO_PUNCT_[t.role];if(e){for(;t.embellished;)t.embellished=K.PUNCTUATION,Br(t,z.SUBSUP)||Br(t,z.UNDEROVER)||(t.role=e),t=t.childNodes[0];t.type=K.PUNCTUATION,t.role=e}}static classifyFunction_(t,e){if(t.type===K.APPL||t.type===K.BIGOP||t.type===K.INTEGRAL)return"";if(e[0]&&e[0].textContent===tn.functionApplication){Ns.getInstance().funcAppls[t.id]=e.shift();let n=z.SIMPLEFUNC;return ur.run("simple2prefix",t),t.role!==z.PREFIXFUNC&&t.role!==z.LIMFUNC||(n=t.role),Ns.propagateFunctionRole_(t,n),"prefix"}const n=Ns.CLASSIFY_FUNCTION_[t.role];return n||((r=t).type===K.IDENTIFIER||r.role===z.LATINLETTER||r.role===z.GREEKLETTER||r.role===z.OTHERLETTER?"simple":"");var r}static propagateFunctionRole_(t,e){if(t){if(t.type===K.INFIXOP)return;Br(t,z.SUBSUP)||Br(t,z.UNDEROVER)||(t.role=e),Ns.propagateFunctionRole_(t.childNodes[0],e)}}static getFunctionOp_(t,e){if(e(t))return t;for(let n,r=0;n=t.childNodes[r];r++){const t=Ns.getFunctionOp_(n,e);if(t)return t}return null}static tableToMatrixOrVector_(t){const e=t.childNodes[0];vr(e,K.MULTILINE)?Ns.tableToVector_(t):Ns.tableToMatrix_(t),t.contentNodes.forEach(e.appendContentNode.bind(e));for(let t,n=0;t=e.childNodes[n];n++)Ns.assignRoleToRow_(t,Ns.getComponentRoles_(e));return e.parent=null,e}static tableToVector_(t){const e=t.childNodes[0];e.type=K.VECTOR,1!==e.childNodes.length?Ns.binomialForm_(e):Ns.tableToSquare_(t)}static binomialForm_(t){Br(t,z.UNKNOWN)&&(2===t.childNodes.length&&(t.role=z.BINOMIAL,t.childNodes[0].role=z.BINOMIAL,t.childNodes[1].role=z.BINOMIAL))}static tableToMatrix_(t){const e=t.childNodes[0];e.type=K.MATRIX,e.childNodes&&e.childNodes.length>0&&e.childNodes[0].childNodes&&e.childNodes.length===e.childNodes[0].childNodes.length?Ns.tableToSquare_(t):e.childNodes&&1===e.childNodes.length&&(e.role=z.ROWVECTOR)}static tableToSquare_(t){const e=t.childNodes[0];Br(e,z.UNKNOWN)&&(ps(t)?e.role=z.DETERMINANT:e.role=z.SQUAREMATRIX)}static getComponentRoles_(t){const e=t.role;return e&&e!==z.UNKNOWN?e:t.type.toLowerCase()||z.UNKNOWN}static tableToCases_(t,e){for(let e,n=0;e=t.childNodes[n];n++)Ns.assignRoleToRow_(e,z.CASES);return t.type=K.CASES,t.appendContentNode(e),ns(t)&&Ns.binomialForm_(t),t}static rewriteFencedLine_(t){const e=t.childNodes[0],n=t.childNodes[0].childNodes[0],r=t.childNodes[0].childNodes[0].childNodes[0];return n.parent=t.parent,t.parent=n,r.parent=e,n.childNodes=[t],e.childNodes=[r],n}static rowToLine_(t,e){const n=e||z.UNKNOWN;vr(t,K.ROW)&&(t.type=K.LINE,t.role=n,1===t.childNodes.length&&vr(t.childNodes[0],K.CELL)&&(t.childNodes=t.childNodes[0].childNodes,t.childNodes.forEach((function(e){e.parent=t}))))}static assignRoleToRow_(t,e){vr(t,K.LINE)?t.role=e:vr(t,K.ROW)&&(t.role=e,t.childNodes.forEach((function(t){vr(t,K.CELL)&&(t.role=e)})))}static nextSeparatorFunction_(t){let e;if(t){if(t.match(/^\s+$/))return null;e=t.replace(/\s/g,"").split("").filter((function(t){return t}))}else e=[","];return function(){return e.length>1?e.shift():e[0]}}static meaningFromContent(t,e){const n=[...t.textContent].filter((t=>t.match(/[^\s]/))),r=n.map((t=>rn.Meaning.get(t)));e(t,n,r)}static numberRole_(t,e,n){if(t.role===z.UNKNOWN)return n.every((function(t){return t.type===K.NUMBER&&t.role===z.INTEGER||t.type===K.PUNCTUATION&&t.role===z.COMMA}))?(t.role=z.INTEGER,void("0"===e[0]&&t.addAnnotation("general","basenumber"))):void(n.every((function(t){return t.type===K.NUMBER&&t.role===z.INTEGER||t.type===K.PUNCTUATION}))?t.role=z.FLOAT:t.role=z.OTHERNUMBER)}static exprFont_(t){t.font===J.UNKNOWN&&Ns.compSemantics(t,"font",J)}static compSemantics(t,e,n){const r=[...t.textContent].map((t=>rn.Meaning.get(t))).reduce((function(t,r){return t&&r[e]&&r[e]!==n.UNKNOWN&&r[e]!==t?t===n.UNKNOWN?r[e]:null:t}),n.UNKNOWN);r&&(t[e]=r)}static purgeFences_(t){const e=t.rel,n=t.comp,r=[],s=[];for(;e.length>0;){const t=e.shift();let o=n.shift();zr(t)?(r.push(t),s.push(o)):(Ns.fenceToPunct_(t),o.push(t),o=o.concat(n.shift()),n.unshift(o))}return s.push(n.shift()),{rel:r,comp:s}}static rewriteFencedNode_(t){const e=t.contentNodes[0],n=t.contentNodes[1];let r=Ns.rewriteFence_(t,e);return t.contentNodes[0]=r.fence,r=Ns.rewriteFence_(r.node,n),t.contentNodes[1]=r.fence,t.contentNodes[0].parent=t,t.contentNodes[1].parent=t,r.node.parent=null,r.node}static rewriteFence_(t,e){if(!e.embellished)return{node:t,fence:e};const n=e.childNodes[0],r=Ns.rewriteFence_(t,n);return vr(e,K.SUPERSCRIPT)||vr(e,K.SUBSCRIPT)||vr(e,K.TENSOR)?(Br(e,z.SUBSUP)||(e.role=t.role),n!==r.node&&(e.replaceChild(n,r.node),n.parent=t),Ns.propagateFencePointer_(e,n),{node:e,fence:r.fence}):(e.replaceChild(n,r.fence),e.mathmlTree&&-1===e.mathml.indexOf(e.mathmlTree)&&e.mathml.push(e.mathmlTree),{node:r.node,fence:e})}static propagateFencePointer_(t,e){t.fencePointer=e.fencePointer||e.id.toString(),t.embellished=null}static classifyByColumns_(t,e,n,r=[]){const s=[n].concat(r);return!!(3===e.length&&Ns.testColumns_(e,1,(t=>Ns.isPureRelation_(t,s)))||2===e.length&&(Ns.testColumns_(e,1,(t=>Ns.isEndRelation_(t,s)||Ns.isPureRelation_(t,s)))||Ns.testColumns_(e,0,(t=>Ns.isEndRelation_(t,s,!0)||Ns.isPureRelation_(t,s)))))&&(t.role=n,!0)}static isEndRelation_(t,e,n){const r=n?t.childNodes.length-1:0;return vr(t,K.RELSEQ)&&e.some((e=>Br(t,e)))&&vr(t.childNodes[r],K.EMPTY)}static isPureRelation_(t,e){return vr(t,K.RELATION)&&e.some((e=>Br(t,e)))}static computeColumns_(t){const e=[];for(let n,r=0;n=t.childNodes[r];r++)for(let t,r=0;t=n.childNodes[r];r++){e[r]?e[r].push(t):e[r]=[t]}return e}static testColumns_(t,e,n){const r=t[e];return!!r&&(r.some((function(t){return t.childNodes.length&&n(t.childNodes[0])}))&&r.every((function(t){return!t.childNodes.length||n(t.childNodes[0])})))}setNodeFactory(t){Ns.getInstance().factory_=t,ur.updateFactory(Ns.getInstance().factory_)}getNodeFactory(){return Ns.getInstance().factory_}identifierNode(t,e,n){if("MathML-Unit"===n)t.type=K.IDENTIFIER,t.role=z.UNIT;else if(!e&&1===t.textContent.length&&(t.role===z.INTEGER||t.role===z.LATINLETTER||t.role===z.GREEKLETTER)&&t.font===J.NORMAL)return t.font=J.ITALIC,ur.run("simpleNamedFunction",t);return t.type===K.UNKNOWN&&(t.type=K.IDENTIFIER),Ns.exprFont_(t),ur.run("simpleNamedFunction",t)}implicitNode(t){if(t=Ns.getInstance().getMixedNumbers_(t),1===(t=Ns.getInstance().combineUnits_(t)).length)return t[0];const e=Ns.getInstance().implicitNode_(t);return ur.run("combine_juxtaposition",e)}text(t,e){return Ns.exprFont_(t),t.type=K.TEXT,e===Sr.ANNOTATIONXML?(t.role=z.ANNOTATION,t):e===Sr.MS?(t.role=z.STRING,t):e===Sr.MSPACE||t.textContent.match(/^\s*$/)?(t.role=z.SPACE,t):/\s/.exec(t.textContent)?(t.role=z.TEXT,t):(t.role=z.UNKNOWN,t)}row(t){return 0===(t=t.filter((function(t){return!vr(t,K.EMPTY)}))).length?Ns.getInstance().factory_.makeEmptyNode():(t=Ns.getInstance().getFencesInRow_(t),t=Ns.getInstance().tablesInRow(t),t=Ns.getInstance().getPunctuationInRow_(t),t=Ns.getInstance().getTextInRow_(t),t=Ns.getInstance().getFunctionsInRow_(t),Ns.getInstance().relationsInRow_(t))}limitNode(t,e){if(!e.length)return Ns.getInstance().factory_.makeEmptyNode();let n,r=e[0],s=K.UNKNOWN;if(!e[1])return r;if(ur.run("op_with_limits",e),rs(r)){n=Ns.MML_TO_LIMIT_[t];const o=n.length;if(s=n.type,e=e.slice(0,n.length+1),1===o&&kr(e[1])||2===o&&kr(e[1])&&kr(e[2]))return n=Ns.MML_TO_BOUNDS_[t],Ns.getInstance().accentNode_(r,e,n.type,n.length,n.accent);if(2===o){if(kr(e[1]))return r=Ns.getInstance().accentNode_(r,[r,e[1]],{MSUBSUP:K.SUBSCRIPT,MUNDEROVER:K.UNDERSCORE}[t],1,!0),e[2]?Ns.getInstance().makeLimitNode_(r,[r,e[2]],null,K.LIMUPPER):r;if(e[2]&&kr(e[2]))return r=Ns.getInstance().accentNode_(r,[r,e[2]],{MSUBSUP:K.SUPERSCRIPT,MUNDEROVER:K.OVERSCORE}[t],1,!0),Ns.getInstance().makeLimitNode_(r,[r,e[1]],null,K.LIMLOWER);e[o]||(s=K.LIMLOWER)}return Ns.getInstance().makeLimitNode_(r,e,null,s)}return n=Ns.MML_TO_BOUNDS_[t],Ns.getInstance().accentNode_(r,e,n.type,n.length,n.accent)}tablesInRow(t){let e=Ur(t,Zr),n=[];for(let t,r=0;t=e.rel[r];r++)n=n.concat(e.comp.shift()),n.push(Ns.tableToMatrixOrVector_(t));n=n.concat(e.comp.shift()),e=Ur(n,Jr),n=[];for(let t,r=0;t=e.rel[r];r++){const r=e.comp.shift();es(0,r)&&Ns.tableToCases_(t,r.pop()),n=n.concat(r),n.push(t)}return n.concat(e.comp.shift())}mfenced(t,e,n,r){if(n&&r.length>0){const t=Ns.nextSeparatorFunction_(n),e=[r.shift()];r.forEach((n=>{e.push(Ns.getInstance().factory_.makeContentNode(t())),e.push(n)})),r=e}return t&&e?Ns.getInstance().horizontalFencedNode_(Ns.getInstance().factory_.makeContentNode(t),Ns.getInstance().factory_.makeContentNode(e),r):(t&&r.unshift(Ns.getInstance().factory_.makeContentNode(t)),e&&r.push(Ns.getInstance().factory_.makeContentNode(e)),Ns.getInstance().row(r))}fractionLikeNode(t,e,n,r){let s;if(!r&&function(t){if(!t)return!1;if(-1!==["negativeveryverythinmathspace","negativeverythinmathspace","negativethinmathspace","negativemediummathspace","negativethickmathspace","negativeverythickmathspace","negativeveryverythickmathspace"].indexOf(t))return!0;const e=t.match(/[0-9.]+/);return!!e&&0===parseFloat(e[0])}(n)){const n=Ns.getInstance().factory_.makeBranchNode(K.LINE,[t],[]),r=Ns.getInstance().factory_.makeBranchNode(K.LINE,[e],[]);return s=Ns.getInstance().factory_.makeBranchNode(K.MULTILINE,[n,r],[]),Ns.binomialForm_(s),Ns.classifyMultiline(s),s}return s=Ns.getInstance().fractionNode_(t,e),r&&s.addAnnotation("general","bevelled"),s}tensor(t,e,n,r,s){const o=Ns.getInstance().factory_.makeBranchNode(K.TENSOR,[t,Ns.getInstance().scriptNode_(e,z.LEFTSUB),Ns.getInstance().scriptNode_(n,z.LEFTSUPER),Ns.getInstance().scriptNode_(r,z.RIGHTSUB),Ns.getInstance().scriptNode_(s,z.RIGHTSUPER)],[]);return o.role=t.role,o.embellished=Xr(t),o}pseudoTensor(t,e,n){const r=t=>!vr(t,K.EMPTY),s=e.filter(r).length,o=n.filter(r).length;if(!s&&!o)return t;const i=s?o?Sr.MSUBSUP:Sr.MSUB:Sr.MSUP,c=[t];return s&&c.push(Ns.getInstance().scriptNode_(e,z.RIGHTSUB,!0)),o&&c.push(Ns.getInstance().scriptNode_(n,z.RIGHTSUPER,!0)),Ns.getInstance().limitNode(i,c)}font(t){const e=Ns.MATHJAX_FONTS[t];return e||t}proof(t,e,n){if(e.inference||e.axiom||console.log("Noise"),e.axiom){const e=Ns.getInstance().cleanInference(t.childNodes),r=e.length?Ns.getInstance().factory_.makeBranchNode(K.INFERENCE,n(e),[]):Ns.getInstance().factory_.makeEmptyNode();return r.role=z.AXIOM,r.mathmlTree=t,r}const r=Ns.getInstance().inference(t,e,n);return e.proof&&(r.role=z.PROOF,r.childNodes[0].role=z.FINAL),r}inference(t,e,n){if(e.inferenceRule){const e=Ns.getInstance().getFormulas(t,[],n);return Ns.getInstance().factory_.makeBranchNode(K.INFERENCE,[e.conclusion,e.premises],[])}const r=e.labelledRule,s=b(t.childNodes),o=[];"left"!==r&&"both"!==r||o.push(Ns.getInstance().getLabel(t,s,n,z.LEFT)),"right"!==r&&"both"!==r||o.push(Ns.getInstance().getLabel(t,s,n,z.RIGHT));const i=Ns.getInstance().getFormulas(t,s,n),c=Ns.getInstance().factory_.makeBranchNode(K.INFERENCE,[i.conclusion,i.premises],o);return c.mathmlTree=t,c}getLabel(t,e,n,r){const s=Ns.getInstance().findNestedRow(e,"prooflabel",r),o=Ns.getInstance().factory_.makeBranchNode(K.RULELABEL,n(b(s.childNodes)),[]);return o.role=r,o.mathmlTree=s,o}getFormulas(t,e,n){const r=e.length?Ns.getInstance().findNestedRow(e,"inferenceRule"):t,s="up"===Ns.getSemantics(r).inferenceRule,o=s?r.childNodes[1]:r.childNodes[0],i=s?r.childNodes[0]:r.childNodes[1],c=o.childNodes[0].childNodes[0],a=b(c.childNodes[0].childNodes),l=[];let u=1;for(const t of a)u%2&&l.push(t.childNodes[0]),u++;const h=n(l),d=n(b(i.childNodes[0].childNodes))[0],f=Ns.getInstance().factory_.makeBranchNode(K.PREMISES,h,[]);f.mathmlTree=c;const p=Ns.getInstance().factory_.makeBranchNode(K.CONCLUSION,[d],[]);return p.mathmlTree=i.childNodes[0].childNodes[0],{conclusion:p,premises:f}}findNestedRow(t,e,n){return Ns.getInstance().findNestedRow_(t,e,0,n)}cleanInference(t){return b(t).filter((function(t){return"MSPACE"!==B(t)}))}operatorNode(t){return t.type===K.UNKNOWN&&(t.type=K.OPERATOR),ur.run("multioperator",t)}constructor(){this.funcAppls={},this.splitRoles=new Map([[z.SUBTRACTION,z.NEGATIVE],[z.ADDITION,z.POSITIVE]]),this.splitOps=["\u2212","-","\u2010","\u2011","+"],this.factory_=new Dr,ur.updateFactory(this.factory_)}implicitNode_(t){const e=Ns.getInstance().factory_.makeMultipleContentNodes(t.length-1,tn.invisibleTimes);Ns.matchSpaces_(t,e);const n=Ns.getInstance().infixNode_(t,e[0]);return n.role=z.IMPLICIT,e.forEach((function(t){t.parent=n})),n.contentNodes=e,n}infixNode_(t,e){const n=Ns.getInstance().factory_.makeBranchNode(K.INFIXOP,t,[e],Pr(e).textContent);return n.role=e.role,ur.run("propagateSimpleFunction",n)}explicitMixed_(t){const e=Ur(t,(function(t){return t.textContent===tn.invisiblePlus}));if(!e.rel.length)return t;let n=[];for(let t,r=0;t=e.rel[r];r++){const s=e.comp[r],o=e.comp[r+1],i=s.length-1;if(s[i]&&o[0]&&vr(s[i],K.NUMBER)&&!Br(s[i],z.MIXED)&&vr(o[0],K.FRACTION)){const t=Ns.getInstance().factory_.makeBranchNode(K.NUMBER,[s[i],o[0]],[]);t.role=z.MIXED,n=n.concat(s.slice(0,i)),n.push(t),o.shift()}else n=n.concat(s),n.push(t)}return n.concat(e.comp[e.comp.length-1])}concatNode_(t,e,n){if(0===e.length)return t;const r=e.map((function(t){return Pr(t).textContent})).join(" "),s=Ns.getInstance().factory_.makeBranchNode(n,[t],e,r);return e.length>1&&(s.role=z.MULTIOP),s}prefixNode_(t,e){const n=this.splitSingles(e);let r=t;for(;n.length>0;){const t=n.pop();r=Ns.getInstance().concatNode_(r,t,K.PREFIXOP),1===t.length&&-1!==this.splitOps.indexOf(t[0].textContent)&&(r.role=this.splitRoles.get(t[0].role))}return r}splitSingles(t){let e=0;const n=[];let r=0;for(;r<t.length;){const s=t[r];!this.splitRoles.has(s.role)||t[r-1]&&t[r-1].role===s.role||t[r+1]&&t[r+1].role===s.role||-1===this.splitOps.indexOf(s.textContent)||(n.push(t.slice(e,r)),n.push(t.slice(r,r+1)),e=r+1),r++}return e<r&&n.push(t.slice(e,r)),n}postfixNode_(t,e){return e.length?Ns.getInstance().concatNode_(t,e,K.POSTFIXOP):t}combineUnits_(t){const e=Ur(t,(function(t){return!Br(t,z.UNIT)}));if(t.length===e.rel.length)return e.rel;const n=[];let r,s;do{const t=e.comp.shift();r=e.rel.shift();let o=null;s=n.pop(),s&&(t.length&&ls(s)?t.unshift(s):n.push(s)),1===t.length&&(o=t.pop()),t.length>1&&(o=Ns.getInstance().implicitNode_(t),o.role=z.UNIT),o&&n.push(o),r&&n.push(r)}while(r);return n}getMixedNumbers_(t){const e=Ur(t,(function(t){return vr(t,K.FRACTION)&&Br(t,z.VULGAR)}));if(!e.rel.length)return t;let n=[];for(let t,r=0;t=e.rel[r];r++){const s=e.comp[r],o=s.length-1;if(s[o]&&vr(s[o],K.NUMBER)&&(Br(s[o],z.INTEGER)||Br(s[o],z.FLOAT))){const e=Ns.getInstance().factory_.makeBranchNode(K.NUMBER,[s[o],t],[]);e.role=z.MIXED,n=n.concat(s.slice(0,o)),n.push(e)}else n=n.concat(s),n.push(t)}return n.concat(e.comp[e.comp.length-1])}getTextInRow_(t){if(0===t.length)return t;if(1===t.length)return t[0].type===K.TEXT&&t[0].role===z.UNKNOWN&&(t[0].role=z.ANNOTATION),t;const{rel:e,comp:n}=Ur(t,(t=>vr(t,K.TEXT)));if(0===e.length)return t;const r=[];let s=n.shift();for(;e.length>0;){let t=e.shift(),o=n.shift();const i=[];for(;!o.length&&e.length&&t.role!==z.SPACE&&e[0].role!==z.SPACE;)i.push(t),t=e.shift(),o=n.shift();if(i.length){s.length&&r.push(Ns.getInstance().row(s)),i.push(t);let e=Ns.getInstance().dummyNode_(i);r.push(e),s=o;continue}if(t.role!==z.UNKNOWN){s.length&&r.push(Ns.getInstance().row(s)),r.push(t),s=o;continue}const c=rn.Meaning.get(t.textContent);c.type!==K.PUNCTUATION?c.type===K.UNKNOWN?(Ns.meaningFromContent(t,((t,e,n)=>{if(t.role===z.UNKNOWN){if(Ns.numberRole_(t,e,n),t.role===z.OTHERNUMBER)return n.some((t=>t.type!==K.NUMBER&&t.type!==K.IDENTIFIER))?(t.type=K.TEXT,void(t.role=z.ANNOTATION)):void(t.role=z.UNKNOWN);t.type=K.NUMBER}})),t.type!==K.TEXT||t.role===z.UNKNOWN?(t.role===z.UNKNOWN&&(e.length||o.length?o.length&&o[0].type===K.FENCED?(t.type=K.FUNCTION,t.role=z.PREFIXFUNC):t.role=z.TEXT:(t.type=K.IDENTIFIER,t.role=z.UNIT)),s.push(t),s=s.concat(o)):(s.length&&r.push(Ns.getInstance().row(s)),r.push(t),s=o)):(t.type=c.type,t.role=c.role,t.font=c.font,t.addAnnotation("general","text"),s.push(t),s=s.concat(o)):(t.role=c.role,t.font=c.font,s.length&&r.push(Ns.getInstance().row(s)),r.push(t),s=o)}return s.length>0&&r.push(Ns.getInstance().row(s)),r.length>1?[Ns.getInstance().dummyNode_(r)]:r}relationsInRow_(t){const e=Ur(t,Yr),n=e.rel[0];if(!n)return Ns.getInstance().operationsInRow_(t);if(1===t.length)return t[0];const r=e.comp.map(Ns.getInstance().operationsInRow_);let s;return e.rel.some((function(t){return!t.equals(n)}))?(s=Ns.getInstance().factory_.makeBranchNode(K.MULTIREL,r,e.rel),e.rel.every((function(t){return t.role===n.role}))&&(s.role=n.role),s):(s=Ns.getInstance().factory_.makeBranchNode(K.RELSEQ,r,e.rel,Pr(n).textContent),s.role=n.role,s)}operationsInRow_(t){if(0===t.length)return Ns.getInstance().factory_.makeEmptyNode();if(1===(t=Ns.getInstance().explicitMixed_(t)).length)return t[0];const e=[];for(;t.length>0&&Wr(t[0]);)e.push(t.shift());if(0===t.length)return Ns.getInstance().prefixNode_(e.pop(),e);if(1===t.length)return Ns.getInstance().prefixNode_(t[0],e);const n=Fr(t=ur.run("convert_juxtaposition",t),Wr),r=Ns.getInstance().wrapFactor(e,n);return Ns.getInstance().addFactor(r,n)}wrapPostfix(t){var e;(null===(e=t.div)||void 0===e?void 0:e.role)===z.POSTFIXOP&&(t.tail.length&&t.tail[0].type!==K.OPERATOR?t.div.role=z.DIVISION:(t.head=[Ns.getInstance().postfixNode_(Ns.getInstance().implicitNode(t.head),[t.div])],t.div=t.tail.shift(),Ns.getInstance().wrapPostfix(t)))}wrapFactor(t,e){return Ns.getInstance().wrapPostfix(e),Ns.getInstance().prefixNode_(Ns.getInstance().implicitNode(e.head),t)}addFactor(t,e){return e.div?Ns.getInstance().operationsTree_(e.tail,t,e.div):(hs(t)&&(t.role=z.UNIT),t)}operationsTree_(t,e,n,r=[]){if(0===t.length){if(r.unshift(n),e.type===K.INFIXOP){const t=Ns.getInstance().postfixNode_(e.childNodes.pop(),r);return e.appendChild(t),e}return Ns.getInstance().postfixNode_(e,r)}const s=Fr(t,Wr);if(0===s.head.length)return r.push(s.div),Ns.getInstance().operationsTree_(s.tail,e,n,r);const o=Ns.getInstance().wrapFactor(r,s),i=Ns.getInstance().appendOperand_(e,n,o);return Ns.getInstance().addFactor(i,s)}appendOperand_(t,e,n){if(t.type!==K.INFIXOP)return Ns.getInstance().infixNode_([t,n],e);const r=Ns.getInstance().appendDivisionOp_(t,e,n);return r||(Ns.getInstance().appendExistingOperator_(t,e,n)?t:e.role===z.MULTIPLICATION?Ns.getInstance().appendMultiplicativeOp_(t,e,n):Ns.getInstance().appendAdditiveOp_(t,e,n))}appendDivisionOp_(t,e,n){return e.role===z.DIVISION?ds(t)?Ns.getInstance().infixNode_([t,n],e):Ns.getInstance().appendLastOperand_(t,e,n):t.role===z.DIVISION?Ns.getInstance().infixNode_([t,n],e):null}appendLastOperand_(t,e,n){let r=t,s=t.childNodes[t.childNodes.length-1];for(;s&&s.type===K.INFIXOP&&!ds(s);)r=s,s=r.childNodes[t.childNodes.length-1];const o=Ns.getInstance().infixNode_([r.childNodes.pop(),n],e);return r.appendChild(o),t}appendMultiplicativeOp_(t,e,n){if(ds(t))return Ns.getInstance().infixNode_([t,n],e);let r=t,s=t.childNodes[t.childNodes.length-1];for(;s&&s.type===K.INFIXOP&&!ds(s);)r=s,s=r.childNodes[t.childNodes.length-1];const o=Ns.getInstance().infixNode_([r.childNodes.pop(),n],e);return r.appendChild(o),t}appendAdditiveOp_(t,e,n){return Ns.getInstance().infixNode_([t,n],e)}appendExistingOperator_(t,e,n){return!(!t||t.type!==K.INFIXOP||ds(t))&&(t.contentNodes[0].equals(e)?(t.appendContentNode(e),t.appendChild(n),!0):Ns.getInstance().appendExistingOperator_(t.childNodes[t.childNodes.length-1],e,n))}getFencesInRow_(t){let e=Ur(t,qr);e=Ns.purgeFences_(e);const n=e.comp.shift();return Ns.getInstance().fences_(e.rel,e.comp,[],[n])}fences_(t,e,n,r){if(0===t.length&&0===n.length)return r[0];const s=t=>Br(t,z.OPEN);if(0===t.length){const t=r.shift();for(;n.length>0;){if(s(n[0])){const e=n.shift();Ns.fenceToPunct_(e),t.push(e)}else{const e=Fr(n,s),o=e.head.length-1,i=Ns.getInstance().neutralFences_(e.head,r.slice(0,o));r=r.slice(o),t.push(...i),e.div&&e.tail.unshift(e.div),n=e.tail}t.push(...r.shift())}return t}const o=n[n.length-1],i=t[0].role;if(i===z.OPEN||ps(t[0])&&(!o||!ms(t[0],o))){n.push(t.shift());const s=e.shift();return s&&r.push(s),Ns.getInstance().fences_(t,e,n,r)}if(o&&i===z.CLOSE&&o.role===z.OPEN){const s=Ns.getInstance().horizontalFencedNode_(n.pop(),t.shift(),r.pop());return r.push(r.pop().concat([s],e.shift())),Ns.getInstance().fences_(t,e,n,r)}if(o&&ms(t[0],o)){if(!Es(o)||!gs(t[0])){n.push(t.shift());const s=e.shift();return s&&r.push(s),Ns.getInstance().fences_(t,e,n,r)}const s=Ns.getInstance().horizontalFencedNode_(n.pop(),t.shift(),r.pop());return r.push(r.pop().concat([s],e.shift())),Ns.getInstance().fences_(t,e,n,r)}if(o&&i===z.CLOSE&&ps(o)&&n.some(s)){const o=Fr(n,s,!0),i=r.pop(),c=r.length-o.tail.length+1,a=Ns.getInstance().neutralFences_(o.tail,r.slice(c));r=r.slice(0,c);const l=Ns.getInstance().horizontalFencedNode_(o.div,t.shift(),r.pop().concat(a,i));return r.push(r.pop().concat([l],e.shift())),Ns.getInstance().fences_(t,e,o.head,r)}const c=t.shift();return Ns.fenceToPunct_(c),r.push(r.pop().concat([c],e.shift())),Ns.getInstance().fences_(t,e,n,r)}neutralFences_(t,e){if(0===t.length)return t;if(1===t.length)return Ns.fenceToPunct_(t[0]),t;const n=t.shift();if(!Es(n)){Ns.fenceToPunct_(n);const r=e.shift();return r.unshift(n),r.concat(Ns.getInstance().neutralFences_(t,e))}const r=Fr(t,(function(t){return ms(t,n)}));if(!r.div){Ns.fenceToPunct_(n);const r=e.shift();return r.unshift(n),r.concat(Ns.getInstance().neutralFences_(t,e))}if(!gs(r.div))return Ns.fenceToPunct_(r.div),t.unshift(n),Ns.getInstance().neutralFences_(t,e);const s=Ns.getInstance().combineFencedContent_(n,r.div,r.head,e);if(r.tail.length>0){const t=s.shift(),e=Ns.getInstance().neutralFences_(r.tail,s);return t.concat(e)}return s[0]}combineFencedContent_(t,e,n,r){if(0===n.length){const n=Ns.getInstance().horizontalFencedNode_(t,e,r.shift());return r.length>0?r[0].unshift(n):r=[[n]],r}const s=r.shift(),o=n.length-1,i=r.slice(0,o),c=(r=r.slice(o)).shift(),a=Ns.getInstance().neutralFences_(n,i);s.push(...a),s.push(...c);const l=Ns.getInstance().horizontalFencedNode_(t,e,s);return r.length>0?r[0].unshift(l):r=[[l]],r}horizontalFencedNode_(t,e,n){const r=Ns.getInstance().row(n);let s=Ns.getInstance().factory_.makeBranchNode(K.FENCED,[r],[t,e]);return t.role===z.OPEN?(Ns.getInstance().classifyHorizontalFence_(s),s=ur.run("propagateComposedFunction",s)):s.role=t.role,s=ur.run("detect_cycle",s),Ns.rewriteFencedNode_(s)}classifyHorizontalFence_(t){t.role=z.LEFTRIGHT;const e=t.childNodes;if(!function(t){return function(t){return!!t&&-1!==["{","\ufe5b","\uff5b"].indexOf(t.textContent)}(t.contentNodes[0])&&function(t){return!!t&&-1!==["}","\ufe5c","\uff5d"].indexOf(t.textContent)}(t.contentNodes[1])}(t)||e.length>1)return;if(0===e.length||e[0].type===K.EMPTY)return void(t.role=z.SETEMPTY);const n=e[0].type;if(1===e.length&&as(e[0]))return void(t.role=z.SETSINGLE);const r=e[0].role;if(n===K.PUNCTUATED&&r===z.SEQUENCE){if(e[0].contentNodes[0].role!==z.COMMA)return 1!==e[0].contentNodes.length||e[0].contentNodes[0].role!==z.VBAR&&e[0].contentNodes[0].role!==z.COLON?void 0:(t.role=z.SETEXT,void Ns.getInstance().setExtension_(t));t.role=z.SETCOLLECT}}setExtension_(t){const e=t.childNodes[0].childNodes[0];var n;e&&e.type===K.INFIXOP&&1===e.contentNodes.length&&(n=e.contentNodes[0],[z.ELEMENT,z.NONELEMENT,z.REELEMENT,z.RENONELEMENT].includes(n.role))&&(e.addAnnotation("set","intensional"),e.contentNodes[0].addAnnotation("set","intensional"))}getPunctuationInRow_(t){if(t.length<=1)return t;const e=t=>{const e=t.type;return"punctuation"===e||"text"===e||"operator"===e||"relation"===e},n=Ur(t,(function(n){if(!Kr(n))return!1;if(Kr(n)&&!Br(n,z.ELLIPSIS))return!0;const r=t.indexOf(n);if(0===r)return!t[1]||!e(t[1]);const s=t[r-1];if(r===t.length-1)return!e(s);const o=t[r+1];return!e(s)||!e(o)}));if(0===n.rel.length)return t;let r=[],s=n.comp.shift();s.length>0&&r.push(Ns.getInstance().row(s));let o=0;for(;n.comp.length>0;){let t=[],e=o;do{t.push(n.rel[o++]),s=n.comp.shift()}while(n.rel[o]&&s&&0===s.length);t=ur.run("ellipses",t),n.rel.splice(e,o-e,...t),o=e+t.length,r=r.concat(t),s&&s.length>0&&r.push(Ns.getInstance().row(s))}return[Ns.getInstance().punctuatedNode_(r,n.rel)]}punctuatedNode_(t,e){const n=Ns.getInstance().factory_.makeBranchNode(K.PUNCTUATED,t,e);if(e.length===t.length){const t=e[0].role;if(t!==z.UNKNOWN&&e.every((function(e){return e.role===t})))return n.role=t,n}let r=e[0];return ss(t,e,0)?n.role=r.childNodes.length&&!r.embellished?r.role:z.STARTPUNCT:ss(t,e,t.length-1)?n.role=r.childNodes.length&&!r.embellished?r.role:z.ENDPUNCT:e.every((t=>Br(t,z.DUMMY)))?n.role=z.TEXT:e.every((t=>Br(t,z.SPACE)))?n.role=z.SPACE:n.role=z.SEQUENCE,n}dummyNode_(t){const e=Ns.getInstance().factory_.makeMultipleContentNodes(t.length-1,tn.invisibleComma);return e.forEach((function(t){t.role=z.DUMMY})),Ns.getInstance().punctuatedNode_(t,e)}accentRole_(t,e){if(!kr(t))return!1;const n=t.textContent,r=rn.Secondary.get(n,tt.BAR)||rn.Secondary.get(n,tt.TILDE)||t.role;return t.role=e===K.UNDERSCORE?z.UNDERACCENT:z.OVERACCENT,t.addAnnotation("accent",r),!0}accentNode_(t,e,n,r,s){const o=(e=e.slice(0,r+1))[1],i=e[2];let c;if(!s&&i&&(c=Ns.getInstance().factory_.makeBranchNode(K.SUBSCRIPT,[t,o],[]),c.role=z.SUBSUP,e=[c,i],n=K.SUPERSCRIPT),s){const r=Ns.getInstance().accentRole_(o,n);if(i){Ns.getInstance().accentRole_(i,K.OVERSCORE)&&!r?(c=Ns.getInstance().factory_.makeBranchNode(K.OVERSCORE,[t,i],[]),e=[c,o],n=K.UNDERSCORE):(c=Ns.getInstance().factory_.makeBranchNode(K.UNDERSCORE,[t,o],[]),e=[c,i],n=K.OVERSCORE),c.role=z.UNDEROVER}}return Ns.getInstance().makeLimitNode_(t,e,c,n)}makeLimitNode_(t,e,n,r){if(r===K.LIMUPPER&&t.type===K.LIMLOWER)return t.childNodes.push(e[1]),e[1].parent=t,t.type=K.LIMBOTH,t;if(r===K.LIMLOWER&&t.type===K.LIMUPPER)return t.childNodes.splice(1,-1,e[1]),e[1].parent=t,t.type=K.LIMBOTH,t;const s=Ns.getInstance().factory_.makeBranchNode(r,e,[]),o=Xr(t);return n&&(n.embellished=o),s.embellished=o,s.role=t.role,s}getFunctionsInRow_(t,e){const n=e||[];if(0===t.length)return n;const r=t.shift(),s=Ns.classifyFunction_(r,t);if(!s)return n.push(r),Ns.getInstance().getFunctionsInRow_(t,n);const o=Ns.getInstance().getFunctionsInRow_(t,[]),i=Ns.getInstance().getFunctionArgs_(r,o,s);return n.concat(i)}getFunctionArgs_(t,e,n){let r,s,o;switch(n){case"integral":{const n=Ns.getInstance().getIntegralArgs_(e);if(!n.intvar&&!n.integrand.length)return n.rest.unshift(t),n.rest;const r=Ns.getInstance().row(n.integrand);return o=Ns.getInstance().integralNode_(t,r,n.intvar),ur.run("intvar_from_fraction",o),n.rest.unshift(o),n.rest}case"prefix":if(e[0]&&e[0].type===K.FENCED){const n=e.shift();return ps(n)||(n.role=z.LEFTRIGHT),o=Ns.getInstance().functionNode_(t,n),e.unshift(o),e}if(r=Fr(e,Gr),r.head.length)s=Ns.getInstance().row(r.head),r.div&&r.tail.unshift(r.div);else{if(!r.div||!vr(r.div,K.APPL))return e.unshift(t),e;s=r.div}return o=Ns.getInstance().functionNode_(t,s),r.tail.unshift(o),r.tail;case"bigop":return r=Fr(e,Vr),r.head.length?(s=Ns.getInstance().row(r.head),o=Ns.getInstance().bigOpNode_(t,s),r.div&&r.tail.unshift(r.div),r.tail.unshift(o),r.tail):(e.unshift(t),e);default:{if(0===e.length)return[t];const n=e[0];return n.type===K.FENCED&&!ps(n)&&function(t){const e=t.childNodes;if(0===e.length)return!0;if(e.length>1)return!1;const n=e[0];if(n.type===K.INFIXOP){if(n.role!==z.IMPLICIT)return!1;if(n.childNodes.some((t=>vr(t,K.INFIXOP))))return!1}return!0}(n)?(n.role=z.LEFTRIGHT,Ns.propagateFunctionRole_(t,z.SIMPLEFUNC),o=Ns.getInstance().functionNode_(t,e.shift()),e.unshift(o),e):(e.unshift(t),e)}}}getIntegralArgs_(t,e=[]){if(0===t.length){const t=Fr(e,Vr);return t.div&&t.tail.unshift(t.div),{integrand:t.head,intvar:null,rest:t.tail}}ur.run("intvar_from_implicit",t);const n=t[0];if(Hr(n)){let{integrand:n,rest:r}=Ns.getInstance().getIntegralArgs_(e);return{integrand:n,intvar:null,rest:r.concat(t)}}if($r(n))return n.role=z.INTEGRAL,{integrand:e,intvar:n,rest:t.slice(1)};if(t[1]&&jr(n,t[1])){const r=Ns.getInstance().prefixNode_(t[1],[n]);return r.role=z.INTEGRAL,{integrand:e,intvar:r,rest:t.slice(2)}}return e.push(t.shift()),Ns.getInstance().getIntegralArgs_(t,e)}functionNode_(t,e){const n=Ns.getInstance().factory_.makeContentNode(tn.functionApplication),r=Ns.getInstance().funcAppls[t.id];r&&(n.mathmlTree=r.mathmlTree,n.mathml=r.mathml,n.annotation=r.annotation,n.attributes=r.attributes,delete Ns.getInstance().funcAppls[t.id]),n.type=K.PUNCTUATION,n.role=z.APPLICATION;const s=Ns.getFunctionOp_(t,(function(t){return vr(t,K.FUNCTION)||vr(t,K.IDENTIFIER)&&Br(t,z.SIMPLEFUNC)}));return Ns.getInstance().functionalNode_(K.APPL,[t,e],s,[n])}bigOpNode_(t,e){const n=Ns.getFunctionOp_(t,(t=>vr(t,K.LARGEOP)));return Ns.getInstance().functionalNode_(K.BIGOP,[t,e],n,[])}integralNode_(t,e,n){e=e||Ns.getInstance().factory_.makeEmptyNode(),n=n||Ns.getInstance().factory_.makeEmptyNode();const r=Ns.getFunctionOp_(t,(t=>vr(t,K.LARGEOP)));return Ns.getInstance().functionalNode_(K.INTEGRAL,[t,e,n],r,[])}functionalNode_(t,e,n,r){const s=e[0];let o;n&&(o=n.parent,r.push(n));const i=Ns.getInstance().factory_.makeBranchNode(t,e,r);return i.role=s.role,o&&(n.parent=o),i}fractionNode_(t,e){const n=Ns.getInstance().factory_.makeBranchNode(K.FRACTION,[t,e],[]);return n.role=n.childNodes.every((function(t){return vr(t,K.NUMBER)&&Br(t,z.INTEGER)}))?z.VULGAR:n.childNodes.every(us)?z.UNIT:z.DIVISION,ur.run("propagateSimpleFunction",n)}scriptNode_(t,e,n){let r;switch(t.length){case 0:r=Ns.getInstance().factory_.makeEmptyNode();break;case 1:if(r=t[0],n)return r;break;default:r=Ns.getInstance().dummyNode_(t)}return r.role=e,r}findNestedRow_(t,e,n,r){if(n>3)return null;for(let s,o=0;s=t[o];o++){const t=B(s);if(t!==Sr.MSPACE){if(t===Sr.MROW)return Ns.getInstance().findNestedRow_(b(s.childNodes),e,n+1,r);if(Ns.findSemantics(s,e,r))return s}}return null}}Ns.FENCE_TO_PUNCT_={[z.METRIC]:z.METRIC,[z.NEUTRAL]:z.VBAR,[z.OPEN]:z.OPENFENCE,[z.CLOSE]:z.CLOSEFENCE},Ns.MML_TO_LIMIT_={[Sr.MSUB]:{type:K.LIMLOWER,length:1},[Sr.MUNDER]:{type:K.LIMLOWER,length:1},[Sr.MSUP]:{type:K.LIMUPPER,length:1},[Sr.MOVER]:{type:K.LIMUPPER,length:1},[Sr.MSUBSUP]:{type:K.LIMBOTH,length:2},[Sr.MUNDEROVER]:{type:K.LIMBOTH,length:2}},Ns.MML_TO_BOUNDS_={[Sr.MSUB]:{type:K.SUBSCRIPT,length:1,accent:!1},[Sr.MSUP]:{type:K.SUPERSCRIPT,length:1,accent:!1},[Sr.MSUBSUP]:{type:K.SUBSCRIPT,length:2,accent:!1},[Sr.MUNDER]:{type:K.UNDERSCORE,length:1,accent:!0},[Sr.MOVER]:{type:K.OVERSCORE,length:1,accent:!0},[Sr.MUNDEROVER]:{type:K.UNDERSCORE,length:2,accent:!0}},Ns.CLASSIFY_FUNCTION_={[z.INTEGRAL]:"integral",[z.SUM]:"bigop",[z.PREFIXFUNC]:"prefix",[z.LIMFUNC]:"prefix",[z.SIMPLEFUNC]:"prefix",[z.COMPFUNC]:"prefix"},Ns.MATHJAX_FONTS={"-tex-caligraphic":J.CALIGRAPHIC,"-tex-caligraphic-bold":J.CALIGRAPHICBOLD,"-tex-calligraphic":J.CALIGRAPHIC,"-tex-calligraphic-bold":J.CALIGRAPHICBOLD,"-tex-oldstyle":J.OLDSTYLE,"-tex-oldstyle-bold":J.OLDSTYLEBOLD,"-tex-mathit":J.ITALIC};let Ss={};function Ts(t){return Array.from(t.textContent).map(bn.stringEmpty)}function Is(t,e){const n=Array.from(t.textContent),r=[],s=Ns.getInstance(),o=t.ownerDocument;for(let t,i=0;t=n[i];i++){const n=s.getNodeFactory().makeLeafNode(t,J.UNKNOWN),i=s.identifierNode(n,J.UNKNOWN,"");e(i),r.push(i.xml(o))}return r}function As(t){return Is(t,(function(t){t.textContent.match(/\W/)||(t.type=K.NUMBER)}))}function Rs(t){return Is(t,(function(t){t.font=J.UNKNOWN,t.type=K.IDENTIFIER}))}const Os=[K.CASES,K.CELL,K.INTEGRAL,K.LINE,K.MATRIX,K.MULTILINE,K.OVERSCORE,K.ROOT,K.ROW,K.SQRT,K.SUBSCRIPT,K.SUPERSCRIPT,K.TABLE,K.UNDERSCORE,K.VECTOR];function Cs(t){return Ss={},[t]}function bs(t,e,n,r,s,o){r=r||Os,s=s||{},o=o||function(t){return!1};const i=G(e);if(Ss[t]||(Ss[t]={}),Ss[t][i])return Ss[t][i];if(o(e)||n.indexOf(e.tagName)<0)return 0;const c=Ls(e,n,lr(r,n),s,o,0);return Ss[t][i]=c,c}function Ls(t,e,n,r,s,o){if(s(t)||n.indexOf(t.tagName)>-1||function(t,e){if(!t.attributes)return!1;const n=b(t.attributes);for(let t,r=0;t=n[r];r++)if(e[t.nodeName]===t.nodeValue)return!0;return!1}(t,r))return o;if(e.indexOf(t.tagName)>-1&&o++,!t.childNodes||0===t.childNodes.length)return o;const i=b(t.childNodes);return Math.max.apply(null,i.map((function(t){return Ls(t,e,n,r,s,o)})))}function ys(t){return bs("fraction",t,["fraction"],Os,{},at.FUNCTIONS.fracNestDepth)}function Ms(t,e,n){const r=ys(t),s=Array(r).fill(e);return n&&s.push(n),s.join(at.MESSAGES.regexp.JOINER_FRAC)}function _s(t){return bn.singleton(Ms(t,at.MESSAGES.MS.START,at.MESSAGES.MS.FRAC_V))}function Ps(t){return bn.singleton(Ms(t,at.MESSAGES.MS.END,at.MESSAGES.MS.FRAC_V),{kind:"LAST"})}function Fs(t){return bn.singleton(Ms(t,at.MESSAGES.MS.FRAC_OVER),{})}function Us(t){return bn.singleton(Ms(t,at.MESSAGES.MS.START,at.MESSAGES.MS.FRAC_B))}function xs(t){return bn.singleton(Ms(t,at.MESSAGES.MS.END,at.MESSAGES.MS.FRAC_B),{kind:"LAST"})}function Ds(t){const e=ys(t);return bn.singleton(1===e?at.MESSAGES.MS.FRAC_S:at.FUNCTIONS.combineNestedFraction(at.MESSAGES.MS.NEST_FRAC,at.FUNCTIONS.radicalNestDepth(e-1),at.MESSAGES.MS.FRAC_S))}function vs(t){const e=ys(t);return bn.singleton(1===e?at.MESSAGES.MS.ENDFRAC:at.FUNCTIONS.combineNestedFraction(at.MESSAGES.MS.NEST_FRAC,at.FUNCTIONS.radicalNestDepth(e-1),at.MESSAGES.MS.ENDFRAC),{kind:"LAST"})}function ws(t){const e=ys(t);return bn.singleton(1===e?at.MESSAGES.MS.FRAC_OVER:at.FUNCTIONS.combineNestedFraction(at.MESSAGES.MS.NEST_FRAC,at.FUNCTIONS.radicalNestDepth(e-1),at.MESSAGES.MS.FRAC_OVER))}function Bs(t){return at.FUNCTIONS.fracNestDepth(t)?[t]:[]}function ks(t,e,n){for(;t.parentNode;){const r=t.parentNode,s=r.parentNode;if(!s)break;const o=t.getAttribute&&t.getAttribute("role");(s.tagName===K.SUBSCRIPT&&t===r.childNodes[1]||s.tagName===K.TENSOR&&o&&(o===z.LEFTSUB||o===z.RIGHTSUB))&&(e=n.sub+at.MESSAGES.regexp.JOINER_SUBSUPER+e),(s.tagName===K.SUPERSCRIPT&&t===r.childNodes[1]||s.tagName===K.TENSOR&&o&&(o===z.LEFTSUPER||o===z.RIGHTSUPER))&&(e=n.sup+at.MESSAGES.regexp.JOINER_SUBSUPER+e),t=s}return e.trim()}function Gs(t){return bn.singleton(ks(t,at.MESSAGES.MS.SUBSCRIPT,{sup:at.MESSAGES.MS.SUPER,sub:at.MESSAGES.MS.SUB}))}function Vs(t){return bn.singleton(ks(t,at.MESSAGES.MS.SUB,{sup:at.MESSAGES.MS.SUP,sub:at.MESSAGES.MS.SUB}))}function js(t){return bn.singleton(ks(t,at.MESSAGES.MS.SUPERSCRIPT,{sup:at.MESSAGES.MS.SUPER,sub:at.MESSAGES.MS.SUB}))}function $s(t){return bn.singleton(ks(t,at.MESSAGES.MS.SUP,{sup:at.MESSAGES.MS.SUP,sub:at.MESSAGES.MS.SUB}))}function Hs(t){const e=ks(t,"",{sup:at.MESSAGES.MS.SUPER,sub:at.MESSAGES.MS.SUB});return bn.singleton(e?e.replace(new RegExp(at.MESSAGES.MS.SUB+"$"),at.MESSAGES.MS.SUBSCRIPT).replace(new RegExp(at.MESSAGES.MS.SUPER+"$"),at.MESSAGES.MS.SUPERSCRIPT):at.MESSAGES.MS.BASELINE)}function Xs(t){const e=ks(t,"",{sup:at.MESSAGES.MS.SUP,sub:at.MESSAGES.MS.SUB});return bn.singleton(e||at.MESSAGES.MS.BASE)}function Ws(t){return bs("radical",t,["sqrt","root"],Os,{})}function Ys(t,e,n){const r=Ws(t),s=function(t){const e="sqrt"===t.tagName?"2":O("children/*[1]",t)[0].textContent.trim();return at.MESSAGES.MSroots[e]||""}(t);return n=s?at.FUNCTIONS.combineRootIndex(n,s):n,1===r?n:at.FUNCTIONS.combineNestedRadical(e,at.FUNCTIONS.radicalNestDepth(r-1),n)}function Ks(t){return bn.singleton(Ys(t,at.MESSAGES.MS.NESTED,at.MESSAGES.MS.STARTROOT))}function qs(t){return bn.singleton(Ys(t,at.MESSAGES.MS.NESTED,at.MESSAGES.MS.ENDROOT))}function zs(t){return bn.singleton(Ys(t,at.MESSAGES.MS.NESTED,at.MESSAGES.MS.ROOTINDEX))}function Qs(t){return bn.singleton(Ys(t,at.MESSAGES.MS.NEST_ROOT,at.MESSAGES.MS.STARTROOT))}function Js(t){return bn.singleton(Ys(t,at.MESSAGES.MS.NEST_ROOT,at.MESSAGES.MS.ENDROOT))}function Zs(t){return bn.singleton(Ys(t,at.MESSAGES.MS.NEST_ROOT,at.MESSAGES.MS.ROOTINDEX))}function to(t){return bn.singleton(Ys(t,at.MESSAGES.MS.NEST_ROOT,at.MESSAGES.MS.ROOT))}function eo(t){return bn.singleton(Ys(t,at.MESSAGES.MS.NEST_ROOT,at.MESSAGES.MS.INDEX))}function no(t){const e=function(t){return bs("underscore",t,["underscore"],Os,{},(function(t){return t.tagName&&t.tagName===K.UNDERSCORE&&t.childNodes[0].childNodes[1].getAttribute("role")===z.UNDERACCENT}))}(t);return bn.singleton(Array(e).join(at.MESSAGES.MS.UNDER)+at.MESSAGES.MS.UNDERSCRIPT)}function ro(t){return bn.singleton(at.MESSAGES.MS.ENDSCRIPTS)}function so(t){const e=function(t){return bs("overscore",t,["overscore"],Os,{},(function(t){return t.tagName&&t.tagName===K.OVERSCORE&&t.childNodes[0].childNodes[1].getAttribute("role")===z.OVERACCENT}))}(t);return bn.singleton(Array(e).join(at.MESSAGES.MS.OVER)+at.MESSAGES.MS.OVERSCRIPT)}function oo(t){if(t.tagName!==K.MATRIX||t.getAttribute("role")!==z.DETERMINANT)return[];const e=O("children/row/children/cell/children/*",t);for(let t,n=0;t=e[n];n++)if(t.tagName!==K.NUMBER){if(t.tagName===K.IDENTIFIER){const e=t.getAttribute("role");if(e===z.LATINLETTER||e===z.GREEKLETTER||e===z.OTHERLETTER)continue}return[]}return[t]}function io(){const t=t=>t.map((t=>"ancestor::"+t)),e=t=>"not("+t+")",n=e(t(["subscript","superscript","tensor"]).join(" or ")),r=t(["relseq","multrel"]),s=t(["fraction","punctuation","fenced","sqrt","root"]);let o=[];for(let t,e=0;t=s[e];e++)o=o.concat(r.map((function(e){return t+"/"+e})));return[["ancestor::*/following-sibling::*",n,e(o.join(" | "))].join(" and ")]}function co(t){if(!t.childNodes.length||!t.childNodes[0].childNodes.length||!t.childNodes[0].childNodes[0].childNodes.length)return bn.singleton("");const e=t.childNodes[0].childNodes[0].childNodes[0].textContent;return bn.singleton(e.match(/^\(.+\)$/)?e.slice(1,-1):e)}const ao=new Map([[3,"CSFleftsuperscript"],[4,"CSFleftsubscript"],[2,"CSFbaseline"],[1,"CSFrightsubscript"],[0,"CSFrightsuperscript"]]),lo=new Map([[4,2],[3,3],[2,1],[1,4],[0,5]]);function uo(t){const e=[];let n="",r="",s=parseInt(t,2);for(let t=0;t<5;t++){const o="children/*["+lo.get(t)+"]";if(1&s){const e=ao.get(t%5);n="[t] "+e+"Verbose; [n] "+o+";"+n,r="[t] "+e+"Brief; [n] "+o+";"+r}else e.unshift("name("+o+')="empty"');s>>=1}return[e,n,r]}function ho(t,e=!0){const n=["11111","11110","11101","11100","10111","10110","10101","10100","01111","01110","01101","01100"];for(const r of n){let n="tensor"+r,[s,o,i]=uo(r);if(t.defineRule(n,"default",o,"self::tensor",...s),e&&(t.defineRule(n,"brief",i,"self::tensor",...s),t.defineRule(n,"sbrief",i,"self::tensor",...s)),!(3&parseInt(r,2)))continue;const c=ao.get(2);o+="; [t]"+c+"Verbose",i+="; [t]"+c+"Brief",n+="-baseline";const a="((.//*[not(*)])[last()]/@id)!=(((.//ancestor::fraction|ancestor::root|ancestor::sqrt|ancestor::cell|ancestor::line|ancestor::stree)[1]//*[not(*)])[last()]/@id)";t.defineRule(n,"default",o,"self::tensor",a,...s),e&&(t.defineRule(n,"brief",i,"self::tensor",a,...s),t.defineRule(n,"sbrief",i,"self::tensor",a,...s))}}function fo(t){let e=Object.keys(at.MESSAGES.MSroots).length;if(!e)return[];if(e++,!t.childNodes||0===t.childNodes.length||!t.childNodes[0].childNodes)return[];const n=t.childNodes[0].childNodes[0].textContent;if(!/^\d+$/.test(n))return[];const r=parseInt(n,10);return r>1&&r<=e?[t]:[]}function po(t,e){let n=0;return function(){return at.NUMBERS.numericOrdinal(++n)+" "+e}}function mo(t,e){let n=0;return function(){return at.NUMBERS.numberToOrdinal(++n,!1)+" "+e}}function Eo(t){const e=ot(t,at.MESSAGES.MS.FRAC_OVER);return e.convertible&&e.enumerator&&e.denominator?[bn.node(at.NUMBERS.numberToWords(e.enumerator),t.childNodes[0].childNodes[0],{separator:""}),bn.stringAttr(at.NUMBERS.vulgarSep,{separator:""}),bn.node(at.NUMBERS.numberToOrdinal(e.denominator,1!==e.enumerator),t.childNodes[0].childNodes[1])]:[bn.node(e.content||"",t)]}function go(t){const e=b(t.parentNode.childNodes);return bn.singleton(at.NUMBERS.numericOrdinal(e.indexOf(t)+1).toString())}function No(t){const e=Hs(t);return e[0].speech=e[0].speech.replace(/-$/,""),e}function So(t){const e=Xs(t);return e[0].speech=e[0].speech.replace(/-$/,""),e}function To(t){const e=js(t);return e[0].speech=e[0].speech.replace(/^exposant/,"exposant gauche"),e}function Io(t){const e=Gs(t);return e[0].speech=e[0].speech.replace(/^indice/,"indice gauche"),e}function Ao(t){const e=$s(t);return e[0].speech=e[0].speech.replace(/^sup/,"sup gauche"),e}function Ro(t){const e=Vs(t);return e[0].speech=e[0].speech.replace(/^sub/,"sub gauche"),e}function Oo(t,e,n){const r=ys(t),s=Array.apply(null,Array(r)).map((t=>e));return n&&s.unshift(n),s.join(at.MESSAGES.regexp.JOINER_FRAC)}function Co(t){return bn.singleton(Oo(t,at.MESSAGES.MS.START,at.MESSAGES.MS.FRAC_V))}function bo(t){return bn.singleton(Oo(t,at.MESSAGES.MS.END,at.MESSAGES.MS.FRAC_V))}function Lo(t){return bn.singleton(Oo(t,at.MESSAGES.MS.START,at.MESSAGES.MS.FRAC_B))}function yo(t){return bn.singleton(Oo(t,at.MESSAGES.MS.END,at.MESSAGES.MS.FRAC_B))}function Mo(t){const e=ys(t);return 1===e?bn.singleton(at.MESSAGES.MS.FRAC_S):bn.singleton(at.FUNCTIONS.combineNestedFraction(at.FUNCTIONS.radicalNestDepth(e-1),at.MESSAGES.MS.NEST_FRAC,at.MESSAGES.MS.FRAC_S))}function _o(t){const e=ys(t);return 1===e?bn.singleton(at.MESSAGES.MS.ENDFRAC):bn.singleton(at.FUNCTIONS.combineNestedFraction(at.FUNCTIONS.radicalNestDepth(e-1),at.MESSAGES.MS.NEST_FRAC,at.MESSAGES.MS.ENDFRAC))}function Po(t){const e=ys(t);return 1===e?bn.singleton(at.MESSAGES.MS.FRAC_OVER):bn.singleton(at.FUNCTIONS.combineNestedFraction(at.FUNCTIONS.radicalNestDepth(e-1),at.MESSAGES.MS.NEST_FRAC,at.MESSAGES.MS.FRAC_OVER))}function Fo(t){return 1===O("children/*[1]",t)[0].toString().match(/[^>\u2062>]+<\/[^>]*>/g).length?[t]:[]}function Uo(t,e,n){const r=Ws(t);return 1===r?n:at.FUNCTIONS.combineNestedRadical(at.FUNCTIONS.radicalNestDepth(r-1),e,n)}function xo(t){return bn.singleton(Uo(t,at.MESSAGES.MS.NESTED,at.MESSAGES.MS.STARTROOT))}function Do(t){return bn.singleton(Uo(t,at.MESSAGES.MS.NESTED,at.MESSAGES.MS.ENDROOT))}function vo(t){return bn.singleton(Uo(t,at.MESSAGES.MS.NEST_ROOT,at.MESSAGES.MS.STARTROOT))}function wo(t){return bn.singleton(Uo(t,at.MESSAGES.MS.NEST_ROOT,at.MESSAGES.MS.ENDROOT))}function Bo(t){return bn.singleton(Uo(t,at.MESSAGES.MS.NEST_ROOT,at.MESSAGES.MS.ROOT))}function ko(t,e){const n=function(t){const e=O("children/*[1]",t)[0].textContent.trim();return at.MESSAGES.MSroots[e]||e+"\uc81c\uacf1\uadfc"}(t);return n||e}function Go(t){return bn.singleton(ko(t,at.MESSAGES.MS.ROOTINDEX))}function Vo(t){return bn.singleton(ko(t,at.MESSAGES.MS.ROOTINDEX))}function jo(t){return bn.singleton(ko(t,at.MESSAGES.MS.INDEX))}function $o(t){const e=O("children/*",t);return bn.singleton(at.NUMBERS.wordOrdinal(e.length))}function Ho(t){const e=O("children/*",t);return bn.singleton(at.NUMBERS.wordOrdinal(e.length-1))}function Xo(t){const e=O("children/*",t),n=O("content/*",t);return bn.singleton(at.NUMBERS.wordOrdinal(e.length-n.length))}function Wo(t,e){const n=t;let r=0;return function(){const t=Mn.create({text:Ko(n[r])&&qo(n[r+1])?at.MESSAGES.unitTimes:""},{});return r++,[t]}}const Yo=[K.SUPERSCRIPT,K.SUBSCRIPT,K.OVERSCORE,K.UNDERSCORE];function Ko(t){for(;t;){if("unit"===t.getAttribute("role"))return!0;const e=t.tagName,n=O("children/*",t);t=-1!==Yo.indexOf(e)?n[0]:n[n.length-1]}return!1}function qo(t){for(;t;){if("unit"===t.getAttribute("role"))return!0;t=O("children/*",t)[0]}return!1}function zo(t){for(;t;){if("number"===t.tagName&&"1"===t.textContent)return[t];if("infixop"!==t.tagName||"multiplication"!==t.getAttribute("role")&&"implicit"!==t.getAttribute("role"))return[];t=O("children/*",t)[0]}return[]}function Qo(t){const e=ys(t);return bn.singleton(new Array(e).join(at.MESSAGES.MS.FRACTION_REPEAT)+at.MESSAGES.MS.FRACTION_START)}function Jo(t){const e=ys(t);return bn.singleton(new Array(e).join(at.MESSAGES.MS.FRACTION_REPEAT)+at.MESSAGES.MS.FRACTION_END)}function Zo(t){const e=ys(t);return bn.singleton(new Array(e).join(at.MESSAGES.MS.FRACTION_REPEAT)+at.MESSAGES.MS.FRACTION_OVER)}function ti(t){const e=ys(t);return bn.singleton(new Array(e).join(at.MESSAGES.MS.FRACTION_REPEAT)+"\u2838"+at.MESSAGES.MS.FRACTION_OVER)}function ei(t){return at.MESSAGES.regexp.HYPER===ys(t).toString()?[t]:[]}function ni(t,e){const n=ri(t);return bn.singleton(1===n?e:new Array(n).join(at.MESSAGES.MS.NESTED)+e)}function ri(t,e){const n=e||0;return t.parentNode?ri(t.parentNode,"root"===t.tagName||"sqrt"===t.tagName?n+1:n):n}function si(t){return ni(t,at.MESSAGES.MS.STARTROOT)}function oi(t){return ni(t,at.MESSAGES.MS.ENDROOT)}function ii(t){return ni(t,at.MESSAGES.MS.ROOTINDEX)}mt.getInstance().setCorrection("enlargeFence",(function(t){const e="\u2820";if(1===t.length)return e+t;const n=t.split("");return n.every((function(t){return"\u2833"===t}))?e+n.join(e):t.slice(0,-1)+e+t.slice(-1)}));const ci=[K.MULTIREL,K.RELSEQ,K.APPL,K.ROW,K.LINE],ai=[K.SUBSCRIPT,K.SUPERSCRIPT,K.OVERSCORE,K.UNDERSCORE];function li(t,e){const n=t.parent;if(!n)return!1;const r=n.type;return-1!==ci.indexOf(r)||r===K.PREFIXOP&&n.role===z.NEGATIVE&&!e.script&&!e.enclosed||r===K.PREFIXOP&&n.role===z.GEOMETRY||!(r!==K.PUNCTUATED||e.enclosed&&n.role!==z.TEXT)}function ui(t,e){var n;const r=t.slice(0);let s,o=!0,i=t[0].parentNode.parentNode,c=null===(n=i.getAttribute("annotation"))||void 0===n?void 0:n.match(/depth:(\d+)/),a=c?c[1]:"";return s=t.length>0?O("./content/*",i):[],function(){const t=s.shift(),n=r.shift(),c=r[0],l=e?[Mn.create({text:e},{translate:!0})]:[];if(!t)return l;const u=n?ks(n,"",{sup:at.MESSAGES.MS.SUPER,sub:at.MESSAGES.MS.SUB}):"",h=n&&"EMPTY"!==B(n)||o&&i&&i.previousSibling?[Mn.create({text:at.MESSAGES.regexp.SPACE+u},{})]:[],d=c&&"EMPTY"!==B(c)||!s.length&&i&&i.nextSibling?[Mn.create({text:at.MESSAGES.regexp.SPACE},{})]:[],f=E.evaluateNode(t);return f.unshift(new Mn({text:"",layout:`beginrel${a}`})),f.push(new Mn({text:"",layout:`endrel${a}`})),o=!1,l.concat(h,f,d)}}function hi(t,e){const n=t.slice(0);let r;return r=t.length>0?O("../../content/*",t[0]):[],function(){const t=n.shift(),s=n[0],o=r.shift(),i=e?[Mn.create({text:e},{translate:!0})]:[];if(!o)return i;const c=t&&"NUMBER"===B(t),a=s&&"NUMBER"===B(s);return i.concat(c&&a&&o.getAttribute("role")===z.SPACE?[Mn.create({text:at.MESSAGES.regexp.SPACE},{})]:[])}}function di(t,e){var n;let r=xn(t,e),s=null===(n=t[0].parentNode.parentNode.getAttribute("annotation"))||void 0===n?void 0:n.match(/depth:(\d+)/),o=s?s[1]:"";return function(){const t=r();return t.unshift(new Mn({text:"",layout:`beginrel${o}`})),t.push(new Mn({text:"",layout:`endrel${o}`})),t}}kn(new vn("nemeth","number",(function(t,e){return t.childNodes.length?(-1!==ai.indexOf(t.type)&&(e.script=!0),t.type===K.FENCED?(e.number=!1,e.enclosed=!0,["",e]):t.type===K.PREFIXOP&&t.role!==z.GEOMETRY&&t.role!==z.NEGATIVE?(e.number=!1,["",e]):(li(t,e)&&(e.number=!0,e.enclosed=!1),["",e])):(li(t,e)&&(e.number=!0,e.script=!1,e.enclosed=!1),[e.number?"number":"",{number:!1,enclosed:e.enclosed,script:e.script}])}),{number:!0})),kn(new vn("depth","depth",(function(t){return t.parent?[parseInt(t.parent.annotation.depth[0])+1]:[1]}))),Gn("depth","depth"),mt.getInstance().setCorrection("ignoreEnglish",(function(t){return Et(t,at.ALPHABETS.languagePrefix.english)}));let fi=!1;function pi(){fi||(Pn(o.BASE_LOCALE+".speech.mathspeak","",{CQFspaceoutNumber:As,CQFspaceoutIdentifier:Rs,CSFspaceoutText:Ts,CSFopenFracVerbose:_s,CSFcloseFracVerbose:Ps,CSFoverFracVerbose:Fs,CSFopenFracBrief:Us,CSFcloseFracBrief:xs,CSFopenFracSbrief:Ds,CSFcloseFracSbrief:vs,CSFoverFracSbrief:ws,CSFvulgarFraction:Eo,CQFvulgarFractionSmall:Bs,CSFopenRadicalVerbose:Ks,CSFcloseRadicalVerbose:qs,CSFindexRadicalVerbose:zs,CSFopenRadicalBrief:Qs,CSFcloseRadicalBrief:Js,CSFindexRadicalBrief:Zs,CSFopenRadicalSbrief:to,CSFindexRadicalSbrief:eo,CQFisSmallRoot:fo,CSFsuperscriptVerbose:js,CSFsuperscriptBrief:$s,CSFsubscriptVerbose:Gs,CSFsubscriptBrief:Vs,CSFbaselineVerbose:Hs,CSFbaselineBrief:Xs,CSFleftsuperscriptVerbose:js,CSFleftsubscriptVerbose:Gs,CSFrightsuperscriptVerbose:js,CSFrightsubscriptVerbose:Gs,CSFleftsuperscriptBrief:$s,CSFleftsubscriptBrief:Vs,CSFrightsuperscriptBrief:$s,CSFrightsubscriptBrief:Vs,CSFunderscript:no,CSFoverscript:so,CSFendscripts:ro,CTFordinalCounter:po,CTFwordCounter:mo,CTFcontentIterator:xn,CQFdetIsSimple:oo,CSFRemoveParens:co,CQFresetNesting:Cs,CGFbaselineConstraint:io,CGFtensorRules:ho}),Pn("es.speech.mathspeak",o.BASE_LOCALE+".speech.mathspeak",{CTFunitMultipliers:Wo,CQFoneLeft:zo}),Pn("fr.speech.mathspeak",o.BASE_LOCALE+".speech.mathspeak",{CSFbaselineVerbose:No,CSFbaselineBrief:So,CSFleftsuperscriptVerbose:To,CSFleftsubscriptVerbose:Io,CSFleftsuperscriptBrief:Ao,CSFleftsubscriptBrief:Ro}),Pn("ko.speech.mathspeak",o.BASE_LOCALE+".speech.mathspeak",{CSFopenFracVerbose:Co,CSFcloseFracVerbose:bo,CSFopenFracBrief:Lo,CSFcloseFracBrief:yo,CSFopenFracSbrief:Mo,CSFoverFracSbrief:Po,CSFcloseFracSbrief:_o,CQFisSimpleIndex:Fo,CSFindexRadicalVerbose:Go,CSFindexRadicalBrief:Vo,CSFindexRadicalSbrief:jo,CSFopenRadicalVerbose:xo,CSFcloseRadicalVerbose:Do,CSFopenRadicalBrief:vo,CSFcloseRadicalBrief:wo,CSFopenRadicalSbrief:Bo}),Pn(o.BASE_LOCALE+".speech.clearspeak","",{CTFpauseSeparator:Un,CTFnodeCounter:Vn,CTFcontentIterator:xn,CSFvulgarFraction:Eo,CQFvulgarFractionSmall:Qn,CQFcellsSimple:zn,CSFordinalExponent:Zn,CSFwordOrdinal:cr,CQFmatchingFences:nr,CSFnestingDepth:er,CQFfencedArguments:rr,CQFsimpleArguments:sr,CQFspaceoutNumber:As}),Pn("en.prefix.default","",{CSFordinalPosition:go}),Pn("en.speech.chromevox","",{CTFnodeCounter:Fn,CTFcontentIterator:xn}),Pn("en.speech.emacspeak","en.speech.chromevox",{CQFvulgarFractionSmall:Bs,CSFvulgarFraction:Eo}),Pn("ko.summary.","ko.speech.mathspeak",{CSFordinalConversion:$o,CSFdecreasedOrdinalConversion:Ho,CSFlistOrdinalConversion:Xo}),Pn("nemeth.braille.default",o.BASE_LOCALE+".speech.mathspeak",{CSFopenFraction:Qo,CSFcloseFraction:Jo,CSFoverFraction:Zo,CSFoverBevFraction:ti,CQFhyperFraction:ei,CSFopenRadical:si,CSFcloseRadical:oi,CSFindexRadical:ii,CSFsubscript:Gs,CSFsuperscript:js,CSFbaseline:Hs,CGFtensorRules:t=>ho(t,!1),CTFcontentIterator:di,CTFrelationIterator:ui,CTFimplicitIterator:hi}),Pn("euro.braille.default","nemeth.braille.default",{}),fi=!0)}class mi{constructor(t,e,n,r){this.name=t,this.dynamicCstr=e,this.precondition=n,this.action=r,this.context=null}toString(){return this.name+" | "+this.dynamicCstr.toString()+" | "+this.precondition.toString()+" ==> "+this.action.toString()}}var Ei,gi;function Ni(t){switch(t){case"[n]":return Ei.NODE;case"[m]":return Ei.MULTI;case"[t]":return Ei.TEXT;case"[p]":return Ei.PERSONALITY;default:throw"Parse error: "+t}}!function(t){t.NODE="NODE",t.MULTI="MULTI",t.TEXT="TEXT",t.PERSONALITY="PERSONALITY"}(Ei||(Ei={}));class Si{static grammarFromString(t){return mt.parseInput(t)}static fromString(t){const e={type:Ni(t.substring(0,3))};let n=t.slice(3).trim();if(!n)throw new Ai("Missing content.");switch(e.type){case Ei.TEXT:if('"'===n[0]){const t=Ri(n,"\\(")[0].trim();if('"'!==t.slice(-1))throw new Ai("Invalid string syntax.");e.content=t,n=n.slice(t.length).trim(),-1===n.indexOf("(")&&(n="");break}case Ei.NODE:case Ei.MULTI:{const t=n.indexOf(" (");if(-1===t){e.content=n.trim(),n="";break}e.content=n.substring(0,t).trim(),n=n.slice(t).trim()}}if(n){const t=Si.attributesFromString(n);t.grammar&&(e.grammar=t.grammar,delete t.grammar),Object.keys(t).length&&(e.attributes=t)}return new Si(e)}static attributesFromString(t){if("("!==t[0]||")"!==t.slice(-1))throw new Ai("Invalid attribute expression: "+t);const e={},n=Ri(t.slice(1,-1),",");for(const t of n){const n=t.indexOf(":");if(-1===n)e[t.trim()]="true";else{const r=t.substring(0,n).trim(),s=t.slice(n+1).trim();e[r]=r===pt?Si.grammarFromString(s):s}}return e}constructor({type:t,content:e,attributes:n,grammar:r}){this.type=t,this.content=e,this.attributes=n,this.grammar=r}toString(){let t="";t+=function(t){switch(t){case Ei.NODE:return"[n]";case Ei.MULTI:return"[m]";case Ei.TEXT:return"[t]";case Ei.PERSONALITY:return"[p]";default:throw"Unknown type error: "+t}}(this.type),t+=this.content?" "+this.content:"";const e=this.attributesToString();return t+=e?" "+e:"",t}grammarToString(){return this.getGrammar().join(":")}getGrammar(){if(!this.grammar)return[];const t=[];for(const[e,n]of Object.entries(this.grammar))t.push(!0===n?e:!1===n?`!${e}`:`${e}=${n}`);return t}attributesToString(){const t=this.getAttributes(),e=this.grammarToString();return e&&t.push("grammar:"+e),t.length>0?"("+t.join(", ")+")":""}getAttributes(){if(!this.attributes)return[];const t=[];for(const[e,n]of Object.entries(this.attributes))t.push("true"===n?e:`${e}:${n}`);return t}}class Ti{static fromString(t){const e=Ri(t,";").filter((function(t){return t.match(/\S/)})).map((function(t){return t.trim()})),n=[];for(let t=0,r=e.length;t<r;t++){const r=Si.fromString(e[t]);r&&n.push(r)}return Ti.naiveSpan(n),new Ti(n)}static naiveSpan(t){var e;let n=!1;for(let r,s=0;r=t[s];s++){if(n&&(r.type!==Ei.TEXT||'"'!==r.content[0]&&!r.content.match(/^CSF/)))continue;if(!n&&r.type===Ei.PERSONALITY)continue;if(!n){n=!0;continue}if(null===(e=r.attributes)||void 0===e?void 0:e.span)continue;const o=t[s+1];o&&o.type!==Ei.NODE||Ti.addNaiveSpan(r,o?o.content:"LAST")}}static addNaiveSpan(t,e){t.attributes||(t.attributes={}),t.attributes.span=e}constructor(t){this.components=t}toString(){return this.components.map((function(t){return t.toString()})).join("; ")}}class Ii{static constraintValue(t,e){for(let n,r=0;n=e[r];r++)if(t.match(n))return++r;return 0}toString(){const t=this.constraints.join(", ");return`${this.query}, ${t} (${this.priority}, ${this.rank})`}constructor(t,...e){this.query=t,this.constraints=e;const[n,r]=this.presetPriority();this.priority=n?r:this.calculatePriority()}calculatePriority(){const t=Ii.constraintValue(this.query,Ii.queryPriorities);if(!t)return 0;const e=this.query.match(/^self::.+\[(.+)\]/);let n=0;if((null==e?void 0:e.length)&&e[1]){const t=e[1];n=Ii.constraintValue(t,Ii.attributePriorities)}return 100*t+10*n}presetPriority(){if(!this.constraints.length)return[!1,0];const t=this.constraints[this.constraints.length-1].match(/^priority=(.*$)/);if(!t)return[!1,0];this.constraints.pop();const e=parseFloat(t[1]);return[!0,isNaN(e)?0:e]}}Ii.queryPriorities=[/^self::\*$/,/^self::[\w-]+$/,/^self::\*\[.+\]$/,/^self::[\w-]+\[.+\]$/],Ii.attributePriorities=[/^@[\w-]+$/,/^@[\w-]+!=".+"$/,/^not\(contains\(@[\w-]+,\s*".+"\)\)$/,/^contains\(@[\w-]+,".+"\)$/,/^@[\w-]+=".+"$/];class Ai extends m{constructor(t){super(t),this.name="RuleError"}}function Ri(t,e){const n=[];let r="";for(;""!==t;){const s=t.search(e);if(-1===s){if((t.match(/"/g)||[]).length%2!=0)throw new Ai("Invalid string in expression: "+t);n.push(r+t),r="",t=""}else if((t.substring(0,s).match(/"/g)||[]).length%2==0)n.push(r+t.substring(0,s)),r="",t=t.substring(s+1);else{const e=t.substring(s).search('"');if(-1===e)throw new Ai("Invalid string in expression: "+t);r+=t.substring(0,s+e+1),t=t.substring(s+e+1)}}return r&&n.push(r),n}class Oi{constructor(t,e){this.prefix=t,this.store=e}add(t,e){this.checkCustomFunctionSyntax_(t)&&(this.store[t]=e)}addStore(t){const e=Object.keys(t.store);for(let n,r=0;n=e[r];r++)this.add(n,t.store[n])}lookup(t){return this.store[t]}checkCustomFunctionSyntax_(t){const e=new RegExp("^"+this.prefix);return!!t.match(e)||(console.error("FunctionError: Invalid function name. Expected prefix "+this.prefix),!1)}}class Ci extends Oi{constructor(){super("CQF",{})}}class bi extends Oi{constructor(){super("CSF",{})}}class Li extends Oi{constructor(){super("CTF",{})}}class yi extends Oi{constructor(){super("CGF",{})}}class Mi{constructor(){this.customQueries=new Ci,this.customStrings=new bi,this.contextFunctions=new Li,this.customGenerators=new yi}applyCustomQuery(t,e){const n=this.customQueries.lookup(e);return n?n(t):null}applySelector(t,e){return this.applyCustomQuery(t,e)||O(e,t)}applyQuery(t,e){const n=this.applySelector(t,e);return n.length>0?n[0]:null}applyConstraint(t,e){return!!this.applyQuery(t,e)||function(t,e){let n;try{n=R(t,e,S.result.BOOLEAN_TYPE)}catch(t){return!1}return n.booleanValue}(e,t)}constructString(t,e){const n=this.constructString_(t,e);return Array.isArray(n)?n.map((t=>t.speech)).join(""):n}constructSpan(t,e,n){const r=this.constructString_(t,e);if(Array.isArray(r)){const t=r[r.length-1];return t.attributes=Object.assign({},n,t.attributes),r}return[bn.node(r,t,n)]}constructString_(t,e){if(!e)return"";if('"'===e.charAt(0))return e.slice(1,-1);const n=this.customStrings.lookup(e);return n?n(t):function(t,e){let n;try{n=R(t,e,S.result.STRING_TYPE)}catch(t){return""}return n.stringValue}(e,t)}parse(t){const e=Array.isArray(t)?t:Object.entries(t);for(const t of e){switch(t[0].slice(0,3)){case"CQF":this.customQueries.add(t[0],t[1]);break;case"CSF":this.customStrings.add(t[0],t[1]);break;case"CTF":this.contextFunctions.add(t[0],t[1]);break;case"CGF":this.customGenerators.add(t[0],t[1]);break;default:console.error("FunctionError: Invalid function name "+t[0])}}}}class _i{static compareStaticConstraints_(t,e){if(t.length!==e.length)return!1;for(let n,r=0;n=t[r];r++)if(-1===e.indexOf(n))return!1;return!0}static comparePreconditions_(t,e){const n=t.precondition,r=e.precondition;return n.query===r.query&&_i.compareStaticConstraints_(n.constraints,r.constraints)}constructor(){this.context=new Mi,this.parseOrder=o.DEFAULT_ORDER,this.parser=new i(this.parseOrder),this.locale=o.DEFAULT_VALUES[t.LOCALE],this.modality=o.DEFAULT_VALUES[t.MODALITY],this.domain="",this.initialized=!1,this.inherits=null,this.kind="standard",this.customTranscriptions={},this.preconditions=new Map,this.speechRules_=[],this.rank=0,this.parseMethods={Rule:this.defineRule,Generator:this.generateRules,Action:this.defineAction,Precondition:this.definePrecondition,Ignore:this.ignoreRules}}defineRule(t,e,n,r,...s){const o=this.parseAction(n),i=this.parsePrecondition(r,s),c=this.parseCstr(e);if(!(o&&i&&c))return console.error(`Rule Error: ${r}, (${e}): ${n}`),null;const a=new mi(t,c,i,o);return a.precondition.rank=this.rank++,this.addRule(a),a}addRule(t){t.context=this.context,this.speechRules_.unshift(t)}deleteRule(t){const e=this.speechRules_.indexOf(t);-1!==e&&this.speechRules_.splice(e,1)}findRule(t){for(let e,n=0;e=this.speechRules_[n];n++)if(t(e))return e;return null}findAllRules(t){return this.speechRules_.filter(t)}evaluateDefault(t){const e=t.textContent.slice(0);return e.match(/^\s+$/)?this.evaluateWhitespace(e):this.evaluateString(e)}evaluateWhitespace(t){return[]}evaluateCustom(t){const e=this.customTranscriptions[t];return void 0!==e?Mn.create({text:e},{adjust:!0,translate:!1}):null}evaluateCharacter(t){return this.evaluateCustom(t)||Mn.create({text:t},{adjust:!0,translate:!0})}removeDuplicates(t){for(let e,n=this.speechRules_.length-1;e=this.speechRules_[n];n--)e!==t&&t.dynamicCstr.equal(e.dynamicCstr)&&_i.comparePreconditions_(e,t)&&this.speechRules_.splice(n,1)}getSpeechRules(){return this.speechRules_}setSpeechRules(t){this.speechRules_=t}getPreconditions(){return this.preconditions}parseCstr(t){try{return this.parser.parse(this.locale+"."+this.modality+(this.domain?"."+this.domain:"")+"."+t)}catch(e){if("RuleError"===e.name)return console.error("Rule Error ",`Illegal Dynamic Constraint: ${t}.`,e.message),null;throw e}}parsePrecondition(t,e){try{const n=this.parsePrecondition_(t);t=n[0];let r=n.slice(1);for(const t of e)r=r.concat(this.parsePrecondition_(t));return new Ii(t,...r)}catch(n){if("RuleError"===n.name)return console.error("Rule Error ",`Illegal preconditions: ${t}, ${e}.`,n.message),null;throw n}}parseAction(t){try{return Ti.fromString(t)}catch(e){if("RuleError"===e.name)return console.error("Rule Error ",`Illegal action: ${t}.`,e.message),null;throw e}}parse(t){this.modality=t.modality||this.modality,this.locale=t.locale||this.locale,this.domain=t.domain||this.domain,this.context.parse(t.functions||[]),"actions"!==t.kind&&(this.kind=t.kind||this.kind,this.inheritRules()),this.parseRules(t.rules||[])}parseRules(t){for(let e,n=0;e=t[n];n++){const t=e[0],n=this.parseMethods[t];t&&n&&n.apply(this,e.slice(1))}}generateRules(t){const e=this.context.customGenerators.lookup(t);e&&e(this)}defineAction(t,e){let n;try{n=Ti.fromString(e)}catch(t){if("RuleError"===t.name)return void console.error("Action Error ",e,t.message);throw t}const r=this.getFullPreconditions(t);if(!r)return void console.error(`Action Error: No precondition for action ${t}`);this.ignoreRules(t);const s=new RegExp("^\\w+\\.\\w+\\."+(this.domain?"\\w+\\.":""));r.conditions.forEach((([e,r])=>{const o=this.parseCstr(e.toString().replace(s,""));this.addRule(new mi(t,o,r,n))}))}getFullPreconditions(t){const e=this.preconditions.get(t);return e||!this.inherits?e:this.inherits.getFullPreconditions(t)}definePrecondition(t,e,n,...r){const s=this.parsePrecondition(n,r),o=this.parseCstr(e);s&&o?(s.rank=this.rank++,this.preconditions.set(t,new Pi(o,s))):console.error(`Precondition Error: ${n}, (${e})`)}inheritRules(){if(!this.inherits||!this.inherits.getSpeechRules().length)return;const t=new RegExp("^\\w+\\.\\w+\\."+(this.domain?"\\w+\\.":""));this.inherits.getSpeechRules().forEach((e=>{const n=this.parseCstr(e.dynamicCstr.toString().replace(t,""));this.addRule(new mi(e.name,n,e.precondition,e.action))}))}ignoreRules(t,...e){let n=this.findAllRules((e=>e.name===t));if(!e.length)return void n.forEach(this.deleteRule.bind(this));let r=[];for(const t of e){const e=this.parseCstr(t);for(const t of n)e.equal(t.dynamicCstr)?this.deleteRule(t):r.push(t);n=r,r=[]}}parsePrecondition_(t){const e=this.context.customGenerators.lookup(t);return e?e():[t]}}class Pi{constructor(t,e){this.base=t,this._conditions=[],this.constraints=[],this.allCstr={},this.constraints.push(t),this.addCondition(t,e)}get conditions(){return this._conditions}addConstraint(t){if(this.constraints.filter((e=>e.equal(t))).length)return;this.constraints.push(t);const e=[];for(const[n,r]of this.conditions)this.base.equal(n)&&e.push([t,r]);this._conditions=this._conditions.concat(e)}addBaseCondition(t){this.addCondition(this.base,t)}addFullCondition(t){this.constraints.forEach((e=>this.addCondition(e,t)))}addCondition(t,e){const n=t.toString()+" "+e.toString();this.allCstr.condStr||(this.allCstr[n]=!0,this._conditions.push([t,e]))}}class Fi extends _i{constructor(){super(),this.annotators=[],this.parseMethods.Alias=this.defineAlias,this.parseMethods.SpecializedRule=this.defineSpecializedRule,this.parseMethods.Specialized=this.defineSpecialized}initialize(){this.initialized||(this.annotations(),this.initialized=!0)}annotations(){for(let t,e=0;t=this.annotators[e];e++)Gn(this.domain,t)}defineAlias(t,e,...n){const r=this.parsePrecondition(e,n);if(!r)return void console.error(`Precondition Error: ${e} ${n}`);const s=this.preconditions.get(t);s?s.addFullCondition(r):console.error(`Alias Error: No precondition by the name of ${t}`)}defineRulesAlias(t,e,...n){const r=this.findAllRules((function(e){return e.name===t}));if(0===r.length)throw new Ai("Rule with name "+t+" does not exist.");const s=[];r.forEach((t=>{(t=>{const e=t.dynamicCstr.toString(),n=t.action.toString();for(let t,r=0;t=s[r];r++)if(t.action===n&&t.cstr===e)return!1;return s.push({cstr:e,action:n}),!0})(t)&&this.addAlias_(t,e,n)}))}defineSpecializedRule(t,e,n,r){const s=this.parseCstr(e),o=this.findRule((e=>e.name===t&&s.equal(e.dynamicCstr))),i=this.parseCstr(n);if(!o&&r)throw new Ai("Rule named "+t+" with style "+e+" does not exist.");const c=r?Ti.fromString(r):o.action,a=new mi(o.name,i,o.precondition,c);this.addRule(a)}defineSpecialized(t,e,n){const r=this.parseCstr(n);if(!r)return void console.error(`Dynamic Constraint Error: ${n}`);const s=this.preconditions.get(t);s?s.addConstraint(r):console.error(`Alias Error: No precondition by the name of ${t}`)}evaluateString(t){const e=[];if(t.match(/^\s+$/))return e;let n=this.matchNumber(t);if(n&&n.length===t.length)return e.push(this.evaluateCharacter(n.number)),e;const r=t.replace(/\s/g," ").split(" ").filter((t=>t));for(let t,s=0;t=r[s];s++)if(1===t.length)e.push(this.evaluateCharacter(t));else if(t.match(new RegExp("^["+at.MESSAGES.regexp.TEXT+"]+$")))e.push(this.evaluateCharacter(t));else{let r=t;for(;r;){n=this.matchNumber(r);const t=r.match(new RegExp("^["+at.MESSAGES.regexp.TEXT+"]+"));if(n)e.push(this.evaluateCharacter(n.number)),r=r.substring(n.length);else if(t)e.push(this.evaluateCharacter(t[0])),r=r.substring(t[0].length);else{const t=Array.from(r),n=t[0];e.push(this.evaluateCharacter(n)),r=t.slice(1).join("")}}}return e}parse(t){super.parse(t),this.annotators=t.annotators||[]}addAlias_(t,e,n){const r=this.parsePrecondition(e,n),s=new mi(t.name,t.dynamicCstr,r,t.action);s.name=t.name,this.addRule(s)}matchNumber(t){const e=t.match(new RegExp("^"+at.MESSAGES.regexp.NUMBER)),n=t.match(new RegExp("^"+Fi.regexp.NUMBER));if(!e&&!n)return null;const r=n&&n[0]===t;if(e&&e[0]===t||!r)return e?{number:e[0],length:e[0].length}:null;return{number:n[0].replace(new RegExp(Fi.regexp.DIGIT_GROUP,"g"),"X").replace(new RegExp(Fi.regexp.DECIMAL_MARK,"g"),at.MESSAGES.regexp.DECIMAL_MARK).replace(/X/g,at.MESSAGES.regexp.DIGIT_GROUP.replace(/\\/g,"")),length:n[0].length}}}Fi.regexp={NUMBER:"((\\d{1,3})(?=(,| ))((,| )\\d{3})*(\\.\\d+)?)|^\\d*\\.\\d+|^\\d+",DECIMAL_MARK:"\\.",DIGIT_GROUP:","};class Ui extends Fi{constructor(){super(...arguments),this.modality="braille",this.customTranscriptions={"\u22ca":"\u2808\u2821\u2833"}}evaluateString(t){const e=[],n=Array.from(t);for(let t=0;t<n.length;t++)e.push(this.evaluateCharacter(n[t]));return e}annotations(){for(let t,e=0;t=this.annotators[e];e++)Gn(this.locale,t)}}class xi extends Ui{constructor(){super(...arguments),this.locale="euro",this.customTranscriptions={},this.customCommands={"\\cdot":"*","\\lt":"<","\\gt":">"},this.lastSpecial=!1,this.specialChars=["^","_","{","}"]}evaluateString(t){let e=t.split(/(\\[a-z]+|\\{|\\}|\\\\)/i),n=this.cleanup(e);return super.evaluateString(n)}cleanup(t){let e=[],n=!1,r=null;for(let s of t){if(s.match(/^\\/)){"\\text"===s&&(n=!0),this.addSpace(rn.LatexCommands.get(s))&&e.push(" "),s=this.customCommands[s]||s;let t=s.match(/^\\/);t&&s.match(/^\\[a-zA-Z]+$/)&&r&&e.push(" "),r=t?s:null,e.push(s);continue}let t=s.split("");for(let s of t)n?(e.push(s),n="}"!==s,r=null):s.match(/[a-z]/i)&&r?(r=null,e.push(" "),e.push(s)):s.match(/\s/)||(this.addSpace(s)&&e.push(" "),e.push(s),r=null)}return e.join("")}addSpace(t){if(!t)return!1;if(-1!==this.specialChars.indexOf(t))return this.lastSpecial=!0,!1;if(this.lastSpecial)return this.lastSpecial=!1,!1;let e=rn.Meaning.get(t);return e.type===K.OPERATOR||e.type===K.RELATION||e.type===K.PUNCTUATION&&e.role===z.COLON}}!function(t){t.ROOT="root",t.DYNAMIC="dynamic",t.QUERY="query",t.BOOLEAN="boolean",t.STATIC="static"}(gi||(gi={}));class Di{constructor(t,e){this.constraint=t,this.test=e,this.children_={},this.kind=gi.ROOT}getConstraint(){return this.constraint}getKind(){return this.kind}applyTest(t){return this.test(t)}addChild(t){const e=t.getConstraint(),n=this.children_[e];return this.children_[e]=t,n}getChild(t){return this.children_[t]}getChildren(){const t=[];for(const e of Object.values(this.children_))t.push(e);return t}findChildren(t){const e=[];for(const n of Object.values(this.children_))n.applyTest(t)&&e.push(n);return e}removeChild(t){delete this.children_[t]}toString(){return this.constraint}}class vi extends Di{constructor(t,e){super(t,e),this.rule_=null,this.kind=gi.STATIC}getRule(){return this.rule_}setRule(t){this.rule_&&f.getInstance().output("Replacing rule "+this.rule_+" with "+t),this.rule_=t}toString(){return this.getRule()?this.constraint+"\n==> "+this.getRule().action:this.constraint}}function wi(t,e,n){switch(t){case gi.ROOT:return new Bi;case gi.DYNAMIC:return new ki(e);case gi.QUERY:return new ji(e,n);case gi.BOOLEAN:return new $i(e,n);default:return null}}class Bi extends Di{constructor(){super("",(()=>!0)),this.kind=gi.ROOT}}class ki extends Di{constructor(t){super(t,(e=>e===t)),this.kind=gi.DYNAMIC}}const Gi={"=":(t,e)=>t===e,"!=":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e};function Vi(t){if(t.match(/^self::\*$/))return t=>!0;if(t.match(/^self::\w+$/)){const e=t.slice(6).toUpperCase();return t=>t.tagName&&B(t)===e}if(t.match(/^self::\w+:\w+$/)){const e=t.split(":"),n=I(e[2]);if(!n)return null;const r=e[3].toUpperCase();return t=>t.localName&&t.localName.toUpperCase()===r&&t.namespaceURI===n}if(t.match(/^@\w+$/)){const e=t.slice(1);return t=>t.hasAttribute&&t.hasAttribute(e)}if(t.match(/^@\w+="[\w\d ]+"$/)){const e=t.split("="),n=e[0].slice(1),r=e[1].slice(1,-1);return t=>t.hasAttribute&&t.hasAttribute(n)&&t.getAttribute(n)===r}if(t.match(/^@\w+!="[\w\d ]+"$/)){const e=t.split("!="),n=e[0].slice(1),r=e[1].slice(1,-1);return t=>!t.hasAttribute||!t.hasAttribute(n)||t.getAttribute(n)!==r}if(t.match(/^contains\(\s*@grammar\s*,\s*"[\w\d ]+"\s*\)$/)){const e=t.split('"')[1];return t=>!!mt.getInstance().getParameter(e)}if(t.match(/^not\(\s*contains\(\s*@grammar\s*,\s*"[\w\d ]+"\s*\)\s*\)$/)){const e=t.split('"')[1];return t=>!mt.getInstance().getParameter(e)}if(t.match(/^name\(\.\.\/\.\.\)="\w+"$/)){const e=t.split('"')[1].toUpperCase();return t=>{var n,r;return(null===(r=null===(n=t.parentNode)||void 0===n?void 0:n.parentNode)||void 0===r?void 0:r.tagName)&&B(t.parentNode.parentNode)===e}}if(t.match(/^count\(preceding-sibling::\*\)=\d+$/)){const e=t.split("="),n=parseInt(e[1],10);return t=>{var e;return(null===(e=t.parentNode)||void 0===e?void 0:e.childNodes[n])===t}}if(t.match(/^.+\[@category!?=".+"\]$/)){let[,e,n,r]=t.match(/^(.+)\[@category(!?=)"(.+)"\]$/);const s=r.match(/^unit:(.+)$/);let o="";return s&&(r=s[1],o=":unit"),t=>{const s=O(e,t)[0];if(s){const t=function(t){const e=mn.get(t);return(null==e?void 0:e.base)?e.base.category:""}(s.textContent+o);return"="===n?t===r:t!==r}return!1}}if(t.match(/^string-length\(.+\)\W+\d+/)){const[,e,n,r]=t.match(/^string-length\((.+)\)(\W+)(\d+)/),s=Gi[n]||Gi["="],o=parseInt(r,10);return t=>{const n=O(e,t)[0];return!!n&&s(Array.from(n.textContent).length,o)}}return null}class ji extends vi{constructor(t,e){super(t,Vi(t)),this.context=e,this.kind=gi.QUERY}applyTest(t){return this.test?this.test(t):this.context.applyQuery(t,this.constraint)===t}}class $i extends vi{constructor(t,e){super(t,Vi(t)),this.context=e,this.kind=gi.BOOLEAN}applyTest(t){return this.test?this.test(t):this.context.applyConstraint(t,this.constraint)}}class Hi{static collectRules_(t){const e=[];let n=[t];for(;n.length;){const t=n.shift();if(t.getKind()===gi.QUERY||t.getKind()===gi.BOOLEAN){const n=t.getRule();n&&e.unshift(n)}n=n.concat(t.getChildren())}return e}static printWithDepth_(t,e,n){n+=new Array(e+2).join(e.toString())+": "+t.toString()+"\n";const r=t.getChildren();for(let t,s=0;t=r[s];s++)n=Hi.printWithDepth_(t,e+1,n);return n}static order_(t){const e=t.getChildren();if(!e.length)return 0;const n=Math.max.apply(null,e.map(Hi.order_));return Math.max(e.length,n)}constructor(){this.root=wi(gi.ROOT,"",null)}addRule(t){let e=this.root;const n=t.context,r=t.dynamicCstr.getValues();for(let t=0,s=r.length;t<s;t++)e=this.addNode_(e,r[t],gi.DYNAMIC,n);e=this.addNode_(e,t.precondition.query,gi.QUERY,n);const s=t.precondition.constraints;for(let t=0,r=s.length;t<r;t++)e=this.addNode_(e,s[t],gi.BOOLEAN,n);e.setRule(t)}lookupRules(t,e){let n=[this.root];const r=[];for(;e.length;){const t=e.shift(),r=[];for(;n.length;){n.shift().getChildren().forEach((e=>{e.getKind()===gi.DYNAMIC&&-1===t.indexOf(e.getConstraint())||r.push(e)}))}n=r.slice()}for(;n.length;){const e=n.shift();if(e.getRule){const t=e.getRule();t&&r.push(t)}const s=e.findChildren(t);n=n.concat(s)}return r}hasSubtrie(t){let e=this.root;for(let n=0,r=t.length;n<r;n++){const r=t[n];if(e=e.getChild(r),!e)return!1}return!0}toString(){return Hi.printWithDepth_(this.root,0,"")}collectRules(t=this.root){return Hi.collectRules_(t)}order(){return Hi.order_(this.root)}enumerate(t){return this.enumerate_(this.root,t)}byConstraint(t){let e=this.root;for(;t.length&&e;){const n=t.shift();e=e.getChild(n)}return e||null}enumerate_(t,e){e=e||{};const n=t.getChildren();for(let t,r=0;t=n[r];r++)t.kind===gi.DYNAMIC&&(e[t.getConstraint()]=this.enumerate_(t,e[t.getConstraint()]));return e}addNode_(t,e,n,r){let s=t.getChild(e);return s||(s=wi(n,e,r),t.addChild(s)),s}}class Xi{static getInstance(){return Xi.instance=Xi.instance||new Xi,Xi.instance}static debugSpeechRule(t,e){const n=t.precondition,r=t.context.applyQuery(e,n.query);f.getInstance().output(n.query,r?r.toString():r),n.constraints.forEach((n=>f.getInstance().output(n,t.context.applyConstraint(e,n))))}static debugNamedSpeechRule(t,e){const n=Xi.getInstance().trie.collectRules().filter((e=>e.name==t));for(let r,s=0;r=n[s];s++)f.getInstance().output("Rule",t,"DynamicCstr:",r.dynamicCstr.toString(),"number",s),Xi.debugSpeechRule(r,e)}evaluateNode(t){C(t);const e=(new Date).getTime();let n=[];try{n=this.evaluateNode_(t)}catch(t){console.log(t),console.error("Something went wrong computing speech."),f.getInstance().output(t)}const r=(new Date).getTime();return f.getInstance().output("Time:",r-e),n}toString(){return this.trie.collectRules().map((t=>t.toString())).join("\n")}runInSetting(t,e){const n=E.getInstance(),r={};for(const[e,s]of Object.entries(t))r[e]=n[e],n[e]=s;n.setDynamicCstr();const s=e();for(const[t,e]of Object.entries(r))n[t]=e;return n.setDynamicCstr(),s}static addStore(e){const n=function(e){const n=`${e.locale}.${e.modality}.${e.domain}`;if("actions"===e.kind){const t=Wi.get(n);return t.parse(e),t}pi(),e&&!e.functions&&(e.functions=function(e,n,r){return _n.get([e,n,r].join("."))||_n.get([o.DEFAULT_VALUES[t.LOCALE],n,r].join("."))||_n.get([o.BASE_LOCALE,n,r].join("."))||{}}(e.locale,e.modality,e.domain));const r=function(t,e){if("braille"===e&&"euro"===t)return new xi;if("braille"===e)return new Ui;return new Fi}(e.locale,e.modality);Wi.set(n,r),e.inherits&&(r.inherits=Wi.get(`${e.inherits}.${e.modality}.${e.domain}`));return r.parse(e),r.initialize(),r}(e);"abstract"!==n.kind&&n.getSpeechRules().forEach((t=>Xi.getInstance().trie.addRule(t))),Xi.getInstance().addEvaluator(n)}processGrammar(t,e,n){const r={};for(const[s,o]of Object.entries(n))r[s]="string"==typeof o?t.constructString(e,o):o;mt.getInstance().pushState(r)}addEvaluator(t){const e=t.evaluateDefault.bind(t),n=this.evaluators_[t.locale];if(n)return void(n[t.modality]=e);const r={};r[t.modality]=e,this.evaluators_[t.locale]=r}getEvaluator(e,n){const r=this.evaluators_[e]||this.evaluators_[o.DEFAULT_VALUES[t.LOCALE]];return r[n]||r[o.DEFAULT_VALUES[t.MODALITY]]}enumerate(t){return this.trie.enumerate(t)}constructor(){this.trie=null,this.evaluators_={},this.trie=new Hi}evaluateNode_(t){if(!t)return[];this.updateConstraint_();let e=this.evaluateTree_(t);return e=function(t){let e=new yn(t);for(let t of e.annotations){let n=t.data;if("punctuation"===n.annotation){let r=e.prevText(t);if(!r)continue;let s=r.data;"punctuation"!==s.annotation&&"\u2800"!==s.text&&1===n.text.length&&-1!==Yi.indexOf(n.text)&&(n.text="\u2838"+n.text)}}return e.toList()}(e),e}evaluateTree_(t){const n=E.getInstance();let r;f.getInstance().output(n.mode!==e.HTTP?t.toString():t),mt.getInstance().setAttribute(t);const s=this.lookupRule(t,n.dynamicCstr);if(!s)return n.strict?[]:(r=this.getEvaluator(n.locale,n.modality)(t),t.attributes&&this.addPersonality_(r,{},!1,t),r);f.getInstance().generateOutput((()=>["Apply Rule:",s.name,s.dynamicCstr.toString(),n.mode===e.HTTP?G(t):t.toString()])),mt.getInstance().processSingles();const o=s.context,i=s.action.components;r=[];for(let e,n=0;e=i[n];n++){let n=[];const s=e.content||"",i=e.attributes||{};let c=!1;e.grammar&&this.processGrammar(o,t,e.grammar);let a=null;if(i.engine){a=E.getInstance().dynamicCstr.getComponents();const t=Object.assign({},a,mt.parseInput(i.engine));E.getInstance().setDynamicCstr(t),this.updateConstraint_()}switch(e.type){case Ei.NODE:{const e=o.applyQuery(t,s);e&&(n=this.evaluateTree_(e))}break;case Ei.MULTI:{c=!0;const e=o.applySelector(t,s);e.length>0&&(n=this.evaluateNodeList_(o,e,i.sepFunc,o.constructString(t,i.separator),i.ctxtFunc,o.constructString(t,i.context)))}break;case Ei.TEXT:{const e=i.span;let r={};if(e){const n=O(e,t);r=n.length?bn.getAttributes(n[0]):{kind:e}}n=o.constructSpan(t,s,r).map((function(t){return Mn.create({text:t.speech,attributes:t.attributes},{adjust:!0})}))}break;case Ei.PERSONALITY:default:n=[Mn.create({text:s})]}n[0]&&!c&&(i.context&&(n[0].context=o.constructString(t,i.context)+(n[0].context||"")),i.annotation&&(n[0].annotation=i.annotation)),this.addLayout(n,i,c),e.grammar&&mt.getInstance().popState(),r=r.concat(this.addPersonality_(n,i,c,t)),a&&(E.getInstance().setDynamicCstr(a),this.updateConstraint_())}return mt.getInstance().popState(),r}evaluateNodeList_(t,e,n,r,s,o){if(!e.length)return[];const i=r||"",c=o||"",a=t.contextFunctions.lookup(s),l=a?a(e,c):function(){return c},u=t.contextFunctions.lookup(n),h=u?u(e,i):function(){return[Mn.create({text:i},{translate:!0})]};let d=[];for(let t,n=0;t=e[n];n++){const r=this.evaluateTree_(t);if(r.length>0&&(r[0].context=l()+(r[0].context||""),d=d.concat(r),n<e.length-1)){const t=h();d=d.concat(t)}}return d}addLayout(t,e,n){const r=e.layout;r&&(r.match(/^begin/)?t.unshift(new Mn({text:"",layout:r})):r.match(/^end/)?t.push(new Mn({text:"",layout:r})):(t.unshift(new Mn({text:"",layout:`begin${r}`})),t.push(new Mn({text:"",layout:`end${r}`}))))}addPersonality_(t,e,r,s){const o={};let i=null;for(const t of a){const r=e[t];if(void 0===r)continue;const s=parseFloat(r),c=isNaN(s)?'"'===r.charAt(0)?r.slice(1,-1):r:s;t===n.PAUSE?i=c:o[t]=c}for(let e,n=0;e=t[n];n++)this.addRelativePersonality_(e,o),this.addExternalAttributes_(e,s);if(r&&t.length&&delete t[t.length-1].personality[n.JOIN],i&&t.length){const e=t[t.length-1];e.text||Object.keys(e.personality).length?t.push(Mn.create({text:"",personality:{pause:i}})):e.personality[n.PAUSE]=i}return t}addExternalAttributes_(t,e){if(void 0===t.attributes.id&&(t.attributes.id=e.getAttribute("id")),e.hasAttributes()){const n=e.attributes;for(let e=n.length-1;e>=0;e--){const r=n[e].name;!t.attributes[r]&&r.match(/^ext/)&&(t.attributes[r]=n[e].value)}}}addRelativePersonality_(t,e){if(!t.personality)return t.personality=e,t;const n=t.personality;for(const[t,r]of Object.entries(e))n[t]&&"number"==typeof n[t]&&"number"==typeof r?n[t]=n[t]+r:n[t]||(n[t]=r);return t}updateConstraint_(){const e=E.getInstance().dynamicCstr,n=E.getInstance().strict,r=this.trie,s={};let i=e.getValue(t.LOCALE),c=e.getValue(t.MODALITY),a=e.getValue(t.DOMAIN);r.hasSubtrie([i,c,a])||(a=o.DEFAULT_VALUES[t.DOMAIN],r.hasSubtrie([i,c,a])||(c=o.DEFAULT_VALUES[t.MODALITY],r.hasSubtrie([i,c,a])||(i=o.DEFAULT_VALUES[t.LOCALE]))),s[t.LOCALE]=[i],s[t.MODALITY]=["summary"!==c?c:o.DEFAULT_VALUES[t.MODALITY]],s[t.DOMAIN]=["speech"!==c?o.DEFAULT_VALUES[t.DOMAIN]:a];const l=e.getOrder();for(let t,r=0;t=l[r];r++)if(!s[t]){const r=e.getValue(t),i=this.makeSet_(r,e.preference),c=o.DEFAULT_VALUES[t];n||r===c||i.push(c),s[t]=i}e.updateProperties(s)}makeSet_(t,e){return e&&Object.keys(e).length?t.split(":"):[t]}lookupRule(t,e){if(!t||t.nodeType!==y.ELEMENT_NODE&&t.nodeType!==y.TEXT_NODE)return null;const n=this.lookupRules(t,e);return n.length>0?this.pickMostConstraint_(e,n):null}lookupRules(t,e){return this.trie.lookupRules(t,e.allProperties())}pickMostConstraint_(t,e){const n=E.getInstance().comparator;return e.sort((function(t,e){return n.compare(t.dynamicCstr,e.dynamicCstr)||e.precondition.priority-t.precondition.priority||e.precondition.constraints.length-t.precondition.constraints.length||e.precondition.rank-t.precondition.rank})),f.getInstance().generateOutput((()=>e.map((t=>t.name+"("+t.dynamicCstr.toString()+")"))).bind(this)),e[0]}}const Wi=new Map;E.nodeEvaluator=Xi.getInstance().evaluateNode.bind(Xi.getInstance());let Yi=["\u2806","\u2812","\u2832","\u2826","\u2834","\u2804"];const Ki={small:["default"],capital:["default"],digit:["default"]};function qi(t){const e=E.getInstance().locale;E.getInstance().locale=t,Xe(),dn({locale:t}),function(){const t=at.ALPHABETS,e=(t,e)=>{const n={};return Object.keys(t).forEach((t=>n[t]=!0)),Object.keys(e).forEach((t=>n[t]=!0)),Object.keys(n)};Ki.small=e(t.smallPrefix,t.letterTrans),Ki.capital=e(t.capPrefix,t.letterTrans),Ki.digit=e(t.digitPrefix,t.digitTrans)}();for(const t of X.values()){const e=t.unicode;if("offset"in t)Ji(e,t.font,t.offset||0);else{Qi(e,at.ALPHABETS[t.base],t.font,!!t.capital)}}E.getInstance().locale=e,Xe()}function zi(t){return function(t){return"string"==typeof t?{font:t,combiner:at.ALPHABETS.combiner}:{font:t[0],combiner:at.COMBINERS[t[1]]||st[t[1]]||at.ALPHABETS.combiner}}("normal"===t||"fullwidth"===t?"":at.MESSAGES.font[t]||at.MESSAGES.embellish[t]||"")}function Qi(t,e,n,r){const s=zi(n);for(let n,o,i=0;n=t[i],o=e[i];i++){const t=r?at.ALPHABETS.capPrefix:at.ALPHABETS.smallPrefix,e=r?Ki.capital:Ki.small;Zi(s.combiner,n,o,s.font,t,at.ALPHABETS.letterTrans,e)}}function Ji(t,e,n){const r=zi(e);for(let e,s=0;e=t[s];s++){const t=at.ALPHABETS.digitPrefix,o=s+n;Zi(r.combiner,e,o,r.font,t,at.ALPHABETS.digitTrans,Ki.digit)}}function Zi(t,e,n,r,s,o,i){for(let c,a=0;c=i[a];a++){const i=c in o?o[c]:o.default,a=c in s?s[c]:s.default;Tn(c,"default",e,t(i(n),r,a))}}var tc=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};const ec={functions:function(t){for(const n of t)dn(n)||(e=n.key,sn(n.names||[],rn.Meaning.get(e)||{type:K.FUNCTION,role:z.PREFIXFUNC}),"base"!==un?(Nn(n),An(n)):En.set(n.key,n));var e},symbols:function(t){for(const e of t){if(dn(e))continue;const t=ln.parseUnicode(e.key);"base"!==un?Sn(t,t,e.mappings):En.set(t,e)}},units:function(t){for(const e of t)dn(e)||(e.key+=":unit","base"!==un?(Nn(e),e.names&&(e.names=e.names.map((function(t){return t+":unit"}))),e.si&&Rn(e),An(e)):En.set(e.key,e))},si:t=>t.forEach(pn),messages:function(t){const e=He[t.locale];if(!e)return void console.error("Locale "+t.locale+" does not exist!");const n=t.kind.toUpperCase(),r=t.messages;if(!r)return;const s=e();for(const[t,e]of Object.entries(r))s[n][t]=e},rules:Xi.addStore,characters:t=>t.forEach(In)};let nc=!1;function rc(){return tc(this,arguments,void 0,(function*(t=E.getInstance().locale){return nc||(!function(){for(const t of X.values()){const e=t.unicode;for(const n of e)En.set(n,{key:n,category:t.category})}}(),sc(o.BASE_LOCALE),nc=!0),g.promises[o.BASE_LOCALE].then((()=>tc(this,void 0,void 0,(function*(){const e=E.getInstance().defaultLocale;return e?(sc(e),g.promises[e].then((()=>tc(this,void 0,void 0,(function*(){return sc(t),g.promises[t]}))))):(sc(t),g.promises[t])}))))}))}function sc(n=E.getInstance().locale){g.loaded[n]||(g.loaded[n]=[!1,!1],un=o.DEFAULT_VALUES[t.LOCALE],hn=o.DEFAULT_VALUES[t.MODALITY],function(t){if(E.getInstance().isIE&&E.getInstance().mode===e.HTTP)return void cc(t);!function(t){const e=function(){if(E.getInstance().customLoader)return E.getInstance().customLoader;return oc()}(),n=new Promise((n=>{e(t).then((e=>{var r;ic("string"==typeof(r=e)?JSON.parse(r):r),g.loaded[t]=[!0,!0],n(t)}),(e=>{g.loaded[t]=[!0,!1],console.error(`Unable to load locale: ${t}`),E.getInstance().locale=E.getInstance().defaultLocale,n(t)}))}));g.promises[t]=n}(t)}(n))}function oc(){switch(E.getInstance().mode){case e.ASYNC:return ac;case e.HTTP:return uc;case e.SYNC:default:return lc}}function ic(t,e){let n=!0;for(let r,s=0;r=Object.keys(t)[s];s++){const s=r.split("/");e&&e!==s[0]||(n&&"symbols"===s[1]&&"base"!==s[0]&&(qi(s[0]),n=!1),ec[s[1]](t[r]))}}function cc(t,e){let n=e||1;Ye?ic(Ye,t):n<=5&&setTimeout((()=>cc(t,n++)).bind(this),300)}function ac(t){const e=Je(t);return new Promise(((t,n)=>{d.f.fs.readFile(e,"utf8",((e,r)=>{if(e)return n(e);t(r)}))}))}function lc(t){const e=Je(t);return new Promise(((t,n)=>{let r="{}";try{r=d.f.fs.readFileSync(e,"utf8")}catch(t){return n(t)}t(r)}))}function uc(t){const e=Je(t),n=new XMLHttpRequest;return new Promise(((t,r)=>{n.onreadystatechange=function(){if(4===n.readyState){const e=n.status;0===e||e>=200&&e<400?t(n.responseText):r(e)}},n.open("GET",e,!0),n.send()}))}var hc=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};const dc=["ca","da","es"],fc=["chromevox","clearspeak","mathspeak","emacspeak","html"];function pc(t){return hc(this,void 0,void 0,(function*(){!function(t){if(t.modality&&"speech"!==t.modality||!t.modality&&"speech"!==E.getInstance().modality)return;if(!t.domain)return;if("default"===t.domain)return void(t.domain="mathspeak");const e=t.locale||E.getInstance().locale,n=t.domain;-1===dc.indexOf(e)?"en"!==e?"mathspeak"!==n&&"clearspeak"!==n&&(t.domain="mathspeak"):-1===fc.indexOf(n)&&(t.domain="mathspeak"):"mathspeak"!==n&&(t.domain="mathspeak")}(t);const e=E.getInstance(),n=n=>{void 0!==t[n]&&(e[n]=t[n])};return n("mode"),e.configurate(t),E.BINARY_FEATURES.forEach((n=>{void 0!==t[n]&&(e[n]=!!t[n])})),E.STRING_FEATURES.forEach(n),t.debug&&f.getInstance().init(),t.json&&(d.f.jsonPath=Qe(t.json)),t.xpath&&(d.f.WGXpath=t.xpath),e.setCustomLoader(t.custom),function(t){t.isIE=We(),t.isEdge="undefined"!=typeof window&&"MSGestureEvent"in window&&null===(null===(e=window.chrome)||void 0===e?void 0:e.loadTimes)&&(document.evaluate=null,Ke(!0),!0);var e}(e),Xe(),e.setDynamicCstr(),e.init?(g.promises.init=new Promise(((t,e)=>{setTimeout((()=>{t("init")}),10)})),e.init=!1,g.get()):e.delay?(e.delay=!1,g.get()):rc()}))}var mc;!function(t){t[t.ENTER=13]="ENTER",t[t.ESC=27]="ESC",t[t.SPACE=32]="SPACE",t[t.PAGE_UP=33]="PAGE_UP",t[t.PAGE_DOWN=34]="PAGE_DOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.TAB=9]="TAB",t[t.LESS=188]="LESS",t[t.GREATER=190]="GREATER",t[t.DASH=189]="DASH",t[t.ZERO=48]="ZERO",t[t.ONE=49]="ONE",t[t.TWO=50]="TWO",t[t.THREE=51]="THREE",t[t.FOUR=52]="FOUR",t[t.FIVE=53]="FIVE",t[t.SIX=54]="SIX",t[t.SEVEN=55]="SEVEN",t[t.EIGHT=56]="EIGHT",t[t.NINE=57]="NINE",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z"}(mc||(mc={}));const Ec=new Map([[13,"ENTER"],[27,"ESC"],[32,"SPACE"],[33,"PAGE_UP"],[34,"PAGE_DOWN"],[35,"END"],[36,"HOME"],[37,"LEFT"],[38,"UP"],[39,"RIGHT"],[40,"DOWN"],[9,"TAB"],[188,"LESS"],[190,"GREATER"],[189,"DASH"],[48,"ZERO"],[49,"ONE"],[50,"TWO"],[51,"THREE"],[52,"FOUR"],[53,"FIVE"],[54,"SIX"],[55,"SEVEN"],[56,"EIGHT"],[57,"NINE"],[65,"A"],[66,"B"],[67,"C"],[68,"D"],[69,"E"],[70,"F"],[71,"G"],[72,"H"],[73,"I"],[74,"J"],[75,"K"],[76,"L"],[77,"M"],[78,"N"],[79,"O"],[80,"P"],[81,"Q"],[82,"R"],[83,"S"],[84,"T"],[85,"U"],[86,"V"],[87,"W"],[88,"X"],[89,"Y"],[90,"Z"]]);var gc;!function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.MOUSEDOWN="mousedown",t.MOUSEUP="mouseup",t.MOUSEOVER="mouseover",t.MOUSEOUT="mouseout",t.MOUSEMOVE="mousemove",t.SELECTSTART="selectstart",t.KEYPRESS="keypress",t.KEYDOWN="keydown",t.KEYUP="keyup",t.TOUCHSTART="touchstart",t.TOUCHMOVE="touchmove",t.TOUCHEND="touchend",t.TOUCHCANCEL="touchcancel"}(gc||(gc={}));function Nc(t,e,n){return(n||function(n,r){return"number"==typeof n&&"number"==typeof r?n+r:"number"==typeof n?r:"number"==typeof r?n:[t,e].sort()[0]}).call(null,t,e)}function Sc(t,e){delete t.open,e.close.forEach((e=>delete t[e])),e.open.forEach((n=>t[n]=e[n]));const n=Object.keys(t);t.open=n}function Tc(t,e){if(t.length<=1)return t;const n=[];for(let r,s=0;r=e[s],t.length;s++)r.close&&r.close.length&&r.close.forEach((function(e){const r=t.indexOf(e);-1!==r&&(n.unshift(e),t.splice(r,1))}));return n}let Ic={},Ac=[];function Rc(t){Ic={},Ac=[];let e=[];const r={};for(let s,o=0;s=t[o];o++){let t=null;const o=s.descriptionSpan(),i=s.personality,c=i[n.JOIN];delete i[n.JOIN],void 0!==i[n.PAUSE]&&(t={[n.PAUSE]:i[n.PAUSE]},delete i[n.PAUSE]);Mc(e,o,_c(i,r),c,t,!0)}return e=e.concat(function(){const t=[];for(let e=Ac.length-1;e>=0;e--){const n=Ac[e];if(n.length){const e={open:[],close:[]};for(let t=0;t<n.length;t++){const r=n[t];e.close.push(r),e[r]=0}t.push(e)}}return t}()),e=function(t){const e={},n=[];for(let r,s=0;r=t[s];s++){if(!bc(r)){Oc(n,r);continue}if(!r.close||1!==r.close.length||r.open.length){Cc(r,e),n.push(r);continue}let o=t[s+1];if(!o||yc(o)){Cc(r,e),n.push(r);continue}const i=Lc(o)?o:null;i&&(o=t[s+2]),o&&bc(o)&&o.open[0]===r.close[0]&&!o.close.length&&o[o.open[0]]===e[o.open[0]]?i?(Oc(n,i),s+=2):s+=1:(Cc(r,e),n.push(r))}return n}(e),e=E.getInstance().cleanpause?function(t){for(;Lc(t[0]);)t.shift();for(;Lc(t[t.length-1]);)t.pop();return t}(e):e,e}function Oc(t,e){const n=t[t.length-1];if(n){if(yc(e)&&yc(n)){if(void 0===n.join)return void(n.span=n.span.concat(e.span));const t=n.span.pop(),r=e.span.shift();return n.span.push(t+n.join+r),n.span=n.span.concat(e.span),void(n.join=e.join)}Lc(e)&&Lc(n)?n.pause=Nc(n.pause,e.pause):t.push(e)}else t.push(e)}function Cc(t,e){t.rate&&(e.rate=t.rate),t.pitch&&(e.pitch=t.pitch),t.volume&&(e.volume=t.volume)}function bc(t){return"object"==typeof t&&t.open}function Lc(t){return"object"==typeof t&&1===Object.keys(t).length&&Object.keys(t)[0]===n.PAUSE}function yc(t){const e=Object.keys(t);return"object"==typeof t&&(1===e.length&&"span"===e[0]||2===e.length&&("span"===e[0]&&"join"===e[1]||"span"===e[1]&&"join"===e[0]))}function Mc(t,e,r,s,o,i=!1){if(i){const i=t[t.length-1];let c;if(i&&(c=i[n.JOIN]),i&&!e.speech&&o&&Lc(i)){const t=n.PAUSE;i[t]=Nc(i[t],o[t]),o=null}if(i&&e.speech&&0===Object.keys(r).length&&yc(i)){if(void 0!==c){const t=i.span.pop();e=bn.stringAttr(t.speech+c+e.speech,t.attributes)}i.span.push(e),e=bn.empty(),i[n.JOIN]=s}}0!==Object.keys(r).length&&t.push(r),e.speech&&t.push({span:[e],join:s}),o&&t.push(o)}function _c(t,e){if(!e)return t;const n={};for(const r of a){const s=t[r],o=e[r];if(!s&&!o||s&&o&&s===o)continue;const i=s||0;bc(n)||(n.open=[],n.close=[]),s||n.close.push(r),o||n.open.push(r),o&&s&&(n.close.push(r),n.open.push(r)),e[r]=i,n[r]=i,Ic[r]?Ic[r].push(i):Ic[r]=[i]}if(bc(n)){let t=n.close.slice();for(;t.length>0;){let r=Ac.pop();const s=lr(r,t);if(t=lr(t,r),r=s,0!==t.length){if(0!==r.length){n.close=n.close.concat(r),n.open=n.open.concat(r);for(let t,s=0;t=r[s];s++)n[t]=e[t]}}else 0!==r.length&&Ac.push(r)}Ac.push(n.open)}return n}class Pc{constructor(){this.separator_=" "}set separator(t){this.separator_=t}get separator(){return"braille"===E.getInstance().modality?"":this.separator_}error(t){return null}merge(t){let e="";const n=t.length-1;for(let r,s=0;r=t[s];s++)if(e+=r.speech,s<n){const t=r.attributes.separator;e+=void 0!==t?t:this.separator}return e}finalize(t){return t}pauseValue(t){let e;switch(t){case"long":e=750;break;case"medium":e=500;break;case"short":e=250;break;default:e=parseInt(t,10)}return Math.floor(e*E.getInstance().getRate()/100)}}class Fc extends Pc{constructor(){super(...arguments),this.ignoreElements=[n.LAYOUT],this.scaleFunction=null}setScaleFunction(t,e,n,r,s=0){this.scaleFunction=o=>{const i=(o-t)/(e-t),c=n*(1-i)+r*i;return+(Math.round(c+"e+"+s)+"e-"+s)}}applyScaleFunction(t){return this.scaleFunction?this.scaleFunction(t):t}ignoreElement(t){return-1!==this.ignoreElements.indexOf(t)}}class Uc extends Fc{markup(t){this.setScaleFunction(-2,2,-100,100,2);const e=Rc(t),n=[],r=[];for(let t,s=0;t=e[s];s++)if(t.span)n.push(this.merge(t.span));else if(Lc(t))n.push(this.pause(t));else{if(t.close.length)for(let e=0;e<t.close.length;e++){const e=r.pop();if(-1===t.close.indexOf(e))throw new m("Unknown closing markup element: "+e);n.push(this.closeTag(e))}if(t.open.length){Tc(t.open.slice(),e.slice(s+1)).forEach((e=>{n.push(this.prosodyElement(e,t[e])),r.push(e)}))}}return n.join(" ")}}class xc extends Uc{constructor(){super(...arguments),this.values=new Map}finalize(t){return function(t){if(Bc.clear(),!t)return;const e=Object.keys(t).map((t=>parseInt(t))).sort();for(let t,n=0;t=e[n];n++)Bc.set(t,n+1)}(this.values.get("rel")),function(t){Dc="";const e=L(`<all>${t}</all>`);return f.getInstance().output(D(e.toString())),Dc=Gc(e),Dc}(t)}pause(t){return""}prosodyElement(t,e){return t===n.LAYOUT?`<${e}>`:""}closeTag(t){return`</${t}>`}markup(t){this.values.clear();const e=[];let n=[];for(const r of t){if(!r.layout){n.push(r);continue}e.push(this.processContent(n)),n=[];const[t,s,o]=this.layoutValue(r.layout);"begin"!==t?"end"!==t?console.warn("Something went wrong with layout markup: "+s):e.push("</"+s+">"):e.push("<"+s+(o?` value="${o}"`:"")+">")}return e.push(this.processContent(n)),e.join("")}processContent(t){const e=[],n=Rc(t);for(let t,r=0;t=n[r];r++)t.span?e.push(this.merge(t.span)):Lc(t);return e.join("")}layoutValue(t){const e=t.match(/^(begin|end|)(.*\D)(\d*)$/),n=e[3];return n?(t=e[2],this.values.has(t)||this.values.set(t,{}),this.values.get(t)[n]=!0,[e[1],t,n]):[e[1],e[2],""]}}xc.options={cayleyshort:E.getInstance().cayleyshort,linebreaks:E.getInstance().linebreaks};let Dc="";const vc={TABLE:function(t){let e=Hc(t);e.forEach((t=>{t.cells=t.cells.slice(1).slice(0,-1),t.width=t.width.slice(1).slice(0,-1)}));const[n,r]=Xc(e);return e=Wc(e,r),Yc(e,n)},CASES:function(t){let e=Hc(t);e.forEach((t=>{t.cells=t.cells.slice(0,-1),t.width=t.width.slice(0,-1)}));const[n,r]=Xc(e);return e=Wc(e,r),Yc(e,n)},CAYLEY:function(t){let e=Hc(t);e.forEach((t=>{t.cells=t.cells.slice(1).slice(0,-1),t.width=t.width.slice(1).slice(0,-1),t.sep=t.sep+t.sep}));const[n,r]=Xc(e),s={lfence:"",rfence:"",cells:r.map((t=>"\u2810"+new Array(t).join("\u2812"))),width:r,height:1,sep:e[0].sep};E.getInstance().cayleyshort&&"\u2800"===e[0].cells[0]&&(s.cells[0]="\u2800");return e.splice(1,0,s),e=Wc(e,r),Yc(e,n)},MATRIX:function(t){let e=Hc(t);const[n,r]=Xc(e);return e=Wc(e,r),Yc(e,n)},CELL:Gc,FENCE:Gc,ROW:Gc,FRACTION:function(t){const[e,n,,r,s]=Array.from(t.childNodes),o=wc(n),i=wc(r),c=jc(o),a=jc(i);let l=Math.max(c,a);const u=e+new Array(l+1).join("\u2812")+s;return l=u.length,`${Qc(o,l)}\n${u}\n${Qc(i,l)}`},NUMERATOR:Jc,DENOMINATOR:Jc,REL:Zc,OP:Zc};function wc(t){const e=B(t),n=vc[e];return n?n(t):t.textContent}const Bc=new Map;function kc(t,e){if(!t||!e)return t+e;const n=Vc(t),r=Vc(e),s=n-r;t=s<0?$c(t,r,jc(t)):t,e=s>0?$c(e,n,jc(e)):e;const o=t.split(/\r\n|\r|\n/),i=e.split(/\r\n|\r|\n/),c=[];for(let t=0;t<o.length;t++)c.push(o[t]+i[t]);return c.join("\n")}function Gc(t){let e="";for(const n of Array.from(t.childNodes))e=n.nodeType!==y.TEXT_NODE?kc(e,wc(n)):kc(e,n.textContent);return e}function Vc(t){return t.split(/\r\n|\r|\n/).length}function jc(t){return t.split(/\r\n|\r|\n/).reduce(((t,e)=>Math.max(e.length,t)),0)}function $c(t,e,n){return t=function(t,e){const n=e-Vc(t);return t+(n>0?new Array(n+1).join("\n"):"")}(t,e),function(t,e){const n=t.split(/\r\n|\r|\n/),r=[];for(const t of n){const n=e-t.length;r.push(t+(n>0?new Array(n+1).join("\u2800"):""))}return r.join("\n")}(t,n)}function Hc(t){const e=Array.from(t.childNodes),n=[];for(const t of e)t.nodeType===y.ELEMENT_NODE&&n.push(zc(t));return n}function Xc(t){const e=t.reduce(((t,e)=>Math.max(e.height,t)),0),n=[];for(let e=0;e<t[0].width.length;e++)n.push(t.map((t=>t.width[e])).reduce(((t,e)=>Math.max(t,e)),0));return[e,n]}function Wc(t,e){const n=[];for(const r of t){if(0===r.height)continue;const t=[];for(let n=0;n<r.cells.length;n++)t.push($c(r.cells[n],r.height,e[n]));r.cells=t,n.push(r)}return n}function Yc(t,e){if(1===e)return t.map((t=>t.lfence+t.cells.join(t.sep)+t.rfence)).join("\n");const n=[];for(const e of t){const t=Kc(e.sep,e.height);let r=e.cells.shift();for(;e.cells.length;)r=kc(r,t),r=kc(r,e.cells.shift());r=kc(Kc(e.lfence,e.height),r),r=kc(r,Kc(e.rfence,e.height)),n.push(r),n.push(e.lfence+new Array(jc(r)-3).join(e.sep)+e.rfence)}return n.slice(0,-1).join("\n")}function Kc(t,e){let n="";for(;e;)n+=t+"\n",e--;return n.slice(0,-1)}function qc(t){return t.nodeType===y.ELEMENT_NODE&&"FENCE"===B(t)?wc(t):""}function zc(t){const e=Array.from(t.childNodes),n=qc(e[0]),r=qc(e[e.length-1]);n&&e.shift(),r&&e.pop();let s="";const o=[];for(const t of e){if(t.nodeType===y.TEXT_NODE){s=t.textContent;continue}const e=wc(t);o.push(e)}return{lfence:n,rfence:r,sep:s,cells:o,height:o.reduce(((t,e)=>Math.max(Vc(e),t)),0),width:o.map(jc)}}function Qc(t,e){const n=(e-jc(t))/2,[r,s]=Math.floor(n)===n?[n,n]:[Math.floor(n),Math.ceil(n)],o=t.split(/\r\n|\r|\n/),i=[],[c,a]=[new Array(r+1).join("\u2800"),new Array(s+1).join("\u2800")];for(const t of o)i.push(c+t+a);return i.join("\n")}function Jc(t){const e=t.firstChild,n=Gc(t);if(e&&e.nodeType===y.ELEMENT_NODE){if("ENGLISH"===B(e))return"\u2830"+n;if("NUMBER"===B(e))return"\u283c"+n}return n}function Zc(t){if(!E.getInstance().linebreaks)return Gc(t);let e=Bc.get(parseInt(t.getAttribute("value")));return(e?`<br value="${e}"/>`:"")+Gc(t)}class ta extends Pc{markup(t){const e=Rc(t);let r="",s=null,o=!1;for(let t,i=0;t=e[i];i++)bc(t)||(Lc(t)?s=t:(s&&(r+=this.pause(s[n.PAUSE]),s=null),r+=(o?this.separator:"")+this.merge(t.span),o=!0));return r}pause(t){let e;return e="number"==typeof t?t<=250?"short":t<=500?"medium":"long":t,ta.PAUSE_PUNCTUATION.get(e)||""}}ta.PAUSE_PUNCTUATION=new Map([["short",","],["medium",";"],["long","."]]);class ea extends Uc{finalize(t){return`<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="${E.getInstance().locale}"><prosody rate="`+E.getInstance().getRate()+'%">'+this.separator+t+this.separator+"</prosody></speak>"}pause(t){return'<break time="'+this.pauseValue(t[n.PAUSE])+'ms"/>'}prosodyElement(t,e){const r=(e=Math.floor(this.applyScaleFunction(e)))<0?e.toString():"+"+e.toString();return"<prosody "+t.toLowerCase()+'="'+r+(t===n.VOLUME?">":'%">')}closeTag(t){return"</prosody>"}markup(t){return ea.MARKS={},super.markup(t)}merge(t){const e=[];let n="";for(let r=0;r<t.length;r++){const s=t[r];if(this.isEmptySpan(s))continue;const o=ea.MARK_KIND?s.attributes.kind:"",i=E.getInstance().automark?s.attributes.id:E.getInstance().mark?s.attributes.extid:"";!i||i===n||ea.MARK_ONCE&&ea.MARKS[i]||(e.push(o?`<mark name="${i}" kind="${o}"/>`:`<mark name="${i}"/>`),n=i,ea.MARKS[i]=!0),E.getInstance().character&&1===s.speech.length&&s.speech.match(/[a-zA-Z]/)?e.push('<say-as interpret-as="'+ea.CHARACTER_ATTR+'">'+s.speech+"</say-as>"):e.push(s.speech)}return e.join(this.separator)}isEmptySpan(t){const e=t.attributes.separator;return t.speech.match(/^\s*$/)&&(!e||e.match(/^\s*$/))}}ea.MARK_ONCE=!1,ea.MARK_KIND=!0,ea.CHARACTER_ATTR="character",ea.MARKS={};class na extends Pc{markup(t){let e="";const n=Rc(t).filter((t=>t.span));if(!n.length)return e;const r=n.length-1;for(let t,s=0;t=n[s];s++){if(t.span&&(e+=this.merge(t.span)),s>=r)continue;const n=t.join;e+=void 0===n?this.separator:n}return e}}const ra=new ea,sa=new Map([[u.NONE,new na],[u.COUNTING,new class extends na{finalize(t){const e=super.finalize(t),n="braille"===E.getInstance().modality?"\u28ff\u2800\u28ff\u2800\u28ff\u2800\u28ff\u2800\u28ff\u2800":"0123456789";let r=new Array(Math.trunc(e.length/10)+1).join(n);return r+=n.slice(0,e.length%10),e+"\n"+r}}],[u.PUNCTUATION,new ta],[u.LAYOUT,new xc],[u.ACSS,new class extends Fc{markup(t){this.setScaleFunction(-2,2,0,10,0);const e=Rc(t),n=[],r={open:[]};let s=null,o=!1;for(let t,l=0;t=e[l];l++){if(bc(t)){Sc(r,t);continue}if(Lc(t)){o&&(i=s,c=t,a=Math.max,s=i?{pause:Nc(i.pause,c.pause,a)}:c);continue}const e='"'+this.merge(t.span)+'"';o=!0,s&&(n.push(this.pause(s)),s=null);const l=this.prosody_(r);n.push(l?"(text ("+l+") "+e+")":e)}var i,c,a;return"(exp "+n.join(" ")+")"}error(t){return'(error "'+Ec.get(t)+'")'}prosodyElement(t,e){switch(e=this.applyScaleFunction(e),t){case n.RATE:return"(richness . "+e+")";case n.PITCH:return"(average-pitch . "+e+")";case n.VOLUME:return"(stress . "+e+")"}return"(value . "+e+")"}pause(t){return"(pause . "+this.pauseValue(t[n.PAUSE])+")"}prosody_(t){const e=t.open,n=[];for(let r,s=0;r=e[s];s++)n.push(this.prosodyElement(r,t[r]));return n.join(" ")}}],[u.SABLE,new class extends Uc{finalize(t){return'<?xml version="1.0"?><!DOCTYPE SABLE PUBLIC "-//SABLE//DTD SABLE speech mark up//EN" "Sable.v0_2.dtd" []><SABLE>'+this.separator+t+this.separator+"</SABLE>"}pause(t){return'<BREAK MSEC="'+this.pauseValue(t[n.PAUSE])+'"/>'}prosodyElement(t,e){switch(e=this.applyScaleFunction(e),t){case n.PITCH:return'<PITCH RANGE="'+e+'%">';case n.RATE:return'<RATE SPEED="'+e+'%">';case n.VOLUME:return'<VOLUME LEVEL="'+e+'%">';default:return"<"+t.toUpperCase()+' VALUE="'+e+'">'}}closeTag(t){return"</"+t.toUpperCase()+">"}}],[u.VOICEXML,ra],[u.SSML,ra]]);function oa(t){const e=sa.get(E.getInstance().markup);return e?e.markup(t):""}function ia(t){const e=sa.get(E.getInstance().markup);return e?e.finalize(t):t}class ca{constructor(t){this.type=t,this.factory_=new Dr}getFactory(){return this.factory_}setFactory(t){this.factory_=t}getType(){return this.type}parseList(t){const e=[];for(let n,r=0;n=t[r];r++)e.push(this.parse(n));return e}}class aa extends ca{static getAttribute_(t,e,n){if(!t.hasAttribute(e))return n;const r=t.getAttribute(e);return r.match(/^\s*$/)?null:r}constructor(){super("MathML"),this.parseMap_=new Map([[Sr.SEMANTICS,this.semantics_.bind(this)],[Sr.MATH,this.rows_.bind(this)],[Sr.MROW,this.rows_.bind(this)],[Sr.MPADDED,this.rows_.bind(this)],[Sr.MSTYLE,this.rows_.bind(this)],[Sr.MFRAC,this.fraction_.bind(this)],[Sr.MSUB,this.limits_.bind(this)],[Sr.MSUP,this.limits_.bind(this)],[Sr.MSUBSUP,this.limits_.bind(this)],[Sr.MOVER,this.limits_.bind(this)],[Sr.MUNDER,this.limits_.bind(this)],[Sr.MUNDEROVER,this.limits_.bind(this)],[Sr.MROOT,this.root_.bind(this)],[Sr.MSQRT,this.sqrt_.bind(this)],[Sr.MTABLE,this.table_.bind(this)],[Sr.MLABELEDTR,this.tableLabeledRow_.bind(this)],[Sr.MTR,this.tableRow_.bind(this)],[Sr.MTD,this.tableCell_.bind(this)],[Sr.MS,this.text_.bind(this)],[Sr.MTEXT,this.text_.bind(this)],[Sr.MSPACE,this.space_.bind(this)],[Sr.ANNOTATIONXML,this.text_.bind(this)],[Sr.MI,this.identifier_.bind(this)],[Sr.MN,this.number_.bind(this)],[Sr.MO,this.operator_.bind(this)],[Sr.MFENCED,this.fenced_.bind(this)],[Sr.MENCLOSE,this.enclosed_.bind(this)],[Sr.MMULTISCRIPTS,this.multiscripts_.bind(this)],[Sr.ANNOTATION,this.empty_.bind(this)],[Sr.NONE,this.empty_.bind(this)],[Sr.MACTION,this.action_.bind(this)]]);const t={type:K.IDENTIFIER,role:z.NUMBERSET,font:J.DOUBLESTRUCK};["C","H","N","P","Q","R","Z","\u2102","\u210d","\u2115","\u2119","\u211a","\u211d","\u2124"].forEach((e=>this.getFactory().defaultMap.set(e,t)).bind(this))}parse(t){Ns.getInstance().setNodeFactory(this.getFactory());const e=b(t.childNodes),n=B(t),r=this.parseMap_.get(n),s=(r||this.dummy_.bind(this))(t,e);return _r(s,t),-1!==[Sr.MATH,Sr.MROW,Sr.MPADDED,Sr.MSTYLE,Sr.SEMANTICS,Sr.MACTION].indexOf(n)||(s.mathml.unshift(t),s.mathmlTree=t),s}semantics_(t,e){return e.length?this.parse(e[0]):this.getFactory().makeEmptyNode()}rows_(t,e){const n=t.getAttribute("semantics");if(n&&n.match("bspr_"))return Ns.proof(t,n,this.parseList.bind(this));let r;return 1===(e=Mr(e)).length?(r=this.parse(e[0]),r.type!==K.EMPTY||r.mathmlTree||(r.mathmlTree=t)):r=Ns.getInstance().row(this.parseList(e)),r.mathml.unshift(t),r}fraction_(t,e){if(!e.length)return this.getFactory().makeEmptyNode();const n=this.parse(e[0]),r=e[1]?this.parse(e[1]):this.getFactory().makeEmptyNode();return Ns.getInstance().fractionLikeNode(n,r,t.getAttribute("linethickness"),"true"===t.getAttribute("bevelled"))}limits_(t,e){return Ns.getInstance().limitNode(B(t),this.parseList(e))}root_(t,e){return e[1]?this.getFactory().makeBranchNode(K.ROOT,[this.parse(e[1]),this.parse(e[0])],[]):this.sqrt_(t,e)}sqrt_(t,e){const n=this.parseList(Mr(e));return this.getFactory().makeBranchNode(K.SQRT,[Ns.getInstance().row(n)],[])}table_(t,e){const n=t.getAttribute("semantics");if(n&&n.match("bspr_"))return Ns.proof(t,n,this.parseList.bind(this));const r=this.getFactory().makeBranchNode(K.TABLE,this.parseList(e),[]);return r.mathmlTree=t,Ns.tableToMultiline(r)}tableRow_(t,e){const n=this.getFactory().makeBranchNode(K.ROW,this.parseList(e),[]);return n.role=z.TABLE,n}tableLabeledRow_(t,e){var n;if(!e.length)return this.tableRow_(t,e);const r=this.parse(e[0]);r.role=z.LABEL,(null===(n=r.childNodes[0])||void 0===n?void 0:n.type)===K.TEXT&&(r.childNodes[0].role=z.LABEL);const s=this.getFactory().makeBranchNode(K.ROW,this.parseList(e.slice(1)),[r]);return s.role=z.TABLE,s}tableCell_(t,e){const n=this.parseList(Mr(e));let r;r=n.length?1===n.length&&vr(n[0],K.EMPTY)?n:[Ns.getInstance().row(n)]:[];const s=this.getFactory().makeBranchNode(K.CELL,r,[]);return s.role=z.TABLE,s}space_(t,e){const n=t.getAttribute("width"),r=n&&n.match(/[a-z]*$/);if(!r)return this.empty_(t,e);const s=r[0],o=parseFloat(n.slice(0,r.index)),i={cm:.4,pc:.5,em:.5,ex:1,in:.15,pt:5,mm:5}[s];if(!i||isNaN(o)||o<i)return this.empty_(t,e);const c=this.getFactory().makeUnprocessed(t);return Ns.getInstance().text(c,B(t))}text_(t,e){const n=this.leaf_(t,e);return t.textContent?(n.updateContent(t.textContent,!0),Ns.getInstance().text(n,B(t))):n}identifier_(t,e){const n=this.leaf_(t,e);return Ns.getInstance().identifierNode(n,Ns.getInstance().font(t.getAttribute("mathvariant")),t.getAttribute("class"))}number_(t,e){const n=this.leaf_(t,e);return Ns.number(n),n}operator_(t,e){const n=this.leaf_(t,e);return Ns.getInstance().operatorNode(n),n}fenced_(t,e){const n=this.parseList(Mr(e)),r=aa.getAttribute_(t,"separators",","),s=aa.getAttribute_(t,"open","("),o=aa.getAttribute_(t,"close",")"),i=Ns.getInstance().mfenced(s,o,r,n);return Ns.getInstance().tablesInRow([i])[0]}enclosed_(t,e){const n=this.parseList(Mr(e)),r=this.getFactory().makeBranchNode(K.ENCLOSE,[Ns.getInstance().row(n)],[]);return r.role=t.getAttribute("notation")||z.UNKNOWN,r}multiscripts_(t,e){if(!e.length)return this.getFactory().makeEmptyNode();const n=this.parse(e.shift());if(!e.length)return n;const r=[],s=[],o=[],i=[];let c=!1,a=0;for(let t,n=0;t=e[n];n++)B(t)!==Sr.MPRESCRIPTS?(c?1&a?r.push(t):s.push(t):1&a?o.push(t):i.push(t),a++):(c=!0,a=0);return Mr(r).length||Mr(s).length?Ns.getInstance().tensor(n,this.parseList(s),this.parseList(r),this.parseList(i),this.parseList(o)):Ns.getInstance().pseudoTensor(n,this.parseList(i),this.parseList(o))}empty_(t,e){return this.getFactory().makeEmptyNode()}action_(t,e){const n=e[t.hasAttribute("selection")?parseInt(t.getAttribute("selection"),10)-1:0],r=this.parse(n);return r.mathmlTree=n,r}dummy_(t,e){const n=this.getFactory().makeUnprocessed(t);return n.role=t.tagName,n.textContent=t.textContent,n}leaf_(t,e){if(1===e.length&&e[0].nodeType!==y.TEXT_NODE){const n=this.getFactory().makeUnprocessed(t);return n.role=e[0].tagName,_r(n,e[0]),n}const n=this.getFactory().makeLeafNode(t.textContent,Ns.getInstance().font(t.getAttribute("mathvariant")));return t.hasAttribute("data-latex")&&rn.LatexCommands.set(t.getAttribute("data-latex"),t.textContent),n}}class la{constructor(t,e,n=t=>!1){this.name=t,this.apply=e,this.applicable=n}}class ua extends la{}class ha extends la{}const da="data-semantic-";var fa;!function(t){t.ADDED="data-semantic-added",t.ALTERNATIVE="data-semantic-alternative",t.CHILDREN="data-semantic-children",t.COLLAPSED="data-semantic-collapsed",t.CONTENT="data-semantic-content",t.EMBELLISHED="data-semantic-embellished",t.FENCEPOINTER="data-semantic-fencepointer",t.FONT="data-semantic-font",t.ID="data-semantic-id",t.ANNOTATION="data-semantic-annotation",t.ATTRIBUTES="data-semantic-attributes",t.OPERATOR="data-semantic-operator",t.OWNS="data-semantic-owns",t.PARENT="data-semantic-parent",t.POSTFIX="data-semantic-postfix",t.PREFIX="data-semantic-prefix",t.ROLE="data-semantic-role",t.SPEECH="data-semantic-speech",t.STRUCTURE="data-semantic-structure",t.SUMMARY="data-semantic-summary",t.TYPE="data-semantic-type"}(fa||(fa={}));const pa=[fa.ADDED,fa.ALTERNATIVE,fa.CHILDREN,fa.COLLAPSED,fa.CONTENT,fa.EMBELLISHED,fa.FENCEPOINTER,fa.FONT,fa.ID,fa.ANNOTATION,fa.ATTRIBUTES,fa.OPERATOR,fa.OWNS,fa.PARENT,fa.POSTFIX,fa.PREFIX,fa.ROLE,fa.SPEECH,fa.STRUCTURE,fa.SUMMARY,fa.TYPE];function ma(t){return t.map((function(t){return t.id})).join(",")}function Ea(t,e){t.setAttribute(fa.TYPE,e.type);const n=e.allAttributes();for(let e,r=0;e=n[r];r++)t.setAttribute(da+e[0].toLowerCase(),e[1]);e.childNodes.length&&t.setAttribute(fa.CHILDREN,ma(e.childNodes)),e.contentNodes.length&&t.setAttribute(fa.CONTENT,ma(e.contentNodes)),e.parent&&t.setAttribute(fa.PARENT,e.parent.id.toString());const r=e.attributesXml();r&&t.setAttribute(fa.ATTRIBUTES,r),function(t,e){const n=[];e.role===z.MGLYPH&&n.push("image");e.attributes.href&&n.push("link");n.length&&t.setAttribute(fa.POSTFIX,n.join(" "))}(t,e)}function ga(t){return da+t}function Na(){const t=U("mrow");return t.setAttribute(fa.ADDED,"true"),t}const Sa=!1;class Ta{static fromTree(t){return Ta.fromNode(t.root)}static fromNode(t){return new Ta(Ta.fromNode_(t))}static fromString(t){return new Ta(Ta.fromString_(t))}static simpleCollapseStructure(t){return"number"==typeof t}static contentCollapseStructure(t){return!!t&&!Ta.simpleCollapseStructure(t)&&"c"===t[0]}static interleaveIds(t,e){return ar(Ta.collapsedLeafs(t),Ta.collapsedLeafs(e))}static collapsedLeafs(...t){return t.reduce(((t,e)=>{return t.concat((n=e,Ta.simpleCollapseStructure(n)?[n]:Ta.contentCollapseStructure(n[1])?n.slice(2):n.slice(1)));var n}),[])}static fromStructure(t,e){return new Ta(Ta.tree_(t,e.root))}static combineContentChildren(t,e,n,r){switch(t){case K.RELSEQ:case K.INFIXOP:case K.MULTIREL:return ar(r,n);case K.PREFIXOP:return n.concat(r);case K.POSTFIXOP:return r.concat(n);case K.MATRIX:case K.VECTOR:case K.FENCED:return r.unshift(n[0]),r.push(n[1]),r;case K.CASES:return r.unshift(n[0]),r;case K.APPL:return[r[0],n[0],r[1]];case K.ROOT:return[r[0],r[1]];case K.ROW:case K.LINE:return n.length&&r.unshift(n[0]),r;default:return r}}static makeSexp_(t){return Ta.simpleCollapseStructure(t)?t.toString():Ta.contentCollapseStructure(t)?"(c "+t.slice(1).map(Ta.makeSexp_).join(" ")+")":"("+t.map(Ta.makeSexp_).join(" ")+")"}static fromString_(t){let e=t.replace(/\(/g,"[");return e=e.replace(/\)/g,"]"),e=e.replace(/ /g,","),e=e.replace(/c/g,'"c"'),JSON.parse(e)}static fromNode_(t){if(!t)return[];const e=t.contentNodes;let n;e.length&&(n=e.map(Ta.fromNode_),n.unshift("c"));const r=t.childNodes;if(!r.length)return e.length?[t.id,n]:t.id;const s=r.map(Ta.fromNode_);return e.length&&s.unshift(n),s.unshift(t.id),s}static tree_(t,e,n=0,r=1,s=1){if(!e)return[];const o=e.id,i=[o];C(t);const c=O(`.//self::*[@${fa.ID}=${o}]`,t)[0];if(!e.childNodes.length)return Ta.addAria(c,n,r,s),e.id;const a=Ta.combineContentChildren(e.type,e.role,e.contentNodes.map((function(t){return t})),e.childNodes.map((function(t){return t})));c&&Ta.addOwns_(c,a);for(let e,r=0,s=a.length;e=a[r];r++)i.push(Ta.tree_(t,e,n+1,r+1,s));return Ta.addAria(c,n,r,s,Sa?n?"group":"tree":"treeitem"),i}static addAria(t,e,n,r,s=(Sa?e?"treeitem":"tree":"treeitem")){E.getInstance().aria&&t&&(t.setAttribute("aria-level",e.toString()),t.setAttribute("aria-posinset",n.toString()),t.setAttribute("aria-setsize",r.toString()),t.setAttribute("role",s),t.hasAttribute(fa.OWNS)&&t.setAttribute("aria-owns",t.getAttribute(fa.OWNS)))}static addOwns_(t,e){const n=t.getAttribute(fa.COLLAPSED),r=n?Ta.realLeafs_(Ta.fromString(n).array):e.map((t=>t.id));t.setAttribute(fa.OWNS,r.join(" "))}static realLeafs_(t){if(Ta.simpleCollapseStructure(t))return[t];if(Ta.contentCollapseStructure(t))return[];let e=[];for(let n=1;n<t.length;n++)e=e.concat(Ta.realLeafs_(t[n]));return e}constructor(t){this.parents=null,this.levelsMap=null,t=0===t?t:t||[],this.array=t}populate(){this.parents&&this.levelsMap||(this.parents={},this.levelsMap={},this.populate_(this.array,this.array,[]))}toString(){return Ta.makeSexp_(this.array)}populate_(t,e,n){if(Ta.simpleCollapseStructure(t))return this.levelsMap[t]=e,void(this.parents[t]=t===n[0]?n.slice(1):n);const r=Ta.contentCollapseStructure(t)?t.slice(1):t,s=[r[0]].concat(n);for(let e=0,n=r.length;e<n;e++){const n=r[e];this.populate_(n,t,s)}}isRoot(t){return t===this.levelsMap[t][0]}directChildren(t){if(!this.isRoot(t))return[];return this.levelsMap[t].slice(1).map((t=>Ta.simpleCollapseStructure(t)?t:Ta.contentCollapseStructure(t)?t[1]:t[0]))}subtreeNodes(t){if(!this.isRoot(t))return[];const e=(t,n)=>{Ta.simpleCollapseStructure(t)?n.push(t):(Ta.contentCollapseStructure(t)&&(t=t.slice(1)),t.forEach((t=>e(t,n))))},n=this.levelsMap[t],r=[];return e(n.slice(1),r),r}}function Ia(t,e,n){let r=null;if(!t.length)return r;const s=n[n.length-1],o=s&&s.length,i=e&&e.length,c=Ns.getInstance();if(o&&i){if(e[0].type===K.INFIXOP&&e[0].role===z.IMPLICIT)return r=t.pop(),s.push(c.postfixNode_(s.pop(),t)),r;r=t.shift();const n=c.prefixNode_(e.shift(),t);return e.unshift(n),r}return o?(s.push(c.postfixNode_(s.pop(),t)),r):(i&&e.unshift(c.prefixNode_(e.shift(),t)),r)}function Aa(t,e,n){if(!e.length)return t;const r=t.pop(),s=e.shift(),o=n.shift();if(s.type===K.INFIXOP&&(s.role===z.IMPLICIT||s.role===z.UNIT)){f.getInstance().output("Juxta Heuristic Case 2");const i=(r?[r,s]:[s]).concat(o);return Aa(t.concat(i),e,n)}if(!r)return f.getInstance().output("Juxta Heuristic Case 3"),Aa([s].concat(o),e,n);const i=o.shift();if(!i){f.getInstance().output("Juxta Heuristic Case 9");const o=ur.factory.makeBranchNode(K.INFIXOP,[r,e.shift()],[s],s.textContent);return o.role=z.IMPLICIT,ur.run("combine_juxtaposition",o),e.unshift(o),Aa(t,e,n)}if(Wr(r)||Wr(i))return f.getInstance().output("Juxta Heuristic Case 4"),Aa(t.concat([r,s,i]).concat(o),e,n);let c=null;return fs(r)&&fs(i)?(f.getInstance().output("Juxta Heuristic Case 5"),r.contentNodes.push(s),r.contentNodes=r.contentNodes.concat(i.contentNodes),r.childNodes.push(i),r.childNodes=r.childNodes.concat(i.childNodes),i.childNodes.forEach((t=>t.parent=r)),s.parent=r,r.addMathmlNodes(s.mathml),r.addMathmlNodes(i.mathml),c=r):fs(r)?(f.getInstance().output("Juxta Heuristic Case 6"),r.contentNodes.push(s),r.childNodes.push(i),i.parent=r,s.parent=r,r.addMathmlNodes(s.mathml),r.addMathmlNodes(i.mathml),c=r):fs(i)?(f.getInstance().output("Juxta Heuristic Case 7"),i.contentNodes.unshift(s),i.childNodes.unshift(r),r.parent=i,s.parent=i,i.addMathmlNodes(s.mathml),i.addMathmlNodes(r.mathml),c=i):(f.getInstance().output("Juxta Heuristic Case 8"),c=ur.factory.makeBranchNode(K.INFIXOP,[r,i],[s],s.textContent),c.role=z.IMPLICIT),t.push(c),Aa(t.concat(o),e,n)}function Ra(t){return t.childNodes[0]&&t.childNodes[0].childNodes[0]&&B(t.childNodes[0])===Sr.MPADDED&&B(t.childNodes[0].childNodes[0])===Sr.MPADDED&&B(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1])===Sr.MPHANTOM}ur.add(new ua("combine_juxtaposition",(function(t){for(let e,n=t.childNodes.length-1;e=t.childNodes[n];n--)fs(e)&&!e.nobreaking&&(t.childNodes.splice(n,1,...e.childNodes),t.contentNodes.splice(n,0,...e.contentNodes),e.childNodes.concat(e.contentNodes).forEach((function(e){e.parent=t})),t.addMathmlNodes(e.mathml));return t}))),ur.add(new ua("propagateSimpleFunction",(t=>(t.type!==K.INFIXOP&&t.type!==K.FRACTION||!t.childNodes.every(os)||(t.role=z.COMPFUNC),t)),(t=>"clearspeak"===E.getInstance().domain))),ur.add(new ua("simpleNamedFunction",(t=>(t.role!==z.UNIT&&-1!==["f","g","h","F","G","H"].indexOf(t.textContent)&&(t.role=z.SIMPLEFUNC),t)),(t=>"clearspeak"===E.getInstance().domain))),ur.add(new ua("propagateComposedFunction",(t=>(t.type===K.FENCED&&t.childNodes[0].role===z.COMPFUNC&&(t.role=z.COMPFUNC),t)),(t=>"clearspeak"===E.getInstance().domain))),ur.add(new ua("multioperator",(t=>{t.role!==z.UNKNOWN||t.textContent.length<=1||(Ns.compSemantics(t,"role",z),Ns.compSemantics(t,"type",K))}))),ur.add(new ha("convert_juxtaposition",(t=>{let e=Ur(t,(function(t){return t.textContent===tn.invisibleTimes&&t.type===K.OPERATOR}));e=e.rel.length?function(t){const e=[],n=[];let r=t.comp.shift(),s=null,o=[];for(;t.comp.length;)if(o=[],r.length)s&&e.push(s),n.push(r),s=t.rel.shift(),r=t.comp.shift();else{for(s&&o.push(s);!r.length&&t.comp.length;)r=t.comp.shift(),o.push(t.rel.shift());s=Ia(o,r,n)}o.length||r.length?(e.push(s),n.push(r)):(o.push(s),Ia(o,r,n));return{rel:e,comp:n}}(e):e,t=e.comp[0];for(let n,r,s=1;n=e.comp[s],r=e.rel[s-1];s++)t.push(r),t=t.concat(n);return e=Ur(t,(function(t){return t.textContent===tn.invisibleTimes&&(t.type===K.OPERATOR||t.type===K.INFIXOP)})),e.rel.length?Aa(e.comp.shift(),e.rel,e.comp):t}))),ur.add(new ua("simple2prefix",(t=>(t.textContent.length>1&&!t.textContent[0].match(/[A-Z]/)&&(t.role=z.PREFIXFUNC),t)),(t=>"braille"===E.getInstance().modality&&t.type===K.IDENTIFIER))),ur.add(new ua("detect_cycle",(t=>{t.type=K.MATRIX,t.role=z.CYCLE;const e=t.childNodes[0];return e.type=K.ROW,e.role=z.CYCLE,e.textContent="",e.contentNodes=[],t}),(t=>t.type===K.FENCED&&t.childNodes[0].type===K.INFIXOP&&t.childNodes[0].role===z.IMPLICIT&&t.childNodes[0].childNodes.every((function(t){return t.type===K.NUMBER}))&&t.childNodes[0].contentNodes.every((function(t){return t.role===z.SPACE}))))),ur.add(new ha("intvar_from_implicit",(function(t){const e=t[0].childNodes;t.splice(0,1,...e)}),(t=>t[0]&&ds(t[0])))),ur.add(new ua("intvar_from_fraction",(function(t){const e=t.childNodes[1],n=e.childNodes[0];if($r(n))return void(n.role=z.INTEGRAL);if(!ds(n))return;const r=n.childNodes.length,s=n.childNodes[r-2],o=n.childNodes[r-1];if($r(o))return void(o.role=z.INTEGRAL);if(jr(s,o)){const t=Ns.getInstance().prefixNode_(o,[s]);t.role=z.INTEGRAL,2===r?e.childNodes[0]=t:(n.childNodes.pop(),n.contentNodes.pop(),n.childNodes[r-2]=t,t.parent=n)}}),(t=>{if(t.type!==K.INTEGRAL)return!1;const[,e,n]=t.childNodes;return n.type===K.EMPTY&&e.type===K.FRACTION}))),ur.add(new ua("rewrite_subcases",(function(t){t.addAnnotation("Emph","top");let e=[];if(t.hasAnnotation("Emph","left")){const n=Ca(t.childNodes[0].childNodes[0].childNodes[0],!0);n.forEach((t=>t.addAnnotation("Emph","left"))),e=e.concat(n);for(let e,n=0;e=t.childNodes[n];n++)e.childNodes.shift()}if(e.push(t),t.hasAnnotation("Emph","right")){const n=Ca(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1].childNodes[0]);n.forEach((t=>t.addAnnotation("Emph","left"))),e=e.concat(n),t.childNodes[0].childNodes.pop()}Ns.tableToMultiline(t);const n=Ns.getInstance().row(e),r=t.annotation.Emph;return t.annotation.Emph=["table"],r.forEach((t=>n.addAnnotation("Emph",t))),n}),(t=>{let e=!0,n=!0;if(Ra(t.childNodes[0].childNodes[0].mathmlTree)){for(let n,r=1;n=t.childNodes[r];r++)if(n.childNodes[0].childNodes.length){e=!1;break}}else e=!1;e&&t.addAnnotation("Emph","left");if(Ra(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1].mathmlTree)){const e=t.childNodes[0].childNodes.length;for(let r,s=1;r=t.childNodes[s];s++)if(r.childNodes.length>=e){n=!1;break}}else n=!1;return n&&t.addAnnotation("Emph","right"),e||n})));const Oa=[K.PUNCTUATED,K.RELSEQ,K.MULTIREL,K.INFIXOP,K.PREFIXOP,K.POSTFIXOP];function Ca(t,e){if(!t.childNodes.length)return La(t),[t];let n=null;if(t.type===K.PUNCTUATED&&(e?t.role===z.ENDPUNCT:t.role===z.STARTPUNCT)){const r=t.childNodes;La(r[e?r.length-1:0])&&(t=r[e?0:r.length-1],n=r[e?r.length-1:0])}if(-1!==Oa.indexOf(t.type)){const r=t.childNodes;La(r[e?r.length-1:0]);const s=Ta.combineContentChildren(t.type,t.role,t.contentNodes,t.childNodes);return n&&(e?s.push(n):s.unshift(n)),s}return n?e?[t,n]:[n,t]:[t]}const ba={[z.METRIC]:z.METRIC,[z.VBAR]:z.NEUTRAL,[z.OPENFENCE]:z.OPEN,[z.CLOSEFENCE]:z.CLOSE};function La(t){if(t.type!==K.PUNCTUATION)return!1;const e=ba[t.role];return!!e&&(t.role=e,t.type=K.FENCE,t.addAnnotation("Emph","fence"),!0)}function ya(t,e,n,r=n){let s=[];for(;t&&t.role===n;)s.push(t),t=e.shift();return s.length?(t&&e.unshift(t),[1===s.length?s[0]:Ma(s,r),e]):[t,e]}function Ma(t,e){let n=ur.factory.makeBranchNode(K.PUNCTUATION,t,[]);return n.role=e,n}ur.add(new ha("ellipses",(t=>{let e=[],n=t.shift();for(;n;)[n,t]=ya(n,t,z.FULLSTOP,z.ELLIPSIS),[n,t]=ya(n,t,z.DASH),e.push(n),n=t.shift();return e}),(t=>t.length>1))),ur.add(new ha("op_with_limits",(t=>{let e=t[0];return e.type=K.LARGEOP,e.role=z.SUM,t}),(t=>t[0].type===K.OPERATOR&&t.slice(1).some((t=>t.type===K.RELSEQ||t.type===K.MULTIREL||t.type===K.INFIXOP&&t.role===z.ELEMENT||t.type===K.PUNCTUATED&&t.role===z.SEQUENCE)))));class _a{static empty(){const t=L("<math/>"),e=new _a(t);return e.mathml=t,e}static fromNode(t,e){const n=_a.empty();return n.root=t,e&&(n.mathml=e),n}static fromRoot(t,e){let n=t;for(;n.parent;)n=n.parent;const r=_a.fromNode(n);return e&&(r.mathml=e),r}static fromXml(t){const e=_a.empty();return t.childNodes[0]&&(e.root=xr.fromXml(t.childNodes[0])),e}constructor(t){this.mathml=t,this.parser=new aa,this.root=this.parser.parse(t),this.collator=this.parser.getFactory().leafMap.collateMeaning();const e=this.collator.newDefault();e&&(this.parser=new aa,this.parser.getFactory().defaultMap=e,this.root=this.parser.parse(t)),Pa.visit(this.root,{}),function(t){for(const e of wn.values())e.active&&e.annotate(t);for(const e of Bn.values())e.active&&e.visit(t,Object.assign({},e.def))}(this.root)}xml(t){const e=L("<stree></stree>"),n=this.root.xml(e.ownerDocument,t);return e.appendChild(n),e}toString(t){return G(this.xml(t))}formatXml(t){return D(this.toString(t))}displayTree(){this.root.displayTree()}replaceNode(t,e){const n=t.parent;n?n.replaceChild(t,e):this.root=e}toJson(){const t={};return t.stree=this.root.toJson(),t}}const Pa=new vn("general","unit",((t,e)=>(hs(t)&&(t.role=z.UNIT),!1)));function Fa(t){return Ua(t).xml()}function Ua(t){return new _a(t)}const xa=[],Da=!0,va=!0;function wa(t){f.getInstance().output("WALKING START: "+t.toString());const e=function(t){for(let e,n=0;e=xa[n];n++)if(e.test(t))return e.constr(t);return null}(t);let n;if(e)return n=e.getMathml(),f.getInstance().output("WALKING END: "+t.toString()),Ka(n);if(1===t.mathml.length){if(f.getInstance().output("Walktree Case 0"),!t.childNodes.length)return f.getInstance().output("Walktree Case 0.1"),n=t.mathml[0],Ea(n,t),f.getInstance().output("WALKING END: "+t.toString()),Ka(n);const e=t.childNodes[0];if(1===t.childNodes.length&&e.type===K.EMPTY)return f.getInstance().output("Walktree Case 0.2"),n=t.mathml[0],Ea(n,t),n.appendChild(wa(e)),f.getInstance().output("WALKING END: "+t.toString()),Ka(n);t.childNodes.forEach((t=>{t.mathml.length||(t.mathml=[nl(t)])}))}const r=t.contentNodes.map(tl);rl(t,r);const s=t.childNodes.map(wa),o=Ta.combineContentChildren(t.type,t.role,r,s);if(n=t.mathmlTree,null===n)f.getInstance().output("Walktree Case 1"),n=Ba(o,t);else{const t=Xa(o);f.getInstance().output("Walktree Case 2"),t?(f.getInstance().output("Walktree Case 2.1"),n=Ja(t)):(f.getInstance().output("Walktree Case 2.2"),n=sl(n))}return n=el(n),function(t,e,n){if(!e.length)return;if(1===e.length&&t===e[0])return;const r=n.role===z.IMPLICIT&&ur.flags.combine_juxtaposition?function(t,e,n){const r=[];let s=b(t.childNodes),o=!1;for(;s.length;){const t=s.shift();if(t.hasAttribute(fa.TYPE)){r.push(t);continue}const n=Ga(t,e);0!==n.length&&(1!==n.length?(o?t.setAttribute("AuxiliaryImplicit",!0):o=!0,s=n.concat(s)):r.push(t))}const i=[],c=n.childNodes.map((function(t){return t.mathmlTree}));for(;c.length;){const t=c.pop();if(t){if(-1!==r.indexOf(t))break;-1!==e.indexOf(t)&&i.unshift(t)}}return r.concat(i)}(t,e,n):b(t.childNodes);if(!r.length)return void e.forEach((function(e){t.appendChild(e)}));let s=0;for(;e.length;){const n=e[0];if(r[s]===n||$a(r[s],n)){e.shift(),s++;continue}if(r[s]&&-1===e.indexOf(r[s])){s++;continue}if(ja(n,t)){e.shift();continue}const o=r[s];if(o)Va(t,o,n),e.shift();else{if(n.parentNode){t=Ja(n),e.shift();continue}const r=e[1];if(r&&r.parentNode){(t=Ja(r)).insertBefore(n,r),e.shift(),e.shift();continue}t.insertBefore(n,null),e.shift()}}}(n,o,t),Ea(n,t),f.getInstance().output("WALKING END: "+t.toString()),Ka(n)}function Ba(t,e){const n=function(t){const e=Xa(t);if(!e)return{type:Ha.INVALID,node:null};const n=Xa(t.slice().reverse());if(e===n)return{type:Ha.VALID,node:e};const r=Wa(e),s=function(t,e){let n=0;for(;t[n]&&-1===e.indexOf(t[n]);)n++;return t.slice(0,n+1)}(r,t),o=Wa(n,(function(t){return-1!==s.indexOf(t)})),i=o[0],c=s.indexOf(i);if(-1===c)return{type:Ha.INVALID,node:null};return{type:s.length!==r.length?Ha.PRUNED:Ya(s[c+1],o[1])?Ha.VALID:Ha.INVALID,node:i}}(t);let r=n.node;const s=n.type;if(s!==Ha.VALID||!Lr(r)||!r.parentNode&&e.parent)if(f.getInstance().output("Walktree Case 1.1"),r=Na(),s===Ha.PRUNED)f.getInstance().output("Walktree Case 1.1.0"),r=function(t,e,n){let r=qa(e);if(Cr(r)){f.getInstance().output("Walktree Case 1.1.0.0"),ka(r,t),b(r.childNodes).forEach((function(e){t.appendChild(e)}));const e=t;t=r,r=e}const s=n.indexOf(e);return n[s]=r,F(r,t),t.appendChild(r),n.forEach((function(e){t.appendChild(e)})),t}(r,n.node,t);else if(t[0]){f.getInstance().output("Walktree Case 1.1.1");const e=Xa(t);if(e){const n=function(t,e){const n=b(t.childNodes);let r=1/0,s=-1/0;return e.forEach((function(t){const e=n.indexOf(t);-1!==e&&(r=Math.min(r,e),s=Math.max(s,e))})),n.slice(r,s+1)}(Ja(e),t);F(e,r),n.forEach((function(t){r.appendChild(t)}))}else ka(r,t[0]),r=t[0]}return e.mathmlTree||(e.mathmlTree=r),r}function ka(t,e){for(const n of pa)t.hasAttribute(n)&&(e.setAttribute(n,t.getAttribute(n)),t.removeAttribute(n))}function Ga(t,e){const n=[];let r=b(t.childNodes);for(;r.length;){const t=r.shift();t.nodeType===y.ELEMENT_NODE&&(t.hasAttribute(fa.TYPE)||-1!==e.indexOf(t)?n.push(t):r=b(t.childNodes).concat(r))}return n}function Va(t,e,n){let r=e,s=Ja(r);for(;s&&s.firstChild===r&&!r.hasAttribute("AuxiliaryImplicit")&&s!==t;)r=s,s=Ja(r);s&&(s.insertBefore(n,r),r.removeAttribute("AuxiliaryImplicit"))}function ja(t,e){if(!t)return!1;do{if((t=Ja(t))===e)return!0}while(t);return!1}function $a(t,e){const n=tn.functionApplication;if(t&&e&&t.textContent&&e.textContent&&t.textContent===n&&e.textContent===n&&"true"===e.getAttribute(fa.ADDED)){for(let n,r=0;n=t.attributes[r];r++)e.hasAttribute(n.nodeName)||e.setAttribute(n.nodeName,n.nodeValue);return F(t,e),!0}return!1}var Ha;function Xa(t){let e=0,n=null;for(;!n&&e<t.length;)t[e].parentNode&&(n=t[e]),e++;return n}function Wa(t,e){const n=e||(t=>!1),r=[t];for(;!n(t)&&!Cr(t)&&t.parentNode;)t=Ja(t),r.unshift(t);return r}function Ya(t,e){return!(!t||!e||t.previousSibling||e.nextSibling)}function Ka(t){for(;!Cr(t)&&za(t);)t=Ja(t);return t}function qa(t){const e=b(t.childNodes);if(!e)return t;const n=e.filter((function(t){return t.nodeType===y.ELEMENT_NODE&&!br(t)}));return 1===n.length&&Lr(n[0])&&!n[0].hasAttribute(fa.TYPE)?qa(n[0]):t}function za(t){const e=Ja(t);return!(!e||!Lr(e))&&b(e.childNodes).every((function(e){return e===t||Qa(e)}))}function Qa(t){if(t.nodeType!==y.ELEMENT_NODE)return!0;if(!t||br(t))return!0;const e=b(t.childNodes);return!(!Lr(t)&&e.length||function(t){return!!t&&-1!==Rr.indexOf(B(t))}(t)||t.hasAttribute(fa.TYPE)||yr(t))&&b(t.childNodes).every(Qa)}function Ja(t){return t.parentNode}function Za(t,e){const n=new Ta(e);t.setAttribute(fa.COLLAPSED,n.toString())}function tl(t){if(t.mathml.length)return wa(t);const e=Da?nl(t):Na();return t.mathml=[e],e}function el(t){if(B(t)!==Sr.MFENCED)return t;const e=Na();for(let n,r=0;n=t.attributes[r];r++)-1===["open","close","separators"].indexOf(n.name)&&e.setAttribute(n.name,n.value);return b(t.childNodes).forEach((function(t){e.appendChild(t)})),F(t,e),e}function nl(t){const e=U("mo"),n=(r=t.textContent,d.f.document.createTextNode(r));var r;return e.appendChild(n),Ea(e,t),e.setAttribute(fa.ADDED,"true"),e}function rl(t,e){const n=t.type+(t.textContent?","+t.textContent:"");e.forEach((function(t){sl(t).setAttribute(fa.OPERATOR,n)}))}function sl(t){const e=b(t.childNodes);if(!e)return t;const n=e.filter((function(t){return!Qa(t)})),r=[];for(let t,e=0;t=n[e];e++)if(Lr(t)&&t.getAttribute(fa.TYPE)!==K.PUNCTUATION){const e=sl(t);e&&e!==t&&r.push(e)}else r.push(t);return 1===r.length?r[0]:t}function ol(t,e,n=!1){const r=D(t.toString()).toString().replace(new RegExp(da,"g"),"");return n?e+":\n```html\n"+r+"\n```\n":r}function il(t,e){const n=!!e,r=e||[],s=t.parent,o=t.contentNodes.map((function(t){return t.id}));o.unshift("c");const i=[t.id,o];for(let e,o=0;e=t.childNodes[o];o++){const t=wa(e);r.push(t);const o=sl(t);s&&!n&&o.setAttribute(fa.PARENT,s.id.toString()),i.push(e.id)}return i}!function(t){t.VALID="valid",t.INVALID="invalid",t.PRUNED="pruned"}(Ha||(Ha={}));class cl{constructor(t){this.semantic=t}}class al extends cl{static test(t){return!t.mathmlTree&&t.type===K.LINE&&t.role===z.BINOMIAL}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){if(!this.semantic.childNodes.length)return this.mml;const t=this.semantic.childNodes[0];if(this.mml=wa(t),this.mml.hasAttribute(fa.TYPE)){const t=Na();F(this.mml,t),t.appendChild(this.mml),this.mml=t}return Ea(this.mml,this.semantic),this.mml}}class ll extends cl{static test(t){if(!t.mathmlTree||!t.childNodes.length)return!1;const e=B(t.mathmlTree),n=t.childNodes[0].role;return e===Sr.MSUBSUP&&n===z.SUBSUP||e===Sr.MUNDEROVER&&n===z.UNDEROVER}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=this.semantic.childNodes[0],e=t.childNodes[0],n=this.semantic.childNodes[1],r=t.childNodes[1],s=wa(n),o=wa(e),i=wa(r);return Ea(this.mml,this.semantic),this.mml.setAttribute(fa.CHILDREN,ma([e,r,n])),[o,i,s].forEach((t=>sl(t).setAttribute(fa.PARENT,this.mml.getAttribute(fa.ID)))),this.mml.setAttribute(fa.TYPE,t.role),Za(this.mml,[this.semantic.id,[t.id,e.id,r.id],n.id]),this.mml}}class ul extends cl{static multiscriptIndex(t){return t.type===K.PUNCTUATED&&t.contentNodes[0].role===z.DUMMY?il(t):(wa(t),t.id)}static createNone_(t){const e=U("none");return t&&Ea(e,t),e.setAttribute(fa.ADDED,"true"),e}constructor(t){super(t),this.mml=t.mathmlTree}completeMultiscript(t,e){const n=b(this.mml.childNodes).slice(1);let r=0;const s=t=>{for(let e,s=0;e=t[s];s++){const t=n[r];if(t&&e===parseInt(sl(t).getAttribute(fa.ID)))sl(t).setAttribute(fa.PARENT,this.semantic.id.toString()),r++;else{const n=this.semantic.querySelectorAll((t=>t.id===e));this.mml.insertBefore(ul.createNone_(n[0]),t||null)}}};s(t),n[r]&&B(n[r])!==Sr.MPRESCRIPTS?this.mml.insertBefore(n[r],U("mprescripts")):r++,s(e)}}class hl extends ul{static test(t){if(!t.mathmlTree)return!1;return B(t.mathmlTree)===Sr.MMULTISCRIPTS&&(t.type===K.SUPERSCRIPT||t.type===K.SUBSCRIPT)}constructor(t){super(t)}getMathml(){let t,e,n;if(Ea(this.mml,this.semantic),this.semantic.childNodes[0]&&this.semantic.childNodes[0].role===z.SUBSUP){const r=this.semantic.childNodes[0];t=r.childNodes[0],e=ul.multiscriptIndex(this.semantic.childNodes[1]),n=ul.multiscriptIndex(r.childNodes[1]);const s=[this.semantic.id,[r.id,t.id,n],e];Za(this.mml,s),this.mml.setAttribute(fa.TYPE,r.role),this.completeMultiscript(Ta.interleaveIds(n,e),[])}else{t=this.semantic.childNodes[0],e=ul.multiscriptIndex(this.semantic.childNodes[1]);const n=[this.semantic.id,t.id,e];Za(this.mml,n)}const r=Ta.collapsedLeafs(n||[],e);return sl(wa(t)).setAttribute(fa.PARENT,this.semantic.id.toString()),r.unshift(t.id),this.mml.setAttribute(fa.CHILDREN,r.join(",")),this.mml}}class dl extends ul{static test(t){return!!t.mathmlTree&&t.type===K.TENSOR}constructor(t){super(t)}getMathml(){wa(this.semantic.childNodes[0]);const t=ul.multiscriptIndex(this.semantic.childNodes[1]),e=ul.multiscriptIndex(this.semantic.childNodes[2]),n=ul.multiscriptIndex(this.semantic.childNodes[3]),r=ul.multiscriptIndex(this.semantic.childNodes[4]);Ea(this.mml,this.semantic);const s=[this.semantic.id,this.semantic.childNodes[0].id,t,e,n,r];Za(this.mml,s);const o=Ta.collapsedLeafs(t,e,n,r);return o.unshift(this.semantic.childNodes[0].id),this.mml.setAttribute(fa.CHILDREN,o.join(",")),this.completeMultiscript(Ta.interleaveIds(n,r),Ta.interleaveIds(t,e)),this.mml}}class fl extends cl{static test(t){return!(!t.mathmlTree||!t.fencePointer||t.mathmlTree.getAttribute("data-semantic-type"))}static makeEmptyNode_(t){const e=Na(),n=new xr(t);return n.type=K.EMPTY,n.mathmlTree=e,n}static fencedMap_(t,e){e[t.id]=t.mathmlTree,t.embellished&&fl.fencedMap_(t.childNodes[0],e)}constructor(t){super(t),this.fenced=null,this.fencedMml=null,this.fencedMmlNodes=[],this.ofence=null,this.ofenceMml=null,this.ofenceMap={},this.cfence=null,this.cfenceMml=null,this.cfenceMap={},this.parentCleanup=[]}getMathml(){this.getFenced_(),this.fencedMml=wa(this.fenced),this.getFencesMml_(),this.fenced.type!==K.EMPTY||this.fencedMml.parentNode||(this.fencedMml.setAttribute(fa.ADDED,"true"),this.cfenceMml.parentNode.insertBefore(this.fencedMml,this.cfenceMml)),this.getFencedMml_();return this.rewrite_()}fencedElement(t){return t.type===K.FENCED||t.type===K.MATRIX||t.type===K.VECTOR}getFenced_(){let t=this.semantic;for(;!this.fencedElement(t);)t=t.childNodes[0];this.fenced=t.childNodes[0],this.ofence=t.contentNodes[0],this.cfence=t.contentNodes[1],fl.fencedMap_(this.ofence,this.ofenceMap),fl.fencedMap_(this.cfence,this.cfenceMap)}getFencedMml_(){let t=this.ofenceMml.nextSibling;for(t=t===this.fencedMml?t:this.fencedMml;t&&t!==this.cfenceMml;)this.fencedMmlNodes.push(t),t=t.nextSibling}getFencesMml_(){let t=this.semantic;const e=Object.keys(this.ofenceMap),n=Object.keys(this.cfenceMap);for(;!(this.ofenceMml&&this.cfenceMml||t===this.fenced);)-1===e.indexOf(t.fencePointer)||this.ofenceMml||(this.ofenceMml=t.mathmlTree),-1===n.indexOf(t.fencePointer)||this.cfenceMml||(this.cfenceMml=t.mathmlTree),t=t.childNodes[0];this.ofenceMml||(this.ofenceMml=this.ofence.mathmlTree),this.cfenceMml||(this.cfenceMml=this.cfence.mathmlTree),this.ofenceMml&&(this.ofenceMml=Ka(this.ofenceMml)),this.cfenceMml&&(this.cfenceMml=Ka(this.cfenceMml))}rewrite_(){let t=this.semantic,e=null;const n=this.introduceNewLayer_();for(Ea(n,this.fenced.parent);!this.fencedElement(t);){const r=t.mathmlTree,s=this.specialCase_(t,r);if(s)t=s;else{Ea(r,t);const e=[];for(let n,r=1;n=t.childNodes[r];r++)e.push(wa(n));t=t.childNodes[0]}const o=U("dummy"),i=r.childNodes[0];F(r,o),F(n,r),F(r.childNodes[0],n),F(o,i),e||(e=r)}return wa(this.ofence),wa(this.cfence),this.cleanupParents_(),e||n}specialCase_(t,e){const n=B(e);let r,s=null;if(n===Sr.MSUBSUP?(s=t.childNodes[0],r=ll):n===Sr.MMULTISCRIPTS&&(t.type===K.SUPERSCRIPT||t.type===K.SUBSCRIPT?r=hl:t.type===K.TENSOR&&(r=dl),s=r&&t.childNodes[0]&&t.childNodes[0].role===z.SUBSUP?t.childNodes[0]:t),!s)return null;const o=s.childNodes[0],i=fl.makeEmptyNode_(o.id);return s.childNodes[0]=i,e=new r(t).getMathml(),s.childNodes[0]=o,this.parentCleanup.push(e),s.childNodes[0]}introduceNewLayer_(){const t=this.fullFence(this.ofenceMml),e=this.fullFence(this.cfenceMml);let n=Na();if(F(this.fencedMml,n),this.fencedMmlNodes.forEach((t=>n.appendChild(t))),n.insertBefore(t,this.fencedMml),n.appendChild(e),!n.parentNode){const t=Na();for(;n.childNodes.length>0;)t.appendChild(n.childNodes[0]);n.appendChild(t),n=t}return n}fullFence(t){const e=this.fencedMml.parentNode;let n=t;for(;n.parentNode&&n.parentNode!==e;)n=n.parentNode;return n}cleanupParents_(){this.parentCleanup.forEach((function(t){const e=t.childNodes[1].getAttribute(fa.PARENT);t.childNodes[0].setAttribute(fa.PARENT,e)}))}}class pl extends cl{static test(t){return!!t.mathmlTree&&t.hasAnnotation("Emph","top")}constructor(t){super(t),this.mrows=[],this.mml=t.mathmlTree}getMathml(){if(this.recurseToTable(this.semantic),this.mrows.length){const t=Na();this.mml.parentNode.insertBefore(t,this.mml);for(const e of this.mrows)t.appendChild(e);t.appendChild(this.mml)}return this.mml}recurseToTable(t){var e,n;if(t.hasAnnotation("Emph","top")||t.hasAnnotation("Emph","fence")||!t.hasAnnotation("Emph","left")&&!t.hasAnnotation("Emph","right")){if(!t.mathmlTree||B(t.mathmlTree)===Sr.MTABLE&&(null===(e=t.annotation.Emph)||void 0===e?void 0:e.length)&&"table"!==t.annotation.Emph[0]){const e=Na();Ea(e,t),this.mrows.unshift(e)}else{if(B(t.mathmlTree)===Sr.MTABLE&&(null===(n=t.annotation.Emph)||void 0===n?void 0:n.length)&&"table"===t.annotation.Emph[0])return void this.finalizeTable(t);Ea(t.mathmlTree,t)}if(t.childNodes.forEach(this.recurseToTable.bind(this)),t.textContent||"punctuated"===t.type){const e=t.contentNodes.map((t=>{const e=tl(t);return e.hasAttribute("data-semantic-added")?this.mrows.unshift(e):this.recurseToTable(t),e}));rl(t,e)}else t.contentNodes.forEach(this.recurseToTable.bind(this))}else wa(t)}finalizeTable(t){Ea(t.mathmlTree,t),t.contentNodes.forEach((t=>{wa(t)})),t.childNodes.forEach((t=>{wa(t)}))}}class ml extends cl{static test(t){if(!t.mathmlTree||!t.childNodes.length)return!1;const e=B(t.mathmlTree),n=t.type;return(n===K.LIMUPPER||n===K.LIMLOWER)&&(e===Sr.MSUBSUP||e===Sr.MUNDEROVER)||n===K.LIMBOTH&&(e===Sr.MSUB||e===Sr.MUNDER||e===Sr.MSUP||e===Sr.MOVER)}static walkTree_(t){t&&wa(t)}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=this.semantic.childNodes;return this.semantic.type!==K.LIMBOTH&&this.mml.childNodes.length>=3&&(this.mml=Ba([this.mml],this.semantic)),Ea(this.mml,this.semantic),t[0].mathmlTree||(t[0].mathmlTree=this.semantic.mathmlTree),t.forEach(ml.walkTree_),this.mml}}class El extends cl{static test(t){return!!t.mathmlTree&&t.type===K.LINE}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){return this.semantic.contentNodes.length&&wa(this.semantic.contentNodes[0]),this.semantic.childNodes.length&&wa(this.semantic.childNodes[0]),Ea(this.mml,this.semantic),this.mml}}class gl extends cl{static test(t){return!!t.mathmlTree&&(t.type===K.INFERENCE||t.type===K.PREMISES)}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){return this.semantic.childNodes.length?(this.semantic.contentNodes.forEach((function(t){wa(t),Ea(t.mathmlTree,t)})),this.semantic.childNodes.forEach((function(t){wa(t)})),Ea(this.mml,this.semantic),this.mml.getAttribute("data-semantic-id")===this.mml.getAttribute("data-semantic-parent")&&this.mml.removeAttribute("data-semantic-parent"),this.mml):this.mml}}class Nl extends cl{static test(t){return t.type===K.MATRIX||t.type===K.VECTOR||t.type===K.CASES}constructor(t){super(t),this.inner=[],this.mml=t.mathmlTree}getMathml(){const t=tl(this.semantic.contentNodes[0]),e=this.semantic.contentNodes[1]?tl(this.semantic.contentNodes[1]):null;if(this.inner=this.semantic.childNodes.map(wa),this.mml)if(B(this.mml)===Sr.MFENCED){const n=this.mml.childNodes;this.mml.insertBefore(t,n[0]||null),e&&this.mml.appendChild(e),this.mml=el(this.mml)}else{const n=[t,this.mml];e&&n.push(e),this.mml=Ba(n,this.semantic)}else this.mml=Ba([t].concat(this.inner,[e]),this.semantic);return Ea(this.mml,this.semantic),this.mml}}class Sl extends cl{static test(t){return t.type===K.PUNCTUATED&&(t.role===z.TEXT||t.contentNodes.every((t=>t.role===z.DUMMY)))}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=[],e=il(this.semantic,t);return this.mml=Ba(t,this.semantic),Ea(this.mml,this.semantic),this.mml.removeAttribute(fa.CONTENT),Za(this.mml,e),this.mml}}function Tl(t){const e=k(t);return function(t,e){const n=k(t);return wa(e.root),E.getInstance().structure&&t.setAttribute(fa.STRUCTURE,Ta.fromStructure(t,e).toString()),f.getInstance().generateOutput((()=>[ol(n,"Original MathML",va),ol(e,"Semantic Tree",va),ol(t,"Semantically enriched MathML",va)])),t}(e,Ua(e))}function Il(t){return Tl(L(t))}xa.push({test:ml.test,constr:t=>new ml(t)},{test:fl.test,constr:t=>new fl(t)},{test:ll.test,constr:t=>new ll(t)},{test:dl.test,constr:t=>new dl(t)},{test:hl.test,constr:t=>new hl(t)},{test:El.test,constr:t=>new El(t)},{test:al.test,constr:t=>new al(t)},{test:gl.test,constr:t=>new gl(t)},{test:pl.test,constr:t=>new pl(t)},{test:Nl.test,constr:t=>new Nl(t)},{test:Sl.test,constr:t=>new Sl(t)});let Al=0;class Rl{constructor(){this.counter=Al++,this.ATTR="sre-highlight-"+this.counter.toString(),this.color=null,this.mactionName="",this.currentHighlights=[]}highlight(t){this.currentHighlights.push(t.map((t=>{const e=this.highlightNode(t);return this.setHighlighted(t),e})))}highlightAll(t){const e=this.getMactionNodes(t);for(let t,n=0;t=e[n];n++)this.highlight([t])}unhighlight(){const t=this.currentHighlights.pop();t&&t.forEach((t=>{this.isHighlighted(t.node)&&(this.unhighlightNode(t),this.unsetHighlighted(t.node))}))}unhighlightAll(){for(;this.currentHighlights.length>0;)this.unhighlight()}setColor(t){this.color=t}colorString(){return this.color.rgba()}addEvents(t,e){const n=this.getMactionNodes(t);for(let t,r=0;t=n[r];r++)for(const[n,r]of Object.entries(e))t.addEventListener(n,r)}getMactionNodes(t){return Array.from(t.getElementsByClassName(this.mactionName))}isMactionNode(t){const e=t.className||t.getAttribute("class");return!!e&&!!e.match(new RegExp(this.mactionName))}isHighlighted(t){return t.hasAttribute(this.ATTR)}setHighlighted(t){t.setAttribute(this.ATTR,"true")}unsetHighlighted(t){t.removeAttribute(this.ATTR)}colorizeAll(t){C(t);O(`.//*[@${fa.ID}]`,t).forEach((t=>this.colorize(t)))}uncolorizeAll(t){O(`.//*[@${fa.ID}]`,t).forEach((t=>this.uncolorize(t)))}colorize(t){const e=ga("foreground");t.hasAttribute(e)&&(t.setAttribute(e+"-old",t.style.color),t.style.color=t.getAttribute(e))}uncolorize(t){const e=ga("foreground")+"-old";t.hasAttribute(e)&&(t.style.color=t.getAttribute(e))}}class Ol extends Rl{constructor(){super(),this.mactionName="mjx-maction"}highlightNode(t){const e={node:t,background:t.style.backgroundColor,foreground:t.style.color};if(!this.isHighlighted(t)){const e=this.colorString();t.style.backgroundColor=e.background,t.style.color=e.foreground}return e}unhighlightNode(t){t.node.style.backgroundColor=t.background,t.node.style.color=t.foreground}}const Cl={red:{red:255,green:0,blue:0},green:{red:0,green:255,blue:0},blue:{red:0,green:0,blue:255},yellow:{red:255,green:255,blue:0},cyan:{red:0,green:255,blue:255},magenta:{red:255,green:0,blue:255},white:{red:255,green:255,blue:255},black:{red:0,green:0,blue:0}};function bl(t,e){const n=t||{color:e};let r=Object.prototype.hasOwnProperty.call(n,"color")?Cl[n.color]:n;return r||(r=Cl[e]),r.alpha=Object.prototype.hasOwnProperty.call(n,"alpha")?n.alpha:1,function(t){const e=t=>(t=Math.max(t,0),t=Math.min(255,t),Math.round(t));return t.red=e(t.red),t.green=e(t.green),t.blue=e(t.blue),t.alpha=Math.max(t.alpha,0),t.alpha=Math.min(1,t.alpha),t}(r)}class Ll{static toHex(t){const e=t.toString(16);return 1===e.length?"0"+e:e}constructor(t,e){this.foreground=bl(e,Ll.DEFAULT_FOREGROUND_),this.background=bl(t,Ll.DEFAULT_BACKGROUND_)}rgba(){const t=function(t){return"rgba("+t.red+","+t.green+","+t.blue+","+t.alpha+")"};return{background:t(this.background),foreground:t(this.foreground)}}rgb(){const t=function(t){return"rgb("+t.red+","+t.green+","+t.blue+")"};return{background:t(this.background),alphaback:this.background.alpha.toString(),foreground:t(this.foreground),alphafore:this.foreground.alpha.toString()}}hex(){const t=function(t){return"#"+Ll.toHex(t.red)+Ll.toHex(t.green)+Ll.toHex(t.blue)};return{background:t(this.background),alphaback:this.background.alpha.toString(),foreground:t(this.foreground),alphafore:this.foreground.alpha.toString()}}}Ll.DEFAULT_BACKGROUND_="blue",Ll.DEFAULT_FOREGROUND_="black";class yl{constructor(){this.hue=10,this.sat=100,this.light=50,this.incr=50}generate(){return e=function(t,e,n){e=e>1?e/100:e,n=n>1?n/100:n;const r=(1-Math.abs(2*n-1))*e,s=r*(1-Math.abs(t/60%2-1)),o=n-r/2;let i=0,c=0,a=0;return 0<=t&&t<60?[i,c,a]=[r,s,0]:60<=t&&t<120?[i,c,a]=[s,r,0]:120<=t&&t<180?[i,c,a]=[0,r,s]:180<=t&&t<240?[i,c,a]=[0,s,r]:240<=t&&t<300?[i,c,a]=[s,0,r]:300<=t&&t<360&&([i,c,a]=[r,0,s]),{red:i+o,green:c+o,blue:a+o}}(this.hue,this.sat,this.light),"rgb("+(t={red:Math.round(255*e.red),green:Math.round(255*e.green),blue:Math.round(255*e.blue)}).red+","+t.green+","+t.blue+")";var t,e}increment(){this.hue=(this.hue+this.incr)%360}}class Ml extends Rl{constructor(){super(),this.mactionName="mjx-svg-maction"}highlightNode(t){let e;if(this.isHighlighted(t))return e={node:t.previousSibling||t,background:t.style.backgroundColor,foreground:t.style.color},e;if("svg"===t.tagName){const e={node:t,background:t.style.backgroundColor,foreground:t.style.color};return t.style.backgroundColor=this.colorString().background,t.style.color=this.colorString().foreground,e}const n=x("http://www.w3.org/2000/svg","rect");let r;if("use"===t.nodeName){const e=x("http://www.w3.org/2000/svg","g");t.parentNode.insertBefore(e,t),e.appendChild(t),r=e.getBBox(),e.parentNode.replaceChild(t,e)}else r=t.getBBox();n.setAttribute("x",(r.x-40).toString()),n.setAttribute("y",(r.y-40).toString()),n.setAttribute("width",(r.width+80).toString()),n.setAttribute("height",(r.height+80).toString());const s=t.getAttribute("transform");return s&&n.setAttribute("transform",s),n.setAttribute("fill",this.colorString().background),n.setAttribute(this.ATTR,"true"),t.parentNode.insertBefore(n,t),e={node:n,foreground:t.getAttribute("fill")},t.setAttribute("fill",this.colorString().foreground),e}setHighlighted(t){"svg"===t.tagName&&super.setHighlighted(t)}unhighlightNode(t){if("background"in t)return t.node.style.backgroundColor=t.background,void(t.node.style.color=t.foreground);t.foreground?t.node.nextSibling.setAttribute("fill",t.foreground):t.node.nextSibling.removeAttribute("fill"),t.node.parentNode.removeChild(t.node)}isMactionNode(t){let e=t.className||t.getAttribute("class");return!!e&&(e=void 0!==e.baseVal?e.baseVal:e,!!e&&!!e.match(new RegExp(this.mactionName)))}}const _l={SVG:Ml,"SVG-V3":class extends Ml{constructor(){super(),this.mactionName="maction"}highlightNode(t){let e;if(this.isHighlighted(t))return e={node:t,background:this.colorString().background,foreground:this.colorString().foreground},e;if("svg"===t.tagName||"MJX-CONTAINER"===t.tagName)return e={node:t,background:t.style.backgroundColor,foreground:t.style.color},t.style.backgroundColor=this.colorString().background,t.style.color=this.colorString().foreground,e;const n=x("http://www.w3.org/2000/svg","rect");n.setAttribute("sre-highlighter-added","true");const r=t.getBBox();n.setAttribute("x",(r.x-40).toString()),n.setAttribute("y",(r.y-40).toString()),n.setAttribute("width",(r.width+80).toString()),n.setAttribute("height",(r.height+80).toString());const s=t.getAttribute("transform");if(s&&n.setAttribute("transform",s),n.setAttribute("fill",this.colorString().background),t.setAttribute(this.ATTR,"true"),t.parentNode.insertBefore(n,t),e={node:t,foreground:t.getAttribute("fill")},"rect"===t.nodeName){const e=new Ll({alpha:0,color:"black"});t.setAttribute("fill",e.rgba().foreground)}else t.setAttribute("fill",this.colorString().foreground);return e}unhighlightNode(t){const e=t.node.previousSibling;if(e&&e.hasAttribute("sre-highlighter-added"))return t.foreground?t.node.setAttribute("fill",t.foreground):t.node.removeAttribute("fill"),void t.node.parentNode.removeChild(e);t.node.style.backgroundColor=t.background,t.node.style.color=t.foreground}isMactionNode(t){return t.getAttribute("data-mml-node")===this.mactionName}getMactionNodes(t){return Array.from(O(`.//*[@data-mml-node="${this.mactionName}"]`,t))}},NativeMML:class extends Rl{constructor(){super(),this.mactionName="maction"}highlightNode(t){let e=t.getAttribute("style");return e+=";background-color: "+this.colorString().background,e+=";color: "+this.colorString().foreground,t.setAttribute("style",e),{node:t}}unhighlightNode(t){let e=t.node.getAttribute("style");e=e.replace(";background-color: "+this.colorString().background,""),e=e.replace(";color: "+this.colorString().foreground,""),t.node.setAttribute("style",e)}colorString(){return this.color.rgba()}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}isMactionNode(t){return t.tagName===this.mactionName}},"HTML-CSS":class extends Rl{constructor(){super(),this.mactionName="maction"}highlightNode(t){const e={node:t,foreground:t.style.color,position:t.style.position},n=this.color.rgb();t.style.color=n.foreground,t.style.position="relative";const r=t.bbox;if(r&&r.w){const s=.05,o=0,i=U("span"),c=parseFloat(t.style.paddingLeft||"0");i.style.backgroundColor=n.background,i.style.opacity=n.alphaback.toString(),i.style.display="inline-block",i.style.height=r.h+r.d+2*s+"em",i.style.verticalAlign=-r.d+"em",i.style.marginTop=i.style.marginBottom=-s+"em",i.style.width=r.w+2*o+"em",i.style.marginLeft=c-o+"em",i.style.marginRight=-r.w-o-c+"em",t.parentNode.insertBefore(i,t),e.box=i}return e}unhighlightNode(t){const e=t.node;e.style.color=t.foreground,e.style.position=t.position,t.box&&t.box.parentNode.removeChild(t.box)}},"MML-CSS":class extends Ol{constructor(){super(),this.mactionName="maction"}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}isMactionNode(t){return t.tagName===this.mactionName}},CommonHTML:Ol,CHTML:class extends Ol{constructor(){super()}isMactionNode(t){var e;return(null===(e=t.tagName)||void 0===e?void 0:e.toUpperCase())===this.mactionName.toUpperCase()}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}}};function Pl(t){return t?t.split(/,/):[]}function Fl(t,e){return t.getAttribute(e)}function Ul(t){if(t.hasAttribute(fa.TYPE)&&!t.hasAttribute(fa.PARENT))return t;const e=function(t,e){return t.querySelectorAll?b(t.querySelectorAll(`[${e}]`)):O(`.//*[@${e}]`,t)}(t,fa.TYPE);for(let t,n=0;t=e[n];n++)if(!t.hasAttribute(fa.PARENT))return t;return t}function xl(t,e){return t.getAttribute(fa.ID)===e?t:w(t,fa.ID,e)[0]}function Dl(t,e){return t.getAttribute(fa.ID)===e?[t]:w(t,fa.ID,e)}class vl{static textContent(t,e,n){if(!n&&e.textContent)return void(t.textContent=e.textContent);const r=Pl(Fl(e,fa.OPERATOR));r.length>1&&(t.textContent=r[1])}static isPunctuated(t){return!Ta.simpleCollapseStructure(t)&&t[1]&&Ta.contentCollapseStructure(t[1])}constructor(t){this.mathml=t,this.factory=new Dr,this.nodeDict={},this.mmlRoot=Ul(t),this.streeRoot=this.assembleTree(this.mmlRoot),this.stree=_a.fromNode(this.streeRoot,this.mathml),this.xml=this.stree.xml()}getTree(){return this.stree}assembleTree(t){const e=this.makeNode(t),n=Pl(Fl(t,fa.CHILDREN)),r=Pl(Fl(t,fa.CONTENT));if(0===r.length&&0===n.length)return vl.textContent(e,t),e;if(r.length>0){const t=xl(this.mathml,r[0]);t&&vl.textContent(e,t,!0)}e.contentNodes=r.map((t=>this.setParent(t,e))),e.childNodes=n.map((t=>this.setParent(t,e)));const s=Fl(t,fa.COLLAPSED);return s?this.postProcess(e,s):e}makeNode(t){const e=Fl(t,fa.TYPE),n=Fl(t,fa.ROLE),r=Fl(t,fa.FONT),s=Fl(t,fa.ANNOTATION)||"",o=Fl(t,fa.ATTRIBUTES)||"",i=Fl(t,fa.ID),c=Fl(t,fa.EMBELLISHED),a=Fl(t,fa.FENCEPOINTER),l=this.createNode(parseInt(i,10));return l.type=e,l.role=n,l.font=r||J.UNKNOWN,l.parseAnnotation(s),l.parseAttributes(o),a&&(l.fencePointer=a),c&&(l.embellished=c),l}makePunctuation(t){const e=this.createNode(t);return e.updateContent(tn.invisibleComma),e.role=z.DUMMY,e}makePunctuated(t,e,n){const r=this.createNode(e[0]);r.type=K.PUNCTUATED,r.embellished=t.embellished,r.fencePointer=t.fencePointer,r.role=n;const s=e.splice(1,1)[0].slice(1);r.contentNodes=s.map(this.makePunctuation.bind(this)),this.collapsedChildren_(e)}makeEmpty(t,e,n){const r=this.createNode(e);r.type=K.EMPTY,r.embellished=t.embellished,r.fencePointer=t.fencePointer,r.role=n}makeIndex(t,e,n){if(vl.isPunctuated(e))return this.makePunctuated(t,e,n),void(e=e[0]);Ta.simpleCollapseStructure(e)&&!this.nodeDict[e.toString()]&&this.makeEmpty(t,e,n)}postProcess(t,e){const n=Ta.fromString(e).array;if(t.type===z.SUBSUP){const e=this.createNode(n[1][0]);return e.type=K.SUBSCRIPT,e.role=z.SUBSUP,t.type=K.SUPERSCRIPT,e.embellished=t.embellished,e.fencePointer=t.fencePointer,this.makeIndex(t,n[1][2],z.RIGHTSUB),this.makeIndex(t,n[2],z.RIGHTSUPER),this.collapsedChildren_(n),t}if(t.type===K.SUBSCRIPT)return this.makeIndex(t,n[2],z.RIGHTSUB),this.collapsedChildren_(n),t;if(t.type===K.SUPERSCRIPT)return this.makeIndex(t,n[2],z.RIGHTSUPER),this.collapsedChildren_(n),t;if(t.type===K.TENSOR)return this.makeIndex(t,n[2],z.LEFTSUB),this.makeIndex(t,n[3],z.LEFTSUPER),this.makeIndex(t,n[4],z.RIGHTSUB),this.makeIndex(t,n[5],z.RIGHTSUPER),this.collapsedChildren_(n),t;if(t.type===K.PUNCTUATED){if(vl.isPunctuated(n)){const e=n.splice(1,1)[0].slice(1);t.contentNodes=e.map(this.makePunctuation.bind(this))}return t}if(t.type===z.UNDEROVER){const e=this.createNode(n[1][0]);return t.childNodes[1].role===z.OVERACCENT?(e.type=K.OVERSCORE,t.type=K.UNDERSCORE):(e.type=K.UNDERSCORE,t.type=K.OVERSCORE),e.role=z.UNDEROVER,e.embellished=t.embellished,e.fencePointer=t.fencePointer,this.collapsedChildren_(n),t}return t}createNode(t){const e=this.factory.makeNode(t);return this.nodeDict[t.toString()]=e,e}collapsedChildren_(t){const e=t=>{const n=this.nodeDict[t[0]];n.childNodes=[];for(let r=1,s=t.length;r<s;r++){const s=t[r];n.childNodes.push(Ta.simpleCollapseStructure(s)?this.nodeDict[s]:e(s))}return n};e(t)}setParent(t,e){const n=xl(this.mathml,t),r=this.assembleTree(n);return r.parent=e,r}}function wl(t){return Xi.getInstance().evaluateNode(t)}function Bl(t){return oa(wl(t))}function kl(t){const e=function(t){return wl(_a.fromNode(t).xml())}(t);return oa(e)}function Gl(t,e,n){const r=w(n,"id",e.id.toString())[0],s=r?oa(wl(r)):kl(e);t.setAttribute(fa.SPEECH,s)}function Vl(t,e,n){const r=kl(e);t.setAttribute(n,r)}function jl(t,e){const n=$l(e);n&&t.setAttribute(fa.PREFIX,n)}function $l(t){const e=function(t){const e=_a.fromRoot(t),n=O('.//*[@id="'+t.id+'"]',e.xml());let r=n[0];n.length>1&&(r=function(t,e){const n=e[0];if(!t.parent)return n;const r=[];for(;t;)r.push(t.id),t=t.parent;const s=function(t,e){for(;e.length&&e.shift().toString()===t.getAttribute("id")&&t.parentNode&&t.parentNode.parentNode;)t=t.parentNode.parentNode;return!e.length};for(let t,n=0;t=e[n];n++)if(s(t,r.slice()))return t;return n}(t,n)||r);return r?Xi.getInstance().runInSetting({modality:"prefix",domain:"default",style:"default",strict:!0,speech:!0},(function(){return Xi.getInstance().evaluateNode(r)})):[]}(t);return oa(e)}function Hl(t,e,n){const r=function(t,e){return t.querySelectorAll?b(t.querySelectorAll(e)):O(`.//${e}`,t)}(e,"maction");for(let e,s=0;e=r[s];s++){const r=w(t,"id",e.getAttribute("id"))[0];if(!r)continue;const s=e.childNodes[1],o=s.getAttribute(fa.ID);let i=xl(t,o);if(i&&"dummy"!==i.getAttribute(fa.TYPE))continue;if(i=r.childNodes[0],i.getAttribute("sre-highlighter-added"))continue;const c=s.getAttribute(fa.PARENT);c&&i.setAttribute(fa.PARENT,c),i.setAttribute(fa.TYPE,"dummy"),i.setAttribute(fa.ID,o),i.setAttribute("role","treeitem"),i.setAttribute("aria-level",s.getAttribute("aria-level"));w(n,"id",o)[0].setAttribute("alternative",o)}}function Xl(t,e={}){const n=function(t,e={}){const n=e.locale?{locale:e.locale}:{};return t?Xi.getInstance().runInSetting(Object.assign(n,{modality:"summary",strict:!1,speech:!0}),(function(){return Xi.getInstance().evaluateNode(t)})):[]}(t,e);return oa(n)}class Wl extends o{static comparator(){return new Kl(E.getInstance().dynamicCstr,s.createProp([o.DEFAULT_VALUES[t.LOCALE]],[o.DEFAULT_VALUES[t.MODALITY]],[o.DEFAULT_VALUES[t.DOMAIN]],[o.DEFAULT_VALUES[t.STYLE]]))}static fromPreference(t){const e=t.split(":"),n={},r=Yl.getProperties(),s=Object.keys(r);for(let t,o=0;t=e[o];o++){const e=t.split("_");if(-1===s.indexOf(e[0]))continue;const o=e[1];o&&o!==Wl.AUTO&&-1!==r[e[0]].indexOf(o)&&(n[e[0]]=e[1])}return n}static toPreference(t){const e=Object.keys(t),n=[];for(let r=0;r<e.length;r++)n.push(e[r]+"_"+t[e[r]]);return n.length?n.join(":"):o.DEFAULT_VALUE}static getLocalePreferences(t){const e=t||On(Xi.getInstance().enumerate());return Wl.getLocalePreferences_(e)}static currentPreference(){return h.clearspeak}static relevantPreferences(t){const e=zl[t.type];return e&&(e[t.role]||e[""])||"ImpliedTimes"}static findPreference(t,e){if("default"===t)return Wl.AUTO;return Wl.fromPreference(t)[e]||Wl.AUTO}static addPreference(t,e,n){if("default"===t)return e+"_"+n;const r=Wl.fromPreference(t);return r[e]=n,Wl.toPreference(r)}static getLocalePreferences_(t){const e={};for(const n of Object.keys(t)){if(!t[n].speech||!t[n].speech.clearspeak)continue;const r=Object.keys(t[n].speech.clearspeak);if(r.length<3)continue;const s=e[n]={};for(const t in Yl.getProperties()){const e=Yl.getProperties()[t],n=[t+"_Auto"];if(e)for(const s of e)-1!==r.indexOf(t+"_"+s)&&n.push(t+"_"+s);s[t]=n}}return e}constructor(t,e){super(t),this.preference=e}equal(t){if(!super.equal(t))return!1;const e=Object.keys(this.preference),n=t.preference;if(e.length!==Object.keys(n).length)return!1;for(let t,r=0;t=e[r];r++)if(this.preference[t]!==n[t])return!1;return!0}}Wl.AUTO="Auto";const Yl=new s({AbsoluteValue:["Auto","AbsEnd","Cardinality","Determinant"],Bar:["Auto","Conjugate"],Caps:["Auto","SayCaps"],CombinationPermutation:["Auto","ChoosePermute"],Currency:["Auto","Position","Prefix"],Ellipses:["Auto","AndSoOn"],Enclosed:["Auto","EndEnclose"],Exponent:["Auto","AfterPower","Ordinal","OrdinalPower","Exponent"],Fraction:["Auto","EndFrac","FracOver","General","GeneralEndFrac","Ordinal","Over","OverEndFrac","Per"],Functions:["Auto","None","Reciprocal"],ImpliedTimes:["Auto","MoreImpliedTimes","None"],Log:["Auto","LnAsNaturalLog"],Matrix:["Auto","Combinatoric","EndMatrix","EndVector","SilentColNum","SpeakColNum","Vector"],MultiLineLabel:["Auto","Case","Constraint","Equation","Line","None","Row","Step"],MultiLineOverview:["Auto","None"],MultiLinePausesBetweenColumns:["Auto","Long","Short"],MultsymbolDot:["Auto","Dot"],MultsymbolX:["Auto","By","Cross"],Paren:["Auto","CoordPoint","Interval","Silent","Speak","SpeakNestingLevel"],Prime:["Auto","Angle","Length"],Roots:["Auto","PosNegSqRoot","PosNegSqRootEnd","RootEnd"],SetMemberSymbol:["Auto","Belongs","Element","Member","In"],Sets:["Auto","SilentBracket","woAll"],TriangleSymbol:["Auto","Delta"],Trig:["Auto","ArcTrig","TrigInverse","Reciprocal"],VerticalLine:["Auto","Divides","Given","SuchThat"]});class Kl extends c{constructor(t,e){super(t,e),this.preference=t instanceof Wl?t.preference:{}}match(e){if(!(e instanceof Wl))return super.match(e);if("default"===e.getComponents()[t.STYLE])return!0;const n=Object.keys(e.preference);for(let t,r=0;t=n[r];r++)if(this.preference[t]!==e.preference[t])return!1;return!0}compare(t,e){const n=super.compare(t,e);if(0!==n)return n;const r=t instanceof Wl,s=e instanceof Wl;if(!r&&s)return 1;if(r&&!s)return-1;if(!r&&!s)return 0;const o=Object.keys(t.preference).length,i=Object.keys(e.preference).length;return o>i?-1:o<i?1:0}}const ql=[["AbsoluteValue",K.FENCED,z.NEUTRAL,z.METRIC],["Bar",K.OVERSCORE,z.OVERACCENT],["Caps",K.IDENTIFIER,z.LATINLETTER],["CombinationPermutation",K.APPL,z.UNKNOWN],["Ellipses",K.PUNCTUATION,z.ELLIPSIS],["Exponent",K.SUPERSCRIPT,""],["Fraction",K.FRACTION,""],["Functions",K.APPL,z.SIMPLEFUNC],["ImpliedTimes",K.OPERATOR,z.IMPLICIT],["Log",K.APPL,z.PREFIXFUNC],["Matrix",K.MATRIX,""],["Matrix",K.VECTOR,""],["MultiLineLabel",K.MULTILINE,z.LABEL],["MultiLineOverview",K.MULTILINE,z.TABLE],["MultiLinePausesBetweenColumns",K.MULTILINE,z.TABLE],["MultiLineLabel",K.TABLE,z.LABEL],["MultiLineOverview",K.TABLE,z.TABLE],["MultiLinePausesBetweenColumns",K.TABLE,z.TABLE],["MultiLineLabel",K.CASES,z.LABEL],["MultiLineOverview",K.CASES,z.TABLE],["MultiLinePausesBetweenColumns",K.CASES,z.TABLE],["MultsymbolDot",K.OPERATOR,z.MULTIPLICATION],["MultsymbolX",K.OPERATOR,z.MULTIPLICATION],["Paren",K.FENCED,z.LEFTRIGHT],["Prime",K.SUPERSCRIPT,z.PRIME],["Roots",K.ROOT,""],["Roots",K.SQRT,""],["SetMemberSymbol",K.RELATION,z.ELEMENT],["Sets",K.FENCED,z.SETEXT],["TriangleSymbol",K.IDENTIFIER,z.GREEKLETTER],["Trig",K.APPL,z.PREFIXFUNC],["VerticalLine",K.PUNCTUATED,z.VBAR]],zl=function(){const t={};for(let e,n=0;e=ql[n];n++){const n=e[0];let r=t[e[1]];r||(r={},t[e[1]]=r),r[e[2]]=n}return t}();E.getInstance().comparators.clearspeak=Wl.comparator,E.getInstance().parsers.clearspeak=new class extends i{constructor(){super([t.LOCALE,t.MODALITY,t.DOMAIN,t.STYLE])}parse(e){const n=super.parse(e);let r=n.getValue(t.STYLE);const s=n.getValue(t.LOCALE),i=n.getValue(t.MODALITY);let c={};return r!==o.DEFAULT_VALUE&&(c=this.fromPreference(r),r=this.toPreference(c)),new Wl({locale:s,modality:i,domain:"clearspeak",style:r},c)}fromPreference(t){return Wl.fromPreference(t)}toPreference(t){return Wl.toPreference(t)}};class Ql{constructor(){this.modality=ga("speech"),this.rebuilt_=null,this.options_={}}getRebuilt(){return this.rebuilt_}setRebuilt(t){this.rebuilt_=t}computeRebuilt(t,e=!1){return this.rebuilt_&&!e||(this.rebuilt_=new vl(t)),this.rebuilt_}setOptions(t){this.options_=t||{},this.modality=ga(this.options_.modality||"speech")}setOption(t,e){const n=this.getOptions();n[t]=e,this.setOptions(n)}getOptions(){return this.options_}generateSpeech(t,e){return this.rebuilt_||(this.rebuilt_=new vl(e)),pc(this.options_),Bl(this.getRebuilt().xml)}nextRules(){const t=this.getOptions();if("speech"!==t.modality)return;Wl.getLocalePreferences()[t.locale]&&(h[t.domain]=t.style,t.domain="mathspeak"===t.domain?"clearspeak":"mathspeak",t.style=h[t.domain],this.setOptions(t))}nextStyle(t){this.setOption("style",this.nextStyle_(this.getRebuilt().nodeDict[t]))}nextStyle_(t){const{modality:e,domain:n,style:r}=this.getOptions();if("speech"!==e)return r;if("mathspeak"===n){const t=["default","brief","sbrief"],e=t.indexOf(r);return-1===e?r:e>=t.length-1?t[0]:t[e+1]}if("clearspeak"===n){const e=Wl.getLocalePreferences().en;if(!e)return"default";const n=Wl.relevantPreferences(t),s=Wl.findPreference(r,n),o=e[n].map((function(t){return t.split("_")[1]})),i=o.indexOf(s);if(-1===i)return r;const c=i>=o.length-1?o[0]:o[i+1];return Wl.addPreference(r,n,c)}return r}getLevel(t){return at.MESSAGES.navigate.LEVEL+" "+t}getActionable(t){return t?t<0?at.MESSAGES.navigate.EXPANDABLE:at.MESSAGES.navigate.COLLAPSIBLE:""}}class Jl extends Ql{getSpeech(t,e){const n=this.generateSpeech(t,e);return t.setAttribute(this.modality,n),n}}class Zl extends Ql{constructor(){super(...arguments),this.modality=ga("foreground"),this.contrast=new yl}static visitStree_(t,e,n){if(t.childNodes.length){if(t.contentNodes.length&&("punctuated"===t.type&&t.contentNodes.forEach((t=>n[t.id]=!0)),"implicit"!==t.role&&e.push(t.contentNodes.map((t=>t.id)))),t.childNodes.length){if("implicit"===t.role){const r=[];let s=[];for(const e of t.childNodes){const t=[];Zl.visitStree_(e,t,n),t.length<=2&&r.push(t.shift()),s=s.concat(t)}return e.push(r),void s.forEach((t=>e.push(t)))}t.childNodes.forEach((t=>Zl.visitStree_(t,e,n)))}}else n[t.id]||e.push(t.id)}getSpeech(t,e){return Fl(t,this.modality)}generateSpeech(t,e){return this.getRebuilt()||this.setRebuilt(new vl(L(e))),this.colorLeaves_(t),Fl(t,this.modality)}colorLeaves_(t){const e=[];Zl.visitStree_(this.getRebuilt().streeRoot,e,{});for(const n of e){const e=this.contrast.generate();let r=!1;r=Array.isArray(n)?n.map((n=>this.colorLeave_(t,n,e))).reduce(((t,e)=>t||e),!1):this.colorLeave_(t,n.toString(),e),r&&this.contrast.increment()}}colorLeave_(t,e,n){const r=xl(t,e);return!!r&&(r.setAttribute(this.modality,n),!0)}}class tu extends Ql{getSpeech(t,e){return Fl(t,this.modality)}}class eu extends Ql{getSpeech(t,e){return""}}class nu extends Ql{getSpeech(t,e,n=null){this.getRebuilt()&&Hl(t,e,this.getRebuilt().xml);const r=this.generateSpeech(t,e),s=this.getRebuilt().nodeDict;for(const[r,o]of Object.entries(s)){const s=xl(e,r),i=xl(t,r)||n&&xl(n,r);s&&i&&(this.modality&&this.modality!==fa.SPEECH?Vl(i,o,this.modality):Gl(i,o,this.getRebuilt().xml),this.modality===fa.SPEECH&&jl(i,o))}return r}}class ru extends nu{getSpeech(t,e){return super.getSpeech(t,e),Fl(t,this.modality)}}class su extends Ql{getSpeech(t,e){pc(this.getOptions());const n=t.getAttribute(fa.ID);Vl(t,this.getRebuilt().streeRoot.querySelectorAll((t=>t.id.toString()===n))[0],this.modality);return t.getAttribute(fa.SUMMARY)}}function ou(t){return(iu[t]||iu.Direct)()}const iu={Adhoc:()=>new Jl,Color:()=>new Zl,Direct:()=>new tu,Dummy:()=>new eu,Node:()=>new ru,Summary:()=>new su,Tree:()=>new nu};class cu{static factory(t,e,n,r){const s=t=>xl(r,t),o=n.nodeDict,i=s(t),c=e.map(s),a=e.map((function(t){return o[t]})),l=new cu(a,o[t]);return l.domNodes=c,l.domPrimary_=i,l.allNodes=cu.generateAllVisibleNodes_(e,c,o,r),l}static generateAllVisibleNodes_(t,e,n,r){let s=[];for(let o=0,i=t.length;o<i;o++){if(e[o]){const n=cu.getAllVisibleNodes([t[o]],r);n.length?s=s.concat(n):s.push(e[o]);continue}const i=n[t[o]];if(!i)continue;const c=i.childNodes.map((t=>t.id.toString())),a=cu.getAllVisibleNodes(c,r);s=s.concat(cu.generateAllVisibleNodes_(c,a,n,r))}return s}static getAllVisibleNodes(t,e){let n=[];for(const r of t)n=n.concat(Dl(e,r));return n}constructor(t,e){this.nodes=t,this.primary=e,this.domNodes=[],this.domPrimary_=null,this.allNodes=[]}getSemanticPrimary(){return this.primary}getSemanticNodes(){return this.nodes}getNodes(){return this.allNodes}getDomNodes(){return this.domNodes}getDomPrimary(){return this.domPrimary_}toString(){return"Primary:"+this.domPrimary_+" Nodes:"+this.domNodes}clone(){const t=new cu(this.nodes,this.primary);return t.domNodes=this.domNodes,t.domPrimary_=this.domPrimary_,t.allNodes=this.allNodes,t}}var au;!function(t){t.UP="up",t.DOWN="down",t.LEFT="left",t.RIGHT="right",t.REPEAT="repeat",t.DEPTH="depth",t.ENTER="enter",t.EXPAND="expand",t.HOME="home",t.SUMMARY="summary",t.DETAIL="detail",t.ROW="row",t.CELL="cell"}(au||(au={}));class lu{static resetState(t){delete lu.STATE[t]}static setState(t,e){lu.STATE[t]=e}static getState(t){return lu.STATE[t]}}lu.STATE={};class uu{constructor(t,e,n,r){this.node=t,this.generator=e,this.highlighter=n,this.modifier=!1,this.keyMapping=new Map([[mc.UP,this.up.bind(this)],[mc.DOWN,this.down.bind(this)],[mc.RIGHT,this.right.bind(this)],[mc.LEFT,this.left.bind(this)],[mc.TAB,this.repeat.bind(this)],[mc.DASH,this.expand.bind(this)],[mc.SPACE,this.depth.bind(this)],[mc.HOME,this.home.bind(this)],[mc.X,this.summary.bind(this)],[mc.Z,this.detail.bind(this)],[mc.V,this.virtualize.bind(this)],[mc.P,this.previous.bind(this)],[mc.U,this.undo.bind(this)],[mc.LESS,this.previousRules.bind(this)],[mc.GREATER,this.nextRules.bind(this)]]),this.cursors=[],this.xml_=null,this.rebuilt_=null,this.focus_=null,this.active_=!1,this.node.id?this.id=this.node.id:this.node.hasAttribute(uu.SRE_ID_ATTR)?this.id=this.node.getAttribute(uu.SRE_ID_ATTR):(this.node.setAttribute(uu.SRE_ID_ATTR,uu.ID_COUNTER.toString()),this.id=uu.ID_COUNTER++),this.rootNode=Ul(t),this.rootId=this.rootNode.getAttribute(fa.ID),this.xmlString_=r,this.moved=au.ENTER}getXml(){return this.xml_||(this.xml_=L(this.xmlString_)),this.xml_}getRebuilt(){return this.rebuilt_||this.rebuildStree(),this.rebuilt_}isActive(){return this.active_}activate(){this.isActive()||this.toggleActive_()}deactivate(){this.isActive()&&(lu.setState(this.id,this.primaryId()),this.toggleActive_())}getFocus(t=!1){return null===this.rootId&&this.getRebuilt(),this.focus_||(this.focus_=this.singletonFocus(this.rootId)),t&&this.updateFocus(),this.focus_}setFocus(t){this.focus_=t}getDepth(){return this.levels.depth()-1}isSpeech(){return this.generator.modality===fa.SPEECH}focusDomNodes(){return this.getFocus().getDomNodes()}focusSemanticNodes(){return this.getFocus().getSemanticNodes()}speech(){const t=this.focusDomNodes();if(!t.length)return"";const e=this.specialMove();if(null!==e)return e;switch(this.moved){case au.DEPTH:return this.depth_();case au.SUMMARY:return this.summary_();case au.DETAIL:return this.detail_();default:{const e=[],n=this.focusSemanticNodes();for(let r=0,s=t.length;r<s;r++){const s=t[r],o=n[r];e.push(s?this.generator.getSpeech(s,this.getXml(),this.node):kl(o))}return this.mergePrefix_(e)}}}move(t){const e=this.keyMapping.get(t);if(!e)return null;const n=e();return!(!n||n===this.getFocus())&&(this.setFocus(n),this.moved===au.HOME&&(this.levels=this.initLevels()),!0)}up(){return this.moved=au.UP,this.getFocus()}down(){return this.moved=au.DOWN,this.getFocus()}left(){return this.moved=au.LEFT,this.getFocus()}right(){return this.moved=au.RIGHT,this.getFocus()}repeat(){return this.moved=au.REPEAT,this.getFocus().clone()}depth(){return this.moved=this.isSpeech()?au.DEPTH:au.REPEAT,this.getFocus().clone()}home(){this.moved=au.HOME;return this.singletonFocus(this.rootId)}getBySemanticId(t){return xl(this.node,t)}primaryId(){return this.getFocus().getSemanticPrimary().id.toString()}expand(){const t=this.getFocus().getDomPrimary(),e=this.actionable_(t);return e?(this.moved=au.EXPAND,e.dispatchEvent(new Event("click")),this.getFocus().clone()):this.getFocus()}expandable(t){return!!this.actionable_(t)&&0===t.childNodes.length}collapsible(t){return!!this.actionable_(t)&&t.childNodes.length>0}restoreState(){if(!this.highlighter)return;const t=lu.getState(this.id);if(!t)return;let e=this.getRebuilt().nodeDict[t];const n=[];for(;e;)n.push(e.id),e=e.parent;for(n.pop();n.length>0;){this.down();const t=n.pop(),e=this.findFocusOnLevel(t);if(!e)break;this.setFocus(e)}this.moved=au.ENTER}updateFocus(){this.setFocus(cu.factory(this.getFocus().getSemanticPrimary().id.toString(),this.getFocus().getSemanticNodes().map((t=>t.id.toString())),this.getRebuilt(),this.node))}rebuildStree(){this.rebuilt_=new vl(this.getXml()),this.rootId=this.rebuilt_.stree.root.id.toString(),this.generator.setRebuilt(this.rebuilt_),this.skeleton=Ta.fromTree(this.rebuilt_.stree),this.skeleton.populate(),this.focus_=this.singletonFocus(this.rootId),this.levels=this.initLevels(),Hl(this.node,this.getXml(),this.rebuilt_.xml)}previousLevel(){const t=this.getFocus().getDomPrimary();return t?Fl(t,fa.PARENT):this.getFocus().getSemanticPrimary().parent.id.toString()}nextLevel(){const t=this.getFocus().getDomPrimary();let e,n;if(t){e=Pl(Fl(t,fa.CHILDREN)),n=Pl(Fl(t,fa.CONTENT));const r=Fl(t,fa.TYPE),s=Fl(t,fa.ROLE);return this.combineContentChildren(r,s,n,e)}const r=t=>t.id.toString(),s=this.getRebuilt().nodeDict[this.primaryId()];return e=s.childNodes.map(r),n=s.contentNodes.map(r),0===e.length?[]:this.combineContentChildren(s.type,s.role,n,e)}singletonFocus(t){this.getRebuilt();const e=this.retrieveVisuals(t);return this.focusFromId(t,e)}retrieveVisuals(t){if(!this.skeleton)return[t];const e=parseInt(t,10),n=this.skeleton.subtreeNodes(e);if(!n.length)return[t];n.unshift(e);const r={},s=[];C(this.getXml());for(const t of n)r[t]||(s.push(t.toString()),r[t]=!0,this.subtreeIds(t,r));return s}subtreeIds(t,e){const n=O(`//*[@data-semantic-id="${t}"]`,this.getXml());O("*//@data-semantic-id",n[0]).forEach((t=>e[parseInt(t.textContent,10)]=!0))}focusFromId(t,e){return cu.factory(t,e,this.getRebuilt(),this.node)}summary(){return this.moved=this.isSpeech()?au.SUMMARY:au.REPEAT,this.getFocus().clone()}detail(){return this.moved=this.isSpeech()?au.DETAIL:au.REPEAT,this.getFocus().clone()}specialMove(){return null}virtualize(t){return this.cursors.push({focus:this.getFocus(),levels:this.levels,undo:t||!this.cursors.length}),this.levels=this.levels.clone(),this.getFocus().clone()}previous(){const t=this.cursors.pop();return t?(this.levels=t.levels,t.focus):this.getFocus()}undo(){let t;do{t=this.cursors.pop()}while(t&&!t.undo);return t?(this.levels=t.levels,t.focus):this.getFocus()}update(t){pc(t).then((()=>ou("Tree").getSpeech(this.node,this.getXml())))}nextRules(){this.generator.nextRules();const t=this.generator.getOptions();return"speech"!==t.modality?this.getFocus():(this.update(t),this.moved=au.REPEAT,this.getFocus().clone())}previousRules(){var t;this.generator.nextStyle(null===(t=this.getFocus().getSemanticPrimary())||void 0===t?void 0:t.id.toString());const e=this.generator.getOptions();return"speech"!==e.modality?this.getFocus():(this.update(e),this.moved=au.REPEAT,this.getFocus().clone())}refocus(){let t,e=this.getFocus();for(;!e.getNodes().length;){t=this.levels.peek();const n=this.up();if(!n)break;this.setFocus(n),e=this.getFocus(!0)}this.levels.push(t),this.setFocus(e)}toggleActive_(){this.active_=!this.active_}mergePrefix_(t,e=[]){const n=this.isSpeech()?this.prefix_():"";n&&t.unshift(n);const r=this.isSpeech()?this.postfix_():"";return r&&t.push(r),ia(function(t){const e=t.map((t=>"string"==typeof t?bn.stringEmpty(t):t)),n=sa.get(E.getInstance().markup);return n?n.merge(e):t.join()}(e.concat(t)))}prefix_(){const t=this.getFocus().getDomNodes(),e=this.getFocus().getSemanticNodes();return t[0]?Fl(t[0],fa.PREFIX):$l(e[0])}postfix_(){const t=this.getFocus().getDomNodes();return t[0]?Fl(t[0],fa.POSTFIX):""}depth_(){const t=mt.getInstance().getParameter("depth");mt.getInstance().setParameter("depth",!0);const e=this.getFocus().getDomPrimary(),n=this.expandable(e)?at.MESSAGES.navigate.EXPANDABLE:this.collapsible(e)?at.MESSAGES.navigate.COLLAPSIBLE:"",r=at.MESSAGES.navigate.LEVEL+" "+this.getDepth(),s=$l(this.getFocus().getSemanticNodes()[0]),o=[new Mn({text:r,personality:{}}),new Mn({text:s,personality:{}}),new Mn({text:n,personality:{}})];return mt.getInstance().setParameter("depth",t),ia(oa(o))}actionable_(t){const e=null==t?void 0:t.parentNode;return e&&this.highlighter.isMactionNode(e)?e:null}summary_(){const t=this.getFocus().getSemanticPrimary().id.toString(),e=Xl(this.getRebuilt().xml.getAttribute("id")===t?this.getRebuilt().xml:w(this.getRebuilt().xml,"id",t)[0]);return this.mergePrefix_([e])}detail_(){const t=this.getFocus().getSemanticPrimary().id.toString(),e=this.getRebuilt().xml.getAttribute("id")===t?this.getRebuilt().xml:w(this.getRebuilt().xml,"id",t)[0],n=e.getAttribute("alternative");e.removeAttribute("alternative");const r=Bl(e),s=this.mergePrefix_([r]);return e.setAttribute("alternative",n),s}}uu.ID_COUNTER=0,uu.SRE_ID_ATTR="sre-explorer-id";class hu extends uu{up(){return null}down(){return null}left(){return null}right(){return null}repeat(){return null}depth(){return null}home(){return null}getDepth(){return 0}initLevels(){return null}combineContentChildren(t,e,n,r){return[]}findFocusOnLevel(t){return null}}class du{constructor(){this.level_=[]}push(t){this.level_.push(t)}pop(){return this.level_.pop()}peek(){return this.level_[this.level_.length-1]||null}indexOf(t){const e=this.peek();return e?e.indexOf(t):null}find(t){const e=this.peek();if(!e)return null;for(let n=0,r=e.length;n<r;n++)if(t(e[n]))return e[n];return null}get(t){const e=this.peek();return!e||t<0||t>=e.length?null:e[t]}depth(){return this.level_.length}clone(){const t=new du;return t.level_=this.level_.slice(0),t}toString(){let t="";for(let e,n=0;e=this.level_[n];n++)t+="\n"+e.map((function(t){return t.toString()}));return t}}class fu extends uu{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.levels=null,this.restoreState()}initLevels(){const t=new du;return t.push([this.getFocus()]),t}up(){super.up();const t=this.previousLevel();if(!t)return null;this.levels.pop();return this.levels.find((function(e){return e.getSemanticNodes().some((function(e){return e.id.toString()===t}))}))}down(){super.down();const t=this.nextLevel();return 0===t.length?null:(this.levels.push(t),t[0])}combineContentChildren(t,e,n,r){switch(t){case K.RELSEQ:case K.INFIXOP:case K.MULTIREL:return this.makePairList(r,n);case K.PREFIXOP:return[this.focusFromId(r[0],n.concat(r))];case K.POSTFIXOP:return[this.focusFromId(r[0],r.concat(n))];case K.MATRIX:case K.VECTOR:case K.FENCED:return[this.focusFromId(r[0],[n[0],r[0],n[1]])];case K.CASES:return[this.focusFromId(r[0],[n[0],r[0]])];case K.PUNCTUATED:return e===z.TEXT?r.map(this.singletonFocus.bind(this)):r.length===n.length?n.map(this.singletonFocus.bind(this)):this.combinePunctuations(r,n,[],[]);case K.APPL:return[this.focusFromId(r[0],[r[0],n[0]]),this.singletonFocus(r[1])];case K.ROOT:return[this.singletonFocus(r[0]),this.singletonFocus(r[1])];default:return r.map(this.singletonFocus.bind(this))}}combinePunctuations(t,e,n,r){if(0===t.length)return r;const s=t.shift(),o=e.shift();return s===o?(n.push(o),this.combinePunctuations(t,e,n,r)):(e.unshift(o),n.push(s),t.length===e.length?(r.push(this.focusFromId(s,n.concat(e))),r):(r.push(this.focusFromId(s,n)),this.combinePunctuations(t,e,[],r)))}makePairList(t,e){if(0===t.length)return[];if(1===t.length)return[this.singletonFocus(t[0])];const n=[this.singletonFocus(t.shift())];for(let r=0,s=t.length;r<s;r++)n.push(this.focusFromId(t[r],[e[r],t[r]]));return n}left(){super.left();const t=this.levels.indexOf(this.getFocus());if(null===t)return null;const e=this.levels.get(t-1);return e||null}right(){super.right();const t=this.levels.indexOf(this.getFocus());if(null===t)return null;const e=this.levels.get(t+1);return e||null}findFocusOnLevel(t){return this.levels.find((e=>e.getSemanticPrimary().id===t))}}class pu extends uu{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.levels=null,this.restoreState()}initLevels(){const t=new du;return t.push([this.primaryId()]),t}up(){super.up();const t=this.previousLevel();return t?(this.levels.pop(),this.singletonFocus(t)):null}down(){super.down();const t=this.nextLevel();if(0===t.length)return null;const e=this.singletonFocus(t[0]);return e&&this.levels.push(t),e}combineContentChildren(t,e,n,r){switch(t){case K.RELSEQ:case K.INFIXOP:case K.MULTIREL:return ar(r,n);case K.PREFIXOP:return n.concat(r);case K.POSTFIXOP:return r.concat(n);case K.MATRIX:case K.VECTOR:case K.FENCED:return r.unshift(n[0]),r.push(n[1]),r;case K.CASES:return r.unshift(n[0]),r;case K.PUNCTUATED:return e===z.TEXT?ar(r,n):r;case K.APPL:return[r[0],n[0],r[1]];case K.ROOT:return[r[0],r[1]];default:return r}}left(){super.left();const t=this.levels.indexOf(this.primaryId());if(null===t)return null;const e=this.levels.get(t-1);return e?this.singletonFocus(e):null}right(){super.right();const t=this.levels.indexOf(this.primaryId());if(null===t)return null;const e=this.levels.get(t+1);return e?this.singletonFocus(e):null}findFocusOnLevel(t){return this.singletonFocus(t.toString())}focusDomNodes(){return[this.getFocus().getDomPrimary()]}focusSemanticNodes(){return[this.getFocus().getSemanticPrimary()]}}class mu extends pu{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.firstJump=null,this.key_=null,this.row_=0,this.currentTable_=null,this.keyMapping.set(mc.ZERO,this.jumpCell.bind(this)),this.keyMapping.set(mc.ONE,this.jumpCell.bind(this)),this.keyMapping.set(mc.TWO,this.jumpCell.bind(this)),this.keyMapping.set(mc.THREE,this.jumpCell.bind(this)),this.keyMapping.set(mc.FOUR,this.jumpCell.bind(this)),this.keyMapping.set(mc.FIVE,this.jumpCell.bind(this)),this.keyMapping.set(mc.SIX,this.jumpCell.bind(this)),this.keyMapping.set(mc.SEVEN,this.jumpCell.bind(this)),this.keyMapping.set(mc.EIGHT,this.jumpCell.bind(this)),this.keyMapping.set(mc.NINE,this.jumpCell.bind(this))}move(t){this.key_=t;const e=super.move(t);return this.modifier=!1,e}up(){return this.moved=au.UP,this.eligibleCell_()?this.verticalMove_(!1):super.up()}down(){return this.moved=au.DOWN,this.eligibleCell_()?this.verticalMove_(!0):super.down()}jumpCell(){if(!this.isInTable_()||null===this.key_)return this.getFocus();if(this.moved===au.ROW){this.moved=au.CELL;const t=this.key_-mc.ZERO;return this.isLegalJump_(this.row_,t)?this.jumpCell_(this.row_,t):this.getFocus()}const t=this.key_-mc.ZERO;return t>this.currentTable_.childNodes.length?this.getFocus():(this.row_=t,this.moved=au.ROW,this.getFocus().clone())}undo(){const t=super.undo();return t===this.firstJump&&(this.firstJump=null),t}eligibleCell_(){const t=this.getFocus().getSemanticPrimary();return this.modifier&&t.type===K.CELL&&-1!==mu.ELIGIBLE_CELL_ROLES.indexOf(t.role)}verticalMove_(t){const e=this.previousLevel();if(!e)return null;const n=this.getFocus(),r=this.levels.indexOf(this.primaryId()),s=this.levels.pop(),o=this.levels.indexOf(e),i=this.levels.get(t?o+1:o-1);if(!i)return this.levels.push(s),null;this.setFocus(this.singletonFocus(i));const c=this.nextLevel();return c[r]?(this.levels.push(c),this.singletonFocus(c[r])):(this.setFocus(n),this.levels.push(s),null)}jumpCell_(t,e){this.firstJump?this.virtualize(!1):(this.firstJump=this.getFocus(),this.virtualize(!0));const n=this.currentTable_.id.toString();let r;do{r=this.levels.pop()}while(-1===r.indexOf(n));this.levels.push(r),this.setFocus(this.singletonFocus(n)),this.levels.push(this.nextLevel());const s=this.currentTable_.childNodes[t-1];return this.setFocus(this.singletonFocus(s.id.toString())),this.levels.push(this.nextLevel()),this.singletonFocus(s.childNodes[e-1].id.toString())}isLegalJump_(t,e){const n=w(this.getRebuilt().xml,"id",this.currentTable_.id.toString())[0];if(!n||n.hasAttribute("alternative"))return!1;const r=this.currentTable_.childNodes[t-1];if(!r)return!1;const s=w(n,"id",r.id.toString())[0];return!(!s||s.hasAttribute("alternative"))&&!(!r||!r.childNodes[e-1])}isInTable_(){let t=this.getFocus().getSemanticPrimary();for(;t;){if(-1!==mu.ELIGIBLE_TABLE_TYPES.indexOf(t.type))return this.currentTable_=t,!0;t=t.parent}return!1}}mu.ELIGIBLE_CELL_ROLES=[z.DETERMINANT,z.ROWVECTOR,z.BINOMIAL,z.SQUAREMATRIX,z.MULTILINE,z.MATRIX,z.VECTOR,z.CASES,z.TABLE],mu.ELIGIBLE_TABLE_TYPES=[K.MULTILINE,K.MATRIX,K.VECTOR,K.CASES,K.TABLE];const Eu={dummy:(t,e,n,r)=>new hu(t,e,n,r),semantic:(t,e,n,r)=>new fu(t,e,n,r),syntax:(t,e,n,r)=>new pu(t,e,n,r),table:(t,e,n,r)=>new mu(t,e,n,r)};class gu{static stringify_(t){return t?t.toString():t}constructor(t,e){this.name=t,this.process=e.processor,this.postprocess=e.postprocessor||((t,e)=>t),this.processor=this.postprocess?function(t){return this.postprocess(this.process(t),t)}:this.process,this.print=e.print||gu.stringify_,this.pprint=e.pprint||this.print}}gu.LocalState={walker:null,speechGenerator:null,highlighter:null};class Nu extends gu{static getKey_(t){return"string"==typeof t?mc[t.toUpperCase()]:t}constructor(t,e){super(t,e),this.key=e.key||Nu.getKey_}}const Su=new Map;function Tu(t){Su.set(t.name,t)}function Iu(t){const e=Su.get(t);if(!e)throw new m("Unknown processor "+t);return e}function Au(t,e){const n=Iu(t);try{return n.processor(e)}catch(t){throw new m("Processing error for expression "+e)}}function Ru(t,e){const n=Iu(t);try{const t=n.processor(e);return E.getInstance().pprint?n.pprint(t):n.print(t)}catch(t){throw console.log(t),new m("Processing error for expression "+e)}}Tu(new gu("semantic",{processor:function(t){return Fa(L(t))},postprocessor:function(t,e){const n=E.getInstance().speech;if(n===l.NONE)return t;const r=k(t);let s=Bl(r);if(n===l.SHALLOW)return t.setAttribute("speech",ia(s)),t;const o=O(".//*[@id]",t),i=O(".//*[@id]",r);for(let t,e,n=0;t=o[n],e=i[n];n++)s=Bl(e),t.setAttribute("speech",ia(s));return t},pprint:function(t){return D(t.toString())}})),Tu(new gu("speech",{processor:function(t){return ia(oa(wl(Fa(L(t)))))},pprint:function(t){const e=t.toString();return sa.get(E.getInstance().markup)instanceof Uc?D(e):e}})),Tu(new gu("json",{processor:function(t){return Ua(L(t)).toJson()},postprocessor:function(t,e){const n=E.getInstance().speech;if(n===l.NONE)return t;const r=Fa(L(e)),s=Bl(r);if(n===l.SHALLOW)return t.stree.speech=ia(s),t;const o=t=>{const e=Bl(O(`.//*[@id=${t.id}]`,r)[0]);t.speech=ia(e),t.children&&t.children.forEach(o)};return o(t.stree),t},print:function(t){return JSON.stringify(t)},pprint:function(t){return JSON.stringify(t,null,2)}})),Tu(new gu("description",{processor:function(t){return wl(Fa(L(t)))},print:function(t){return JSON.stringify(t)},pprint:function(t){return JSON.stringify(t,null,2)}})),Tu(new gu("enriched",{processor:function(t){return Il(t)},postprocessor:function(t,e){const n=Ul(t);let r;switch(E.getInstance().speech){case l.NONE:break;case l.SHALLOW:r=ou("Adhoc"),r.getSpeech(n,t);break;case l.DEEP:r=ou("Tree"),r.getSpeech(t,t)}return t},pprint:function(t){return D(t.toString())}})),Tu(new gu("walker",{processor:function(t){const e=ou("Node");gu.LocalState.speechGenerator=e,e.setOptions({modality:E.getInstance().modality,locale:E.getInstance().locale,domain:E.getInstance().domain,style:E.getInstance().style}),gu.LocalState.highlighter=function(t,e,n){const r=new Ll(t,e),s="NativeMML"===n.renderer&&"Safari"===n.browser?"MML-CSS":"SVG"===n.renderer&&"v3"===n.browser?"SVG-V3":n.renderer,o=new(_l[s]||_l.NativeMML);return o.setColor(r),o}({color:"black"},{color:"white"},{renderer:"NativeMML"});const n=Au("enriched",t),r=function(t,e){const n=Iu(t);return E.getInstance().pprint?n.pprint(e):n.print(e)}("enriched",n);return gu.LocalState.walker=function(t,e,n,r,s){return(Eu[t.toLowerCase()]||Eu.dummy)(e,n,r,s)}(E.getInstance().walker,n,e,gu.LocalState.highlighter,r),gu.LocalState.walker},print:function(t){return gu.LocalState.walker.speech()}})),Tu(new Nu("move",{processor:function(t){if(!gu.LocalState.walker)return null;return!1===gu.LocalState.walker.move(t)?function(t){const e=sa.get(E.getInstance().markup);return e?e.error(t):""}(t):gu.LocalState.walker.speech()}})),Tu(new gu("number",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":at.NUMBERS.numberToWords(e)}})),Tu(new gu("ordinal",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":at.NUMBERS.wordOrdinal(e)}})),Tu(new gu("numericOrdinal",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":at.NUMBERS.numericOrdinal(e)}})),Tu(new gu("vulgar",{processor:function(t){const[e,n]=t.split("/").map((t=>parseInt(t,10)));return isNaN(e)||isNaN(n)?"":Au("speech",`<mfrac><mn>${e}</mn><mn>${n}</mn></mfrac>`)}})),Tu(new gu("latex",{processor:function(t){return"braille"===E.getInstance().modality&&"euro"===E.getInstance().locale||console.info("LaTeX input currently only works for Euro Braille output. Please use the latex-to-speech package from npm for general LaTeX input to SRE."),Au("speech",`<math data-latex="${t}"></math>`)}}));var Ou=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};const Cu=p.u.VERSION;function bu(t){return Ou(this,void 0,void 0,(function*(){return pc(t)}))}function Lu(){const t=["mode"].concat(E.STRING_FEATURES,E.BINARY_FEATURES),e=E.getInstance(),n={};return t.forEach((function(t){n[t]=e[t]})),n.json=d.f.jsonPath,n.xpath=d.f.WGXpath,n.rules=e.ruleSets.slice(),n}function yu(){return Ou(this,void 0,void 0,(function*(){return bu({}).then((()=>g.getall()))}))}const Mu=oc;function _u(t){return ku("speech",t)}function Pu(t){return ku("semantic",t)}function Fu(t){return ku("json",t)}function Uu(t){return ku("description",t)}function xu(t){return ku("enriched",t)}function Du(t){return ku("number",t)}function vu(t){return ku("ordinal",t)}function wu(t){return ku("numericOrdinal",t)}function Bu(t){return ku("vulgar",t)}function ku(t,e){return Au(t,e)}const Gu={};function Vu(t,n,r){switch(E.getInstance().mode){case e.ASYNC:return function(t,e,n){return Ou(this,void 0,void 0,(function*(){const r=yield d.f.fs.promises.readFile(e,{encoding:"utf8"}),s=Ru(t,r);if(n)try{d.f.fs.promises.writeFile(n,s)}catch(t){throw new m("Can not write to file: "+n)}return s}))}(t,n,r);case e.SYNC:return function(t,e,n){const r=function(t){let e;try{e=d.f.fs.readFileSync(t,{encoding:"utf8"})}catch(e){throw new m("Can not open file: "+t)}return e}(e),s=Ru(t,r);if(n)try{d.f.fs.writeFileSync(n,s)}catch(t){throw new m("Can not write to file: "+n)}return s}(t,n,r);default:throw new m(`Can process files in ${E.getInstance().mode} mode`)}}function ju(t){return Ru("walker",t)}function $u(t){return function(t,e){const n=Iu(t),r=n instanceof Nu?n.key(e):e,s=n.processor(r);return E.getInstance().pprint?n.pprint(s):n.print(s)}("move",t)}function Hu(t){const e=t||0;g.getall().then((()=>process.exit(e)))}Gu.toSpeech=function(t,e){return Vu("speech",t,e)},Gu.toSemantic=function(t,e){return Vu("semantic",t,e)},Gu.toJson=function(t,e){return Vu("json",t,e)},Gu.toDescription=function(t,e){return Vu("description",t,e)},Gu.toEnriched=function(t,e){return Vu("enriched",t,e)};const Xu=Je;d.f.documentSupported?bu({mode:e.HTTP}).then((()=>bu({}))):bu({mode:e.SYNC}).then((()=>bu({mode:e.ASYNC})));var Wu=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};class Yu{constructor(){this.setup={mode:e.SYNC},this.processors=[],this.output=Yu.process.stdout,this.dp=new d.f.xmldom.DOMParser({errorHandler:(t,e)=>{throw new m("XML DOM error!")}})}set(t,e,n){this.setup[t]=void 0===e||e}processor(t){this.processors.push(t)}loadLocales(){return Wu(this,void 0,void 0,(function*(){for(const t of p.u.LOCALES.keys())yield bu({locale:t})}))}enumerate(){return Wu(this,arguments,void 0,(function*(t=!1){const e=bu(this.setup),n=o.DEFAULT_ORDER.slice(0,-1);return(t?this.loadLocales():e).then((()=>g.getall().then((()=>{const t=n.map((t=>t.length)),e=(e,n)=>{t[n]=Math.max.apply(null,Object.keys(e).map((t=>t.length)).concat(t[n]))},r=(t,e)=>t+new Array(e-t.length+1).join(" ");let s=Xi.getInstance().enumerate();s=On(s);const o=[];e(s,0);for(const[n,i]of Object.entries(s)){let c=!0;e(i,1);for(const[a,l]of Object.entries(i)){let i=!0;e(l,2);for(const[e,u]of Object.entries(l)){const l=Object.keys(u).sort();if("clearspeak"===e){let l=!0;const u=Wl.getLocalePreferences(s)[n];if(!u)continue;for(const s of Object.values(u))o.push([r(c?n:"",t[0]),r(i?a:"",t[1]),r(l?e:"",t[2]),s.join(", ")]),c=!1,i=!1,l=!1}else o.push([r(c?n:"",t[0]),r(i?a:"",t[1]),r(e,t[2]),l.join(", ")]);c=!1,i=!1}}}let i=0;const c=n.map((e=>r(e,t[i++]))),a=Yu.commander.opts().pprint,l=t.map((t=>new Array(t+1).join(a?"-":"=")));a||(l[i-1]=l[i-1]+"========================"),o.unshift(l),o.unshift(c);let u=o.map((t=>t.join(" | ")));a&&(u=u.map((t=>`| ${t} |`)),u.unshift(`# Options SRE v${Cu}\n`)),console.info(u.join("\n"))}))))}))}execute(t){g.getall().then((()=>{this.runProcessors_(((t,e)=>this.output.write(Vu(t,e)+"\n")),t)}))}readline(){Yu.process.stdin.setEncoding("utf8");const t=d.f.extRequire("readline").createInterface({input:Yu.process.stdin,output:this.output});let e="";t.on("line",(n=>{e+=n,this.readExpression_(e)&&t.close()}).bind(this)),t.on("close",(()=>{this.runProcessors_(((e,n)=>{t.output.write(Ru(e,n)+"\n")}),e),yu().then((()=>f.getInstance().exit((()=>Hu(0)))))}).bind(this))}commandLine(){return Wu(this,void 0,void 0,(function*(){const e=Yu.commander,n=r,s=(t=>(e,n)=>this.set(t,e,n)).bind(this),i=this.processor.bind(this);e.version(n.version).usage("[options] <file ...>").option("-i, --input [name]","Input file [name]. (Deprecated)").option("-o, --output [name]","Output file [name]. Defaults to stdout.").option("-d, --domain [name]","Speech rule set [name]. See --options for details.",s(t.DOMAIN),o.DEFAULT_VALUES[t.DOMAIN]).option("-s, --style [name]","Speech style [name]. See --options for details.",s(t.STYLE),o.DEFAULT_VALUES[t.STYLE]).option("-c, --locale [code]","Locale [code].",s(t.LOCALE),o.DEFAULT_VALUES[t.LOCALE]).option("-b, --modality [name]","Modality [name].",s(t.MODALITY),o.DEFAULT_VALUES[t.MODALITY]).option("-k, --markup [name]","Generate speech output with markup tags.",s("markup"),"none").option("-e, --automark","Automatically set marks for external reference.",s("automark")).option("-L, --linebreaks","Linebreak marking in 2D output.",s("linebreaks")).option("-r, --rate [value]","Base rate [value] for tagged speech output.",s("rate"),"100").option("-p, --speech","Generate speech output (default).",(()=>i("speech"))).option("-a, --audit","Generate auditory descriptions (JSON format).",(()=>i("description"))).option("-j, --json","Generate JSON of semantic tree.",(()=>i("json"))).option("-x, --xml","Generate XML of semantic tree.",(()=>i("semantic"))).option("-m, --mathml","Generate enriched MathML.",(()=>i("enriched"))).option("-t, --latex","Accepts LaTeX input for certain locale/modality combinations.",(()=>i("latex"))).option("-g, --generate <depth>","Include generated speech in enriched MathML (with -m option only).",s("speech"),"none").option("-w, --structure","Include structure attribute in enriched MathML (with -m option only).",s("structure")).option("-A, --aria","Include aria tree annotations MathML (with -m and -w option only).",s("aria")).option("-P, --pprint","Pretty print output whenever possible.",s("pprint")).option("-f, --rules [name]","Loads a local rule file [name].",s("rules")).option("-C, --subiso [name]","Supplementary country code (or similar) for the given locale.",s("subiso")).option("-N, --number","Translate number to word.",(()=>i("number"))).option("-O, --ordinal","Translate number to ordinal.",(()=>i("ordinal")),"ordinal").option("-S, --numeric","Translate number to numeric ordinal.",(()=>i("numericOrdinal"))).option("-F, --vulgar","Translate vulgar fraction to word. Provide vulgar fraction as slash seperated numbers.",(()=>i("vulgar"))).option("-v, --verbose","Verbose mode.").option("-l, --log [name]","Log file [name].").option("--opt","List engine setup options. Output as markdown with -P option.").option("--opt-all","List engine setup options for all available locales. Output as markdown with -P option.").on("option:opt",(()=>{this.enumerate().then((()=>Hu(0)))})).on("option:opt-all",(()=>{this.enumerate(!0).then((()=>Hu(0)))})).parse(Yu.process.argv),yield yu().then((()=>bu(this.setup)));const c=Yu.commander.opts();c.output&&(this.output=d.f.fs.createWriteStream(c.output)),c.verbose&&(yield f.getInstance().init(c.log)),c.input&&this.execute(c.input),Yu.commander.args.length?(Yu.commander.args.forEach(this.execute.bind(this)),yu().then((()=>f.getInstance().exit((()=>Hu(0)))))):this.readline()}))}runProcessors_(t,e){try{this.processors.length||this.processors.push("speech"),e&&this.processors.forEach((n=>t(n,e)))}catch(t){console.error(t.name+": "+t.message),f.getInstance().exit((()=>Yu.process.exit(1)))}}readExpression_(t){try{const e=t.replace(/(&|#|;)/g,"");this.dp.parseFromString(e,"text/xml")}catch(t){return!1}return!0}}Yu.process=d.f.extRequire("process"),Yu.commander=d.f.documentSupported?null:d.f.extRequire("commander").program;const Ku=Yu,qu=p.u})(),__webpack_exports__})()));